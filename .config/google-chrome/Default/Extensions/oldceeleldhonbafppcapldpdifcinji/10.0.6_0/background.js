(()=>{var e={4629:function(e,t){var r,n,s;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[e],r=function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(void 0===globalThis.browser||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const t="The message port closed before a response was received.",r=e=>{const r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(r).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class n extends WeakMap{constructor(e,t=void 0){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const s=e=>e&&"object"==typeof e&&"function"==typeof e.then,a=(t,r)=>(...n)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):r.singleCallbackArg||n.length<=1&&!1!==r.singleCallbackArg?t.resolve(n[0]):t.resolve(n)},i=e=>1==e?"argument":"arguments",o=(e,t)=>function(r,...n){if(n.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${i(t.minArgs)} for ${e}(), got ${n.length}`);if(n.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${i(t.maxArgs)} for ${e}(), got ${n.length}`);return new Promise((s,i)=>{if(t.fallbackToNoCallback)try{r[e](...n,a({resolve:s,reject:i},t))}catch(a){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,a),r[e](...n),t.fallbackToNoCallback=!1,t.noCallback=!0,s()}else t.noCallback?(r[e](...n),s()):r[e](...n,a({resolve:s,reject:i},t))})},c=(e,t,r)=>new Proxy(t,{apply:(t,n,s)=>r.call(n,e,...s)});let l=Function.call.bind(Object.prototype.hasOwnProperty);const u=(e,t={},r={})=>{let n=Object.create(null),s={has:(t,r)=>r in e||r in n,get(s,a,i){if(a in n)return n[a];if(!(a in e))return;let g=e[a];if("function"==typeof g)if("function"==typeof t[a])g=c(e,e[a],t[a]);else if(l(r,a)){let t=o(a,r[a]);g=c(e,e[a],t)}else g=g.bind(e);else if("object"==typeof g&&null!==g&&(l(t,a)||l(r,a)))g=u(g,t[a],r[a]);else{if(!l(r,"*"))return Object.defineProperty(n,a,{configurable:!0,enumerable:!0,get:()=>e[a],set(t){e[a]=t}}),g;g=u(g,t[a],r["*"])}return n[a]=g,g},set:(t,r,s,a)=>(r in n?n[r]=s:e[r]=s,!0),defineProperty:(e,t,r)=>Reflect.defineProperty(n,t,r),deleteProperty:(e,t)=>Reflect.deleteProperty(n,t)},a=Object.create(e);return new Proxy(a,s)},g=e=>({addListener(t,r,...n){t.addListener(e.get(r),...n)},hasListener:(t,r)=>t.hasListener(e.get(r)),removeListener(t,r){t.removeListener(e.get(r))}}),d=new n(e=>"function"!=typeof e?e:function(t){const r=u(t,{},{getContent:{minArgs:0,maxArgs:0}});e(r)}),h=new n(e=>"function"!=typeof e?e:function(t,r,n){let a,i,o=!1,c=new Promise(e=>{a=function(t){o=!0,e(t)}});try{i=e(t,r,a)}catch(e){i=Promise.reject(e)}const l=!0!==i&&s(i);if(!0!==i&&!l&&!o)return!1;const u=e=>{e.then(e=>{n(e)},e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",n({__mozWebExtensionPolyfillReject__:!0,message:t})}).catch(e=>{console.error("Failed to send onMessage rejected reply",e)})};return u(l?i:c),!0}),m=({reject:r,resolve:n},s)=>{e.runtime.lastError?e.runtime.lastError.message===t?n():r(new Error(e.runtime.lastError.message)):s&&s.__mozWebExtensionPolyfillReject__?r(new Error(s.message)):n(s)},_=(e,t,r,...n)=>{if(n.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${i(t.minArgs)} for ${e}(), got ${n.length}`);if(n.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${i(t.maxArgs)} for ${e}(), got ${n.length}`);return new Promise((e,t)=>{const s=m.bind(null,{resolve:e,reject:t});n.push(s),r.sendMessage(...n)})},p={devtools:{network:{onRequestFinished:g(d)}},runtime:{onMessage:g(h),onMessageExternal:g(h),sendMessage:_.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:_.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},E={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":E},services:{"*":E},websites:{"*":E}},u(e,p,r)};e.exports=r(chrome)}else e.exports=globalThis.browser},void 0===(s="function"==typeof r?r.apply(t,n):r)||(e.exports=s)},6326:(e,t,r)=>{"use strict";r(8249)},8249:(e,t)=>{"use strict";var r=Symbol.for("react.element"),n=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),h=Symbol.iterator;
/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,p={};function E(e,t,r){this.props=e,this.context=t,this.refs=p,this.updater=r||m}function f(){}function S(e,t,r){this.props=e,this.context=t,this.refs=p,this.updater=r||m}E.prototype.isReactComponent={},E.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},E.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},f.prototype=E.prototype;var T=S.prototype=new f;T.constructor=S,_(T,E.prototype),T.isPureReactComponent=!0;var A=Array.isArray,C=Object.prototype.hasOwnProperty,R={current:null},I={key:!0,ref:!0,__self:!0,__source:!0};function P(e,t,n){var s,a={},i=null,o=null;if(null!=t)for(s in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(i=""+t.key),t)C.call(t,s)&&!I.hasOwnProperty(s)&&(a[s]=t[s]);var c=arguments.length-2;if(1===c)a.children=n;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];a.children=l}if(e&&e.defaultProps)for(s in c=e.defaultProps)void 0===a[s]&&(a[s]=c[s]);return{$$typeof:r,type:e,key:i,ref:o,props:a,_owner:R.current}}function L(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}var y=/\/+/g;function b(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function O(e,t,s,a,i){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var c=!1;if(null===e)c=!0;else switch(o){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case r:case n:c=!0}}if(c)return i=i(c=e),e=""===a?"."+b(c,0):a,A(i)?(s="",null!=e&&(s=e.replace(y,"$&/")+"/"),O(i,t,s,"",function(e){return e})):null!=i&&(L(i)&&(i=function(e,t){return{$$typeof:r,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(i,s+(!i.key||c&&c.key===i.key?"":(""+i.key).replace(y,"$&/")+"/")+e)),t.push(i)),1;if(c=0,a=""===a?".":a+":",A(e))for(var l=0;l<e.length;l++){var u=a+b(o=e[l],l);c+=O(o,t,s,u,i)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),l=0;!(o=e.next()).done;)c+=O(o=o.value,t,s,u=a+b(o,l++),i);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function N(e,t,r){if(null==e)return e;var n=[],s=0;return O(e,n,"","",function(e){return t.call(r,e,s++)}),n}function w(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var v={current:null},D={transition:null};function x(){throw Error("act(...) is not supported in production builds of React.")}}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.d(n,{y:()=>Is});var e={};r.r(e),r.d(e,{ACCOUNT_STATUS_RECHECK_INTERVAL:()=>b,AUTO_LOGIN_URL:()=>W,BASE_REPHRASING_SERVER_URL:()=>X,BASE_SERVER_URL:()=>V,CHECK_DELAY:()=>fe,CHECK_MAX_DELAY:()=>Se,CHECK_RECOMMENDATION_DELAY:()=>Ie,CHECK_REQUEST_TIMEOUT:()=>M,CHECK_THROTTLING_LIMIT:()=>F,CLIENT_LOGIN_URL:()=>ee,COLORS:()=>xe,COLORS_ON_DARK:()=>ke,COUNTRY_COUPON_MAPPING:()=>$e,COUPON_INTERVAL:()=>qe,CURRENT_TERMS_OF_SERVICE_VERSION:()=>dt,DEFAULT_MAX_FIX_ALL_ERRORS_COUNT:()=>pe,DICTIONARY_SYNC_INTERVAL:()=>D,EDITOR_GROUP_ATTRIBUTE:()=>pt,EMPLOYEE_EMAIL_REGEXP:()=>De,ERRORS_THAT_CAN_BE_CORRECTED_ALL_AT_ONCE:()=>Qe,EXTENSION_HEALTH_RECHECK_INTERVAL:()=>L,EXTERNAL_CONFIG_RELOAD_INTERVAL:()=>O,EXTERNAL_CONFIG_URL:()=>J,FEEDBACK_SERVER_URL:()=>Q,FIX_SENTENCE_MIN_ERROR_AMOUNT:()=>Ve,HOVER_DELAY:()=>ye,HOVER_MAX_DELAY:()=>be,HTTP_ERROR_ABORT:()=>ot,HTTP_ERROR_GENERIC:()=>ut,HTTP_ERROR_PAYLOAD_TOO_LARGE:()=>ct,HTTP_ERROR_TIMEOUT:()=>lt,IFRAME_INITILIZATION_RECHECK_INTERVAL:()=>v,IMMEDIATE_CHECK_ON_PASTE_ACTION:()=>We,INSTALL_URL:()=>B,INVISIBLE_SEPARATOR:()=>_t,LOCAL_SERVER_URL:()=>Z,LOLLIPOP_DILATE_SCHEDULE_TIMEOUT:()=>Le,MAIN_FALLBACK_SERVER_URL:()=>Y,MAIN_SERVER_RECHECK_INTERVAL:()=>oe,MAIN_SERVER_URL:()=>q,MASCOT_NAME:()=>Ze,MAX_BURST_BUFFER_SIZE:()=>Re,MAX_EXCEPTION_COUNT:()=>Me,MAX_FIXES_COUNT:()=>Ue,MAX_FREEMIUM_REPHRASINGS_PER_DAY:()=>rt,MAX_PHRASE_LENGTH_IN_WORDS:()=>je,MAX_TEXT_LENGTH:()=>ue,MAX_TEXT_LENGTH_CUSTOM_SERVER:()=>_e,MAX_TEXT_LENGTH_PERFORMANCE_DEGRADATION:()=>he,MAX_TEXT_LENGTH_PREMIUM:()=>me,MAX_USAGE_COUNT_ONBOARDING:()=>Fe,MIN_TEXT_LENGTH:()=>ce,NARROW_WHITESPACE_REGEXP:()=>st,NEW_SYNONYMS_URL:()=>se,PACKAGE:()=>Ye,PARAGRAPH_LEVEL_CHUNK_LENGTH:()=>Ee,PICKY_RULES_THAT_ARE_CONSIDERED_ANNOYING:()=>ze,PING_INTERVAL:()=>N,PING_URL:()=>te,PREMIUM_FALLBACK_SERVER_URL:()=>K,PREMIUM_SERVER_URL:()=>z,PRIVACY_POLICY_URL:()=>mt,QB_EXTENSION_DETECTION_SELECTOR:()=>Dt,QUOTE_AT_BEGINNING_REGEXP:()=>it,QUOTE_AT_END_REGEXP:()=>at,RELIABLE_MOTHER_TONGUES:()=>tt,RENDER_INTERVAL:()=>k,REPHRASE_MODE_ACADEMIC:()=>At,REPHRASE_MODE_CREATIVE:()=>Ct,REPHRASE_MODE_EXPAND:()=>Rt,REPHRASE_MODE_FLUENCY:()=>Tt,REPHRASE_MODE_FORMALITY:()=>St,REPHRASE_MODE_HUMANIZE:()=>Pt,REPHRASE_MODE_SHORTEN:()=>It,REPHRASE_MODE_SIMPLICITY:()=>ft,REPHRASE_MODE_STANDARD:()=>Et,RTL_LANGUAGES:()=>et,RULES_ALLOWED_TO_BE_SENT_TO_API:()=>Ke,SELECTION_MODIFIER_KEYS:()=>yt,SEND_AND_DESTROY_COMPLETED_USER_ACTIVITIES_INTERVAL:()=>we,SENTENCE_END_CHARS:()=>Lt,SERVER_MAX_TEXT_LENGTH_BASIC:()=>ge,SHORT_TEXT_MAX_LENGTH:()=>le,SPLIT_SENTENCE_LIMIT:()=>G,STATISTICS_URL:()=>ne,STOPPED_TYPING_TIMEOUT:()=>Pe,SUPPORTED_FIX_COMPLETE_SENTENCE_LANGUAGES:()=>He,SUPPORTED_REPHRASE_LANGUAGES:()=>Ge,SUPPORTED_SENTENCE_SPLITTING_LANGUAGES:()=>Be,SUPPORTED_SYNONYM_LANGUAGES:()=>Xe,SWITCH_TO_FALLBACK_SERVER_ERRORS:()=>ie,SYNC_USER_DATA_INTERVAL:()=>w,TERMS_OF_SERVICE_API_URL:()=>ae,TERMS_OF_SERVICE_URL:()=>ht,TEXT_LEVEL_MAX_LENGTH_PER_REQUEST:()=>de,TOOLBAR_DECREASE_SIZE_INTERVAL:()=>U,TOOLBOX_THEME:()=>gt,TRACK_RULE_EVENT_LANGUAGES:()=>Je,TRAILING_WHITESPACE_REGEXP:()=>nt,TRANSLATE_SUPPORTED_LANGUAGES_FETCH_INTERVAL:()=>ve,TRANSLATOR_BASE_URL:()=>$,TRIAL_DISCOUNT_CODE:()=>wt,TRIAL_DURATION:()=>bt,TRIAL_EMAIL_BLACKLIST:()=>vt,TRIAL_PAGE_CHECK_INTERVAL:()=>x,TRIAL_TOKEN_EXPIRY_TIME:()=>Nt,TRIAL_TOKEN_USAGE_LIMIT:()=>Ot,TYPING_BURST_SESSION_INACTIVITY_DELAY:()=>Te,UI_MODE_RECHECK_INTERVAL:()=>y,UNINSTALL_URL:()=>H,USER_ACTIVITY_DESTRUCTION_DELAY:()=>Ne,USER_ACTIVITY_PING_INTERVAL_LENGTH:()=>Oe,USER_DATA_URL:()=>j,VALID_MAX_CHARACTERS_DELTA_ALLOWED:()=>Ce,VALID_MIN_CHARACTERS_CHANGE_PER_TYPING_BURST:()=>Ae,WEBAPI_URL:()=>re});var t,s=async e=>!e&&(!!navigator.webdriver||(!![navigator.userAgent,navigator.appVersion].some(e=>e.match(/headless/i))||(!!await new Promise(e=>{navigator.permissions.query({name:"notifications"}).then(t=>{"denied"===Notification.permission&&"prompt"===t.state?e(!0):e(!1)})})||(33===eval.toString().length&&!self.chrome||(!navigator.language||0===navigator.languages.length||!![self.outerWidth,self.outerHeight].every(e=>0===e)))))),a=(e,t)=>{const r={color:[-1,-1,-1],position:{x:-1,y:-1}};e.drawImage(t,0,0);for(let n=0;n<t.width;n++)for(let s=0;s<t.height;s++){const t=e.getImageData(n,s,1,1,{colorSpace:"srgb"}),[a,i,o]=[...t.data];if(![a,i,o].every(e=>0===e))return r.color=[a,i,o],r.position={x:n,y:s},r}return r},i=1e4,o=(e,t,r)=>{onmessage=n=>{const s=new Blob([n.data],{type:"image/png"}),a=new OffscreenCanvas(t,r).getContext("2d",{willReadFrequently:!0,alpha:!1});a?createImageBitmap(s).then(t=>postMessage({status:"success",data:e(a,t)})).catch(e=>postMessage({status:"error",data:e instanceof Error?e:new Error(e)})):postMessage({status:"error",data:new Error("Failed to create rendering context in worker.")})}},c="OffscreenCanvas"in self,l="document"in self&&self.document.baseURI.startsWith("moz-extension://"),u="serviceWorker"in self&&!!self.serviceWorker.scriptURL.match(/^(?:chrome-|safari-)extension:\/\//),g=l||u,d=class{constructor(){this.ctx=null,this.unbindListeners=()=>{};try{if(!c)throw new Error("no support for offscreen canvas");if(g)return;const e=`(${o.toString()})(${a.toString()}, 10000, 100);`,t=new Blob([e],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(t),{type:"classic"})}catch{const e=document.createElement("canvas");this.ctx=e.getContext("2d",{willReadFrequently:!0,alpha:!1}),e.width=i,e.height=100}}static create(){return new this}inspect(e){return new Promise((t,r)=>{if(c&&this.worker)return void this.inspectInWorker(this.worker,e,(e,n)=>{!e&&n?t(n):r(e||new Error("Did not receive result from worker for unknown reasons."))});const n=this.ctx||new OffscreenCanvas(i,100).getContext("2d",{willReadFrequently:!0,alpha:!1});if(!n)throw new Error("Failed to create rendering context.");const s=new Blob([e],{type:"image/png"});createImageBitmap(s).then(e=>t(a(n,e))).catch(r)})}destroy(){this.unbindListeners(),this.worker?.terminate(),this.unbindListeners=()=>{}}inspectInWorker(e,t,r){const n=t=>{switch(t.data.status){case"success":r(null,t.data.data);break;case"error":r(t.data.data,null);break;default:r(new Error("Received unexpected status from worker."),null)}e.removeEventListener("error",s)},s=t=>{r(t.error,null),e.removeEventListener("message",n)};e.addEventListener("message",n,{once:!0}),e.addEventListener("error",s,{once:!0}),e.postMessage(t),this.unbindListeners=()=>{e.removeEventListener("message",n),e.removeEventListener("error",s)}}},h=class{constructor({expires:e,limit:t,token:r}){this.createdAt=new Date,this.jwt=r,this.expires=e,this.limit=t}getJWT(){return this.jwt}isDepleted(){return this.limit<=0}isExpired(){const e=new Date,t=new Date(this.createdAt);return t.setSeconds(this.createdAt.getSeconds()+this.expires),t.getTime()<e.getTime()}},m="https://cerberus.languagetool.org/",_=Symbol.for("cerberus::timeout"),p=class{constructor(e,t){const r=this.isValidApiUrl(e.apiUrl)?e.apiUrl:m;this.timeout=e.timeout??1e4,this.autoRefresh=e.autoRefresh??!1,this.tokenMetaData=e.tokenMetaData,this.disableBrowserCheck=e.disableBrowserCheck??!1,this.onToken=e.onToken,this.onError=e.onError,this.onTimeout=e.onTimeout,this.onAbort=t,this.url=new URL("/verify",r),this.url.searchParams.set("service",e.service),this.canvas=d.create()}async requestVerification(){if(this.acPng?.abort(),this.acToken?.abort(),this.abortAutoRefresh(),await s(this.disableBrowserCheck))return void this.onError?.("failed");const e=await Promise.race([this.fetchAndVerify(crypto.randomUUID()),this.waitForTimeout()]);if(e===_)this.onTimeout?.();else if(e){if(this.abortTimeout(),this.onToken(new h(e)),this.autoRefresh){const t=1e3*e.expires-Date.now();this.autoRefreshId=self.setTimeout(()=>this.requestVerification(),t)}}else this.onError?.("empty")}abort(){this.acPng?.abort(),this.acToken?.abort(),this.abortTimeout(),this.abortAutoRefresh(),this.canvas.destroy(),this.onAbort()}async fetchAndVerify(e){try{this.url.searchParams.set("id",e);const t=await this.fetchPng();if(!t)return;const r=await this.canvas.inspect(t);return await this.fetchJwt(r)}catch(e){console.error(e),this.onError?.("failed")}finally{this.autoRefresh||this.canvas.destroy()}}waitForTimeout(){return new Promise(e=>{this.timeoutId=self.setTimeout(()=>{this.acPng?.abort(),this.acToken?.abort(),e(_)},this.timeout)})}async fetchPng(){try{this.acPng=new AbortController;const e=await fetch(this.url,{signal:this.acPng.signal,referrerPolicy:"no-referrer",mode:"cors",credentials:"omit",headers:{Accept:"image/*"}});return await e.arrayBuffer()}catch(e){if("AbortError"===Object(e).name)return null;throw e}finally{this.acPng=void 0}}async fetchJwt(e){try{this.acToken=new AbortController;const t=this.tokenMetaData&&Object.keys(this.tokenMetaData).length?{meta:this.tokenMetaData}:void 0,r={...e,...t},n=await fetch(this.url,{method:"POST",signal:this.acToken.signal,referrerPolicy:"no-referrer",mode:"cors",credentials:"omit",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(r)}),{status:s,data:a}=await n.json();if("success"===s&&(e=>!!e&&"object"==typeof e&&"token"in e&&"expires"in e&&"limit"in e)(a))return a;throw new Error(a?.reason??"erroneous response from server")}catch(e){if("AbortError"===Object(e).name)return null;throw e}finally{this.acToken=void 0}}abortTimeout(){clearTimeout(this.timeoutId),this.timeoutId=this.autoRefreshId=void 0}abortAutoRefresh(){clearTimeout(this.autoRefreshId),this.autoRefreshId=void 0}isValidApiUrl(e){if(void 0===e)return!1;try{return new URL(e),!0}catch{return console.warn("[Cerberus] The given API URL is invalid; falling back to %s",m),!1}}};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class E{static _contructor(){if(this._isInitialized)return;E._isChromium=navigator.userAgent.includes("Chrome/")||navigator.userAgent.includes("Chromium/"),E._isFirefox=navigator.userAgent.includes("Firefox/"),E._isThunderbird=navigator.userAgent.includes("Thunderbird/"),E._isOpera=navigator.userAgent.includes("OPR/"),E._isEdge=navigator.userAgent.includes("Edg/"),E._isOldEdge=navigator.userAgent.includes("Edge/"),E._isSafari=(navigator.userAgent.includes("Safari/")||navigator.userAgent.includes("AppleWebKit"))&&!E._isChromium&&!E._isEdge&&!E._isOpera,E._isYaBrowser=navigator.userAgent.includes("YaBrowser/"),E._isChrome=E._isChromium&&!E._isOpera&&!E._isEdge&&!E._isOldEdge&&!E._isYaBrowser;const e=navigator.userAgent.match(/Chrome\/(\d+)/);e&&(E._isUnsupportedChrome=parseInt(e[1])<67&&!navigator.userAgent.includes("Edge/"));const t=navigator.userAgent.match(/Firefox\/(\d+)/);t&&(E._isUnsupportedFirefox=parseInt(t[1])<60),this._isInitialized=!0}static getOS(){return navigator.userAgent.includes("Macintosh")?"Mac":navigator.userAgent.includes("Windows")?"Windows":navigator.userAgent.includes("CrOS")?"CrOS":navigator.userAgent.includes("Linux")?"Linux":"Other"}static isChromium(){return E._isChromium}static isChrome(){return E._isChrome}static isThunderbird(){return E._isThunderbird}static isFirefox(){return E._isFirefox}static isOpera(){return E._isOpera}static isEdge(){return E._isEdge}static isSafari(){return E._isSafari}static isYaBrowser(){return E._isYaBrowser}static isUnsupportedChrome(){return E._isUnsupportedChrome}static isUnsupportedFirefox(){return E._isUnsupportedFirefox}static isUnsupportedBrowser(){return E.isUnsupportedChrome()||E.isUnsupportedFirefox()}static getBrowserName(){return E.isChrome()?"Chrome":E.isFirefox()?"Firefox":E.isOpera()?"Opera":E.isEdge()?"Edge":E.isSafari()?"Safari":E.isYaBrowser()?"Yandex":"Unknown Browser"}static getUserAgentIdentifier(){let e="webextension";return this.isChrome()?e+="-chrome":this.isFirefox()?e+="-firefox":this.isOpera()?e+="-opera":this.isEdge()?e+="-edge":this.isYaBrowser()?e+="-chrome":this.isSafari()?e+="-safari":e+="-unknown",e+"-ng"}static isTouchDevice(){if(!("ontouchstart"in self))return!1;const e=navigator.userAgent.includes("Android");return this.isIOS()||e}static isIOS(){const e=navigator.userAgent.includes("iPhone OS"),t=navigator.userAgent.includes("Macintosh")&&Boolean(navigator.maxTouchPoints&&navigator.maxTouchPoints>2);return e||t}static isIOSTouchDevice(){return"ontouchstart"in self&&this.isIOS()}static isMacApp(){return navigator.userAgent.includes("AppleWebKit/")&&navigator.userAgent.includes("LanguageTool/")&&!navigator.userAgent.includes("Chrome/")&&!navigator.userAgent.includes("Chromium/")}static isWindowsApp(){return navigator.userAgent.includes("LanguageToolWindows/")}}E._isChromium=!1,E._isChrome=!1,E._isFirefox=!1,E._isThunderbird=!1,E._isOpera=!1,E._isOldEdge=!1,E._isEdge=!1,E._isSafari=!1,E._isYaBrowser=!1,E._isUnsupportedChrome=!1,E._isUnsupportedFirefox=!1,E._isInitialized=!1,E._contructor();const f="EDITOR_STATE_SYNC_ACK",S="EDITOR_STATE_FORCE_SYNC",T="EDITOR_SURROUNDING_CONTEXT_FORCE_SYNC";var A;!function(e){e.CHROME_EXTENSION_ID="CHROME_EXTENSION_ID",e.SHOW_PARTIAL_RECO_UNDERLINE="SHOW_PARTIAL_RECO_UNDERLINE",e.EXTN_PREFIX="EVENT_PREFIX",e.COLORS_GRAMMAR="COLORS_GRAMMAR",e.CARD_LAYOUT="CARD_LAYOUT",e.COLORS_SPELLING="COLORS_SPELLING",e.COLORS_STYLE="COLORS_LONG_SENTENCE",e.SUPPORTED_LANGUAGES="SUPPORTED_LANGUAGES",e.INSTALLED_ATTRIBUTE="INSTALLED_ATTRIBUTE",e.SITE_INIT_ATTRIBUTE="SITE_INIT_ATTRIBUTE",e.INPUT_AREA_INIT_ATTRIBUTE="INPUT_AREA_INIT_ATTRIBUTE",e.TMP_ID_ATTRIBUTE="TMP_ID_ATTRIBUTE",e.AI_RULE_ID_REGEX="AI_RULE_ID_REGEX",e.COLORS_PARAPHRASE="COLORS_PARAPHRASE",e.COLORS_RECOMMENDATION="COLORS_RECOMMENDATION",e.COLORS_RECOMMENDATION_TEASE="COLORS_RECOMMENDATION_TEASE",e.VALID_START_SENTENCE_REGEX="VALID_START_SENTENCE_REGEX",e.VALID_END_SENTENCE_REGEX="VALID_END_SENTENCE_REGEX",e.MULTI_SENTENCE_SELECTION_FOR_PARAPHRASE_ALLOWED="MULTI_SENTENCE_SELECTION_FOR_PARAPHRASE_ALLOWED",e.MAX_TEXT_LENGTH_ALLOWED_FOR_PAGELESS="MAX_TEXT_LENGTH_ALLOWED_FOR_PAGELESS",e.MAX_TEXT_LENGTH_ALLOWED="MAX_TEXT_LENGTH_ALLOWED",e.SELECTED_UNDERLINE_THICKNESS="SELECTED_UNDERLINE_THICKNESS",e.BULLET_POINT_PARSING_PREFIX="BULLET_POINT_PARSING_PREFIX",e.TOOLBAR_SIZE="TOOLBAR_SIZE",e.FIX_ALL_CONFIG="FIX_ALL_CONFIG",e.IGNORE_EDITOR_WITH_ATTRIBUTES="IGNORE_EDITOR_WITH_ATTRIBUTES",e.SHOW_TOOLBAR_ON_EMPTY_INPUT_AREA="SHOW_TOOLBAR_ON_EMPTY_INPUT_AREA",e.MAIN_CONTENT_SCRIPT_FILENAME="MAIN_CONTENT_SCRIPT_FILENAME",e.SPECIAL_INTRODUCTORY_TEASER_ENABLED="SPECIAL_INTRODUCTORY_TEASER_ENABLED",e.TERMS_OF_SERVICE_MODAL_ENABLED="TERMS_OF_SERVICE_MODAL_ENABLED",e.LOLLIPOP_CONFIG="LOLLIPOP_CONFIG",e.NORMALIZE_SPACE="NORMALIZE_SPACE",e.USE_CSS_CUSTOM_HIGHLIGHTS="USE_CSS_CUSTOM_HIGHLIGHTS",e.STRIP_WRAPPING_QUOTES_FROM_SENTENCE="STRIP_WRAPPING_QUOTES_FROM_SENTENCE",e.GDOCS_MENU_BUTTONS="GDOCS_MENU_BUTTONS",e.SUPPORTS_TRIAL="SUPPORTS_TRIAL",e.DISABLE_WHEN_QB_EXTENSION_IS_PRESENT="DISABLE_WHEN_QB_EXTENSION_IS_PRESENT"}(A||(A={}));const C={[A.CHROME_EXTENSION_ID]:"oldceeleldhonbafppcapldpdifcinji",[A.NORMALIZE_SPACE]:!1,[A.SHOW_PARTIAL_RECO_UNDERLINE]:!1,[A.EXTN_PREFIX]:"lt",[A.COLORS_GRAMMAR]:{UNDERLINE:"#f2b24c",SELECTED_UNDERLINE:"#f2b24c",BACKGROUND:"rgba(242,179,77,0.3)",EMPHASIZE:"rgba(241,179,76,0.1)"},[A.COLORS_SPELLING]:{UNDERLINE:"#EB5757",SELECTED_UNDERLINE:"#EB5757",BACKGROUND:"rgba(235,88,88,0.2)",EMPHASIZE:"rgba(239,88,88,0.1)"},[A.COLORS_STYLE]:{UNDERLINE:"#8F7FFF",SELECTED_UNDERLINE:"#8F7FFF",BACKGROUND:"rgba(142,128,255,0.2)",EMPHASIZE:"rgba(138,128,255,0.2)",TITLE:"#5C4CFF"},[A.COLORS_PARAPHRASE]:{UNDERLINE:"#8F7FFF",BACKGROUND:"rgba(142,128,255,0.2)",EMPHASIZE:"rgba(138,128,255,0.2)",TITLE:"#5C4CFF"},[A.COLORS_RECOMMENDATION]:{UNDERLINE:"#80B3E2",SELECTED_UNDERLINE:"#0067C5",BACKGROUND:"rgba(0, 103, 199, 0.16)",EMPHASIZE:"rgba(0, 103, 199, 0.16)"},[A.COLORS_RECOMMENDATION_TEASE]:{UNDERLINE:"#CF9F0280",SELECTED_UNDERLINE:"#CF9F02",BACKGROUND:"rgba(242,181,24,0.16)",EMPHASIZE:"rgba(242,181,24,0.16)"},[A.SUPPORTED_LANGUAGES]:["ar","ast-es","be-by","br-fr","ca-es","ca-es-valencia","crh-ua","da-dk","de-at","de-ch","de-de","el-gr","en-au","en-ca","en-gb","en-nz","en-us","en-za","eo","es","fa","ga-ie","fr","gl-es","it","ja-jp","km-kh","nl","no","pl-pl","pt-ao","pt-br","pt-mz","pt-pt","ro-ro","ru-ru","sk-sk","sl-si","sv","ta-in","tl-ph","uk-ua","zh-cn"],[A.CARD_LAYOUT]:{TARGET_BOX_HORIZONTAL_MARGIN:0,TARGET_BOX_VERTICAL_MARGIN:5,HEADER_HEIGHT:36,FOOTER_HEIGHT:36,KEYBOARD_HINT_HEIGHT:60,MIN_HEIGHT_PARAPHRASE:200,MIN_HEIGHT_TOOLBOX:230,MAX_HEIGHT_TOOLBOX:368},[A.INSTALLED_ATTRIBUTE]:"data-lt-installed",[A.SITE_INIT_ATTRIBUTE]:"data-lt-site",[A.INPUT_AREA_INIT_ATTRIBUTE]:"data-lt-tweaks",[A.TMP_ID_ATTRIBUTE]:"data-lt-tmp-id",[A.AI_RULE_ID_REGEX]:/^(QB|AI)_/,[A.VALID_START_SENTENCE_REGEX]:"[^•]",[A.VALID_END_SENTENCE_REGEX]:".",[A.MULTI_SENTENCE_SELECTION_FOR_PARAPHRASE_ALLOWED]:!1,[A.MAX_TEXT_LENGTH_ALLOWED_FOR_PAGELESS]:15e3,[A.MAX_TEXT_LENGTH_ALLOWED]:1e4,[A.SELECTED_UNDERLINE_THICKNESS]:2,[A.BULLET_POINT_PARSING_PREFIX]:"• ",[A.TOOLBAR_SIZE]:{width:20,height:20},[A.FIX_ALL_CONFIG]:{FIX_GC_ERRORS:!0,FIX_RECOMMENDATIONS:!1,FIX_STYLE_ERRORS:!1},[A.IGNORE_EDITOR_WITH_ATTRIBUTES]:["spellcheck"],[A.SHOW_TOOLBAR_ON_EMPTY_INPUT_AREA]:!1,[A.MAIN_CONTENT_SCRIPT_FILENAME]:"/content.js",[A.SPECIAL_INTRODUCTORY_TEASER_ENABLED]:!0,[A.TERMS_OF_SERVICE_MODAL_ENABLED]:!1,[A.LOLLIPOP_CONFIG]:{LOLLIPOP_THEME:"purple",LOLLIPOP_CSS_PATH:"/content/styles/lollipop.css",ONBOARDING_IMAGE_PATH:"/assets/images/toolbox/lollipop-onboarding-lt.webp",ONBOARDING_BORDER_RADIUS:"8px",LOLLIPOP_CIRCLE_IMAGE_PATH:"/assets/images/toolbox/lollipop-icon.svg",LOLLIPOP_CIRCLE_GDOCS_IMAGE_PATH:"/assets/images/toolbox/lollipop-icon-gdocs.svg",SUPPORTS_DARK_MODE:!0,ONBOARDING_LANDING_PAGE_URL:"https://languagetool.org/text-cursor",TOOLBOX_IFRAME_PATH:"/toolbox/toolbox.html",TOOLBOX_AVAILABLE_UI_LANGUAGES:["de","en","es","fr","nl","pt-br"],PPHR_SUPPORTS_MULTISENTENCE:!0,TOOLBOX_HOTKEY:void 0,TRACKING_SAMPLING_RATE:100,DEEP_LINK_INTO_TOOLBOX:!1},[A.STRIP_WRAPPING_QUOTES_FROM_SENTENCE]:!0,[A.USE_CSS_CUSTOM_HIGHLIGHTS]:!1,[A.GDOCS_MENU_BUTTONS]:!0,[A.SUPPORTS_TRIAL]:!0,[A.DISABLE_WHEN_QB_EXTENSION_IS_PRESENT]:!0};class R{constructor(){this.extnConfig=C}static getInstance(){return this.instance||self._qb_lt_config||(this.instance=new R,self._qb_lt_config=this.instance),this.instance||self._qb_lt_config}get(e){return this.extnConfig[e]}set(e,t){this.extnConfig[e]=t}setAll(e){this.extnConfig=e}getAll(){return this.extnConfig}}const I=R.getInstance();class P{constructor(){this.sessions=new Map,this.editorToSession=new Map,this.uniqueIdentifierToSession=new Map,this.hostOrigin="",this.hostUrl="",this.ongoingReinitializationPromises=new Map,this.ongoingSessionCreationPromises=new Map}static getInstance(e){if(!P.instance&&(P.instance=new P,e))try{const t=new URL(e);P.instance.hostOrigin=t.origin,P.instance.hostUrl=e}catch(t){console.warn("Invalid URL provided, using as-is:",e),P.instance.hostOrigin=e}return P.instance}setHostUrl(e){try{const t=new URL(e);this.hostOrigin=t.origin}catch(t){console.warn("Invalid URL provided, using as-is:",e),this.hostOrigin=e}}getHostUrl(){return this.hostOrigin}async createWritingSession(e,t){if(this.uniqueIdentifierToSession.has(t)){const r=this.uniqueIdentifierToSession.get(t),n=this.sessions.get(r);return n.editorIds.has(e)||(this.removeEditorFromSession(e),n.editorIds.add(e),this.editorToSession.set(e,n.sessionId)),n.sessionId}let r=this.ongoingSessionCreationPromises.get(t);if(r){const t=await r,n=this.sessions.get(t);n&&!n.editorIds.has(e)&&(this.removeEditorFromSession(e),n.editorIds.add(e),this.editorToSession.set(e,t))}else r=this.performSessionCreation(e,t).finally(()=>{this.ongoingSessionCreationPromises.delete(t)}),this.ongoingSessionCreationPromises.set(t,r);return r}joinSession(e,t){const r=this.sessions.get(t);if(r)return this.removeEditorFromSession(e),r.editorIds.add(e),this.editorToSession.set(e,t),r}removeEditorFromSession(e){const t=this.editorToSession.get(e);if(t){const r=this.sessions.get(t);if(r&&(r.editorIds.delete(e),0===r.editorIds.size)){this.sessions.delete(t);for(const[e,r]of this.uniqueIdentifierToSession.entries())if(r===t){this.uniqueIdentifierToSession.delete(e);break}}this.editorToSession.delete(e)}}updateSurroundingContent(e,t){const r=this.sessions.get(e);r&&(r.surroundingContent=t)}getSession(e){const t=this.editorToSession.get(e);if(t)return this.sessions.get(t)}getEditorsInSameSession(e){const t=this.getSession(e);return t?Array.from(t.editorIds):[]}getSessionById(e){return this.sessions.get(e)}async generateSessionId(e,t){return await Cr.createWritingSession(t,e)}async reIntializeWritingSession(e){let t=this.ongoingReinitializationPromises.get(e);return t||(t=this.performReinitialization(e).finally(()=>{this.ongoingReinitializationPromises.delete(e)}),this.ongoingReinitializationPromises.set(e,t)),t}async performReinitialization(e){const t=this.findUniqueIdentifierFromWritingSession(e);if(t){return await Cr.createWritingSession(this.hostUrl,t)}return console.error("No unique identifier found for sessionId:",e),""}async performSessionCreation(e,t){const r=await this.generateSessionId(t,this.hostUrl);if(!r)return"";const n={sessionId:r,editorIds:new Set([e]),surroundingContent:""};return this.removeEditorFromSession(e),this.sessions.set(r,n),this.uniqueIdentifierToSession.set(t,r),this.editorToSession.set(e,r),r}findUniqueIdentifierFromWritingSession(e){for(const[t,r]of this.uniqueIdentifierToSession)if(r===e)return t}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
const L=3e3,y=6e4,b=36e5,O=144e5,N=864e5,w=864e5,v=1500,D=72e5,x=108e5,k=300,U=900,M=5e4,F=30,G=500,B="https://languagetool.org/webextension/welcome",H="https://languagetool.org/webextension/uninstall",W="https://languagetool.org/webextension/login",j="https://languagetool.org/webextension/user",V="https://api.languagetool.org",X="https://rewriting.languagetoolplus.com",$="https://prod-translator.languagetool.org/translator",q=`${V}/v2`,Y="https://api-fallback.languagetool.org/v2",z="https://api.languagetoolplus.com/v2",K="https://languagetoolplus.com/api/v2",Z="http://localhost:8081/v2",Q="https://languagetool.org/send-feedback/",J="https://languagetool.org/webextension_config.json",ee="https://languagetool.org/client-login",te="https://languagetool.org/ping",re="https://languagetool.org/webapi",ne="https://api.languagetoolplus.com/statistics/api/store",se="https://qb-grammar-en.languagetool.org/phrasal-paraphraser/subscribe",ae="https://languagetool.org/users/privacy-policy/",ie=[502,503,504],oe=18e4,ce=4,le=50,ue=I.get(A.MAX_TEXT_LENGTH_ALLOWED),ge=19500,de=ge,he=4e4,me=15e4,_e=Number.MAX_SAFE_INTEGER,pe=50,Ee=5e3,fe=1500,Se=4e3,Te=3e3,Ae=1,Ce=10,Re=20,Ie=3e3,Pe=2e3,Le=3e3,ye=50,be=200,Oe=2e4,Ne=3e5,we=6e5,ve=864e5,De=/@(languagetool(er)?|quillbot|scribbr|learneo|coursehero|symbolab|litcharts|spellboy)\.(com|org|de|nl)$/i,xe={get GRAMMAR(){return I.get(A.COLORS_GRAMMAR)},get STYLE(){return I.get(A.COLORS_STYLE)},get PARAPHRASE(){return I.get(A.COLORS_PARAPHRASE)},get LONG_SENTENCE(){return{UNDERLINE:"#D2CBFF",BACKGROUND:"rgba(210,203,255,0.2)",EMPHASIZE:"rgba(210,203,255,0.1)"}},get IGNORED_RANGE(){return{UNDERLINE:"#00bbe6",BACKGROUND:"rgb(92, 222, 251, 0.2)",EMPHASIZE:"rgb(154, 232, 250, 0.1)"}},get RECOMMENDATION(){return I.get(A.COLORS_RECOMMENDATION)},get RECOMMENDATION_TEASE(){return I.get(A.COLORS_RECOMMENDATION_TEASE)},get SPELLING(){return I.get(A.COLORS_SPELLING)},get SYNONYMS(){return{UNDERLINE:"#0042d7"}},get NEW_SENTENCE(){return{BACKGROUND:"rgba(30, 225, 151, 0.2)"}},get DISABLED(){return{UNDERLINE:"rgba(0, 0, 0, 0.2)",BACKGROUND:"rgba(0, 0, 0, 0.2)",EMPHASIZE:"rgba(0, 0, 0, 0.2)",TITLE:"rgba(0, 0, 0, 0.2)"}}},ke={...xe,DISABLED:{UNDERLINE:"rgba(255, 255, 255, 0.3)",BACKGROUND:"rgba(255, 255, 255, 0.3)",EMPHASIZE:"rgba(255, 255, 255, 0.3)",TITLE:"rgba(255, 255, 255, 0.3)"}},Ue=5,Me=6,Fe=5,Ge=["en","de","fr","nl","es","pt-BR","pt-PT"],Be=["en"],He=["en"],We=!1,je=10,Ve=3,Xe=["de","de-CH","ru","sv","pt","pt-BR","el","en","eo","it","fr","es","uk","sk","sl","pl","da","ro","nl","ca"],$e={UKRAINE:{countries:["UA","BY"],percent:50},"ITALY-DISCOUNT":{countries:["IT"],percent:20},"SPAIN-DISCOUNT":{countries:["ES"],percent:20},SOUTH_EUROPE:{countries:["RO","AL","GR","ME","EE","LT","LV","BG","CY","MT","SK","SI","RS","HR","XK","HU","MD","TR","PT"],percent:20},AFRICA:{countries:["NG","ET","EG","CD","CG","TZ","KE","UG","DZ","SD","MA","AO","MZ","TN","CI","DJ","SZ","MU","GQ","GA","BW","SO","CD","ER","MG"],percent:50},ASIA:{countries:["ID","PK","BD","VN","MM","PH","UZ","MY","NP","KZ","KH","UZ","TH","YE","SY","JO"],percent:50},LATIN_AMERICA:{countries:["PE","VE","EC","SV","DO","BO","SR","AR","HN","BZ","CR","PA","GT","NI","GY","UY","HT","JM","TT","CU"],percent:50},BRAZIL:{countries:["BR"],percent:50}},qe=7776e6,Ye={BASIC:"Basic",PREMIUM:"Premium"},ze=["EN_QUOTES","PASSIVE_VOICE","DASH_RULE","SENTENCE_FRAGMENT","PONCTUATION_DOUBLE","TOO_LONG_SENTENCE","COMETES_TIPOGRAFIQUES","APOSTROF_TIPOGRAFIC","FALSCHE_VERWENDUNG_DES_BINDESTRICHS","HALBGEVIERTSTRICH","PARAGRAF_LEERZEICHEN","TYPOGRAFISCHE_APOSTROPHE","TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN","TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN_CH","TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN_2","PUNCTUATION_PARAGRAPH_END","FINAL_STOPS","FINAL_PUNCTUATION","SMART_QUOTES","PT_SMART_QUOTES","DASH_SPACE_RULES","HIPHEN_SPACE_RULES","BRAK_KROPKI","DYWIZ","CUDZYSLOW_DRUKARSKI","TYPOGRAFISCHE_AANHALINGSTEKENS","TYPOGRAFISCHE_AANHALINGSTEKENS_2","EINDE_ZIN_ONVERWACHT","BACKTICK","GEDACHTESTREEPJE","OPTIONAL_HYPHEN","COMILLAS_TIPOGRAFICAS","COMETES_TIPOGRAFIQUES","GL_SMART_QUOTES"],Ke=["OXFORD_SPELLING_Z_NOT_S"],Ze="jeremy",Qe=[{ruleId:"FALSCHES_ANFUEHRUNGSZEICHEN",suggestions:[{match:/[„“]/,message:"Alle <lt-em>“</lt-em>…<lt-em>”</lt-em> zu <lt-em>„</lt-em>…<lt-em>“</lt-em> ändern"}]},{ruleId:"TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN",suggestions:[{match:/[„“]/,message:"Alle <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> zu <lt-em>„</lt-em>…<lt-em>“</lt-em> ändern"},{match:/(^»)|(«$)/,message:"Alle <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> zu <lt-em>»</lt-em>…<lt-em>«</lt-em> ändern"}]},{ruleId:"TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN_CH",suggestions:[{match:/[„“]/,message:"Alle <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> zu <lt-em>„</lt-em>…<lt-em>“</lt-em> ändern"},{match:/(^«)|(»$)/,message:"Alle <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> zu <lt-em>«</lt-em>…<lt-em>»</lt-em> ändern"}]},{ruleId:"TYPOGRAFISCHE_ANFUEHRUNGSZEICHEN_2",suggestions:[{match:/[‚‘]/,message:"Alle <lt-em>'</lt-em>…<lt-em>'</lt-em> zu <lt-em>‚</lt-em>…<lt-em>‘</lt-em> ändern"},{match:/[„“]/,message:"Alle <lt-em>'</lt-em>…<lt-em>'</lt-em> zu <lt-em>„</lt-em>…<lt-em>“</lt-em> ändern"}]},{ruleId:"TYPOGRAFISCHE_APOSTROPHE",suggestions:[{match:/’/,message:"Alle Apostrophe zu <lt-em>’</lt-em> ändern"}]},{ruleId:"EN_QUOTES",suggestions:[{match:/[“”]/,message:"Change all <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> to <lt-em>“</lt-em>…<lt-em>”</lt-em>"}]},{ruleId:"WRONG_APOSTROPHE",suggestions:[{match:/'/,message:"Use <lt-em>'</lt-em> for all bad apostrophes"},{match:/’/,message:"Use <lt-em>’</lt-em> for all bad apostrophes"}]},{ruleId:"PARAGRAF_LEERZEICHEN",suggestions:[{match:/§\u00A0/,message:"Alle Leerzeichen nach <lt-em>§</lt-em> ändern"}]},{ruleId:"CONSISTENCYRULE_JE_F",suggestions:[{match:/[^e]$/,message:"Remplacer tous les <lt-em>je</lt-em> vers le masculin"}]},{ruleId:"CONSISTENCYRULE_JE_M",suggestions:[{match:/e$/,message:"Remplacer tous les <lt-em>je</lt-em> vers le féminin"}]},{ruleId:"COMILLAS_TIPOGRAFICAS",suggestions:[{match:/[“”]/,message:"Cambiar todas las <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> por <lt-em>“</lt-em>…<lt-em>”</lt-em>"},{match:/(^«)|(»$)/,message:"Cambiar todas las <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> por <lt-em>«</lt-em>…<lt-em>»</lt-em>"}]},{ruleId:"COMETES_TIPOGRAFIQUES",suggestions:[{match:/[“”]/,message:"Canvia totes les <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> per <lt-em>“</lt-em>…<lt-em>”</lt-em>"},{match:/(^«)|(»$)/,message:"Canvia totes les <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> per <lt-em>«</lt-em>…<lt-em>»</lt-em>"}]},{ruleId:"TYPOGRAFISCHE_AANHALINGSTEKENS",suggestions:[{match:/[„“]/,message:"Alle <lt-em>&quot;</lt-em>…<lt-em>&quot;</lt-em> veranderen in <lt-em>„</lt-em>…<lt-em>“</lt-em>"}]},{ruleId:"PT_SMART_QUOTES",suggestions:[{match:/[“”]/,message:"Corrigir todas as aspas."}]},{ruleId:"GL_SMART_QUOTES",suggestions:[{match:/[“”]/,message:"Corrixir todas as comiñas."}]}],Je=["en","de","es","ca","fr","nl","pt"],et=["ar","he","fa","ur","ku","az"],tt=["de","fr"],rt=3,nt=/^[ \u00A0]|[ \u00A0]$/g,st=/\u202F/g,at=/[\"“”„]$/,it=/^[\"“”„]/,ot="E_ABORT",ct="E_PAYLOAD_TOO_LARGE",lt="E_TIMEOUT",ut="E_GENERIC",gt={borderRadiusSmall:4,borderRadiusMedium:8,borderRadiusLarge:12,light:{colorBrandDefault:"#239AFF",colorBrandMedium:"#5EB5FF",colorBrandSubtle:"#ECF6FF",colorBrandBold:"#1976F0",colorTextDefault:"#2F3237",colorTextBold:"#1D1E20",colorTextSubtle:"#5E636E",colorTextStark:"#000000",colorTextInverseDefault:"#F1F3F9",colorTextInverseBold:"#FFFFFF",colorTextSelected:"#239AFF",colorTextLinkDefault:"#239AFF",colorTextLinkPressed:"#1976F0",colorTextLinkInverse:"#FFFFFF",colorTextDisabled:"#8F96A3",colorTextErrorBold:"#D01941",colorTextWarningBold:"#AB7D05",colorTextInfoBold:"#1976F0",colorTextHighlightBold:"#3729C1",colorTextSuccessBold:"#08905D",colorBorderDefault:"#DEE3ED",colorBorderSubtle:"#F1F3F9",colorBorderMedium:"#C2C9D6",colorBorderBold:"#8F96A3",colorBorderHover:"#5E636E",colorBorderSelected:"#1976F0",colorBackgroundDefault:"#FFFFFF",colorBackgroundPaper:"#FFFFFF",colorBackgroundElevated:"#FFFFFF",colorBackgroundSunken:"#F1F3F9",colorBackgroundNeutralDefault:"#F1F3F9",colorBackgroundNeutralMedium:"#C2C9D6",colorBackgroundNeutralMuted:"#DEE3ED",colorBackgroundHighlightSubtle:"#ECF6FF",colorBackgroundInfoSubtle:"#ECF6FF",colorBackgroundWarningSubtle:"#FFF6E0",colorBackgroundSuccessSubtle:"#E2FFF4",colorBackgroundErrorSubtle:"#FFEEF2",colorBackgroundInverseDefault:"#1D1E20",colorBackgroundInverseBold:"#111213",colorBackgroundDisabled:"#DBDBDB",colorIconDefault:"#2F3237",colorIconBold:"#1D1E20",colorIconSubtle:"#5E636E",colorIconInverseDefault:"#F1F3F9",colorIconInverseBold:"#FFFFFF",colorIconSelected:"#239AFF",colorIconDisabled:"#8F96A3",colorIconBoldest:"#000000"},dark:{colorBrandDefault:"#5EB5FF",colorBrandMedium:"#239AFF",colorBrandSubtle:"#041A37",colorBrandBold:"#BADFFF",colorTextDefault:"#F1F3F9",colorTextBold:"#F8F9FC",colorTextSubtle:"#DEE3ED",colorTextStark:"#FFFFFF",colorTextInverseDefault:"#2F3237",colorTextInverseBold:"#000000",colorTextSelected:"#5EB5FF",colorTextLinkDefault:"#5EB5FF",colorTextLinkPressed:"#BADFFF",colorTextLinkInverse:"#111213",colorTextDisabled:"#C2C9D6",colorTextErrorBold:"#FF7A94",colorTextWarningBold:"#DEC850",colorTextInfoBold:"#5EB5FF",colorTextHighlightBold:"#9E94FE",colorTextSuccessBold:"#1EE197",colorBorderDefault:"#2F3237",colorBorderSubtle:"#1D1E20",colorBorderMedium:"#5E636E",colorBorderBold:"#8F96A3",colorBorderHover:"#C2C9D6",colorBorderSelected:"#5EB5FF",colorBackgroundDefault:"#111213",colorBackgroundPaper:"#2F3237",colorBackgroundElevated:"2F3237",colorBackgroundSunken:"#2F3237",colorBackgroundNeutralDefault:"#2F3237",colorBackgroundNeutralMedium:"#8F96A3",colorBackgroundNeutralMuted:"#5E636E",colorBackgroundHighlightSubtle:"#041A37",colorBackgroundInfoSubtle:"#041A37",colorBackgroundWarningSubtle:"#2B2003",colorBackgroundSuccessSubtle:"#021B12",colorBackgroundErrorSubtle:"#26020A",colorBackgroundInverseDefault:"#C2C9D6",colorBackgroundInverseBold:"#F1F3F9",colorBackgroundDisabled:"#434343",colorIconDefault:"#F1F3F9",colorIconBold:"#F8F9FC",colorIconSubtle:"#DEE3ED",colorIconInverseDefault:"#2F3237",colorIconInverseBold:"#111213",colorIconSelected:"#5EB5FF",colorIconDisabled:"#C2C9D6",colorIconBoldest:"#FFFFFF"},fontFamily:{macos:"LanguageTool-mac",win:"LanguageTool-win"},fontSizes:{xSmall:10,small:12,medium:14,large:16,xLarge:18}},dt="2024-11-19",ht="https://languagetool.org/legal/terms",mt="https://languagetool.org/legal/privacy",_t="⁣",pt=`data-${I.get(A.EXTN_PREFIX)}-editor-group`,Et="standard",ft="simple",St="formal",Tt="fluency",At="academic",Ct="creative",Rt="expand",It="shorten",Pt="natural",Lt=[".","!","?"],yt=["Shift","Control","Alt","Meta"],bt=12096e5,Ot=8e3,Nt=288e5,wt="TRIAL",vt=/school|schule|bildung|academ|colegio|college|escola|universi|\.edu\b|educat|gnspes\.ca|dwightlondon\.org|k12\.nj\.us/i,Dt="[data-qb-installed=true]";let xt,kt;try{xt=new RegExp("\\p{L}","u")}catch(e){xt=/[a-zäöüß]/i}function Ut(e){return xt.test(e)}try{kt=new RegExp("(?:\\p{Emoji}|\\u200d|\\ufe0e|\\ufe0f)","u")}catch(e){kt=/_^/}const Mt=e=>!!e&&Object.getPrototypeOf(e)===Object.prototype,Ft=e=>"function"==typeof e,Gt=e=>"string"==typeof e,Bt=["\b","\t"," "," "," "," "," "," "," "," "," "," ","‏","　"];const Ht=new RegExp("["+Bt.join("")+"]","g");const Wt=["­","​","‌","‍","‪","‫","‬","‭","⁠","\ufeff"];new RegExp("["+Wt.join("")+"]");new RegExp("["+Wt.join("")+"]","g");const jt=new RegExp("^"+_t+"+");const Vt=new RegExp(_t+"+$");const Xt=function(){const e=/^[A-ZÈÉÊÁÀÂÓÒÔÚÙÛÍÌÎÄÜÖ]+[A-ZÈÉÊÁÀÂÓÒÔÚÙÛÍÌÎÄÜÖ\-!?#@=%().:;<>'’´`"”“*+,\s]+[A-ZÈÉÊÁÀÂÓÒÔÍÌÎÄÜÖ]$/;return function(t){return e.test(t)}}();function $t(e,t){const{start:r,end:n=r}=t||{start:-1};if(!e||-1===r)return;const s=e.map(e=>Array.isArray(e)?e:[e.start,e.end]).findIndex(([e,t])=>r>=e&&n<=t);return s<0?void 0:e[s]}let qt,Yt,zt,Kt;!function(){const e=/(?:\S+\s+){0,4}\S+$/,t=/^\S+(?:\s+\S+){0,4}/;qt=(e,t,r=t,n=!0)=>{const[s,a]=(()=>{try{const e=n?"":["\\p{Emoji}","\\u200d","\\ufe0e","\\ufe0f"].join("");return[new RegExp("^\\s*(-?[\\p{L}#*"+e+"]+){0,3}-?\\s*$","u"),new RegExp("^\\s*[\\p{L}#*"+e+"]+(-[\\p{L}#*"+e+"]+){0,3}\\s*$","u")]}catch{return[/^\s*(-?[a-zäöüß#*]+){0,3}-?\s*$/i,/^\s*[a-zäöüß#*]+(-[a-zäöüß#*]+){0,3}\s*$/i]}})(),i=e=>{return!n&&(t=e,kt.test(t));var t},o=e.substring(t,r),[{length:c=0}]=o.match(/^[^\S]*/),[{length:l=0}]=o.match(/[^\S]*$/);if(!s.test(o))return null;const u=(()=>{const r=t+c,n=e.substring(0,r).split(/[^\S]+/);return ir(n[n.length-1]).reverse()})(),g=(()=>{const t=r-l,[n]=e.substring(t).split(/[^\S]+/);return ir(n)})(),d=Math.max(u.length,g.length);let h=!1,m=!1,_=t,p=r;for(let e=0;e<d;e++){const t=u[e],r=t&&(Ut(t)||i(t)||"-"===t),n=g[e],s=n&&(Ut(n)||i(n)||"-"===n);if(r&&!h?_-=t.length:h=!0,s&&!m?p+=n.length:m=!0,h&&m)break}c>0&&(_+=c),l>0&&(p-=l);const E=e.substring(_,p);return a.test(E)?{start:_,end:p}:null},Yt=(r,n,s=n,a,i=!0)=>{const o=qt(r,n,s,i);if(!o)return null;const c=$t(a,{start:n,end:s});let l="",u="",g="";if(c)g=r.substring(c.start,c.end).trim(),l=r.slice(c.start,o.start).trim(),u=r.slice(o.end,c.end).trim();else{const n=e.exec(r.substring(0,o.start).trim());l=n?n[0]:"",l=l.replace(/^.+\n\n/,"");const s=t.exec(r.substring(o.end).trim());u=s?s[0]:"",u=u.replace(/\n\n.+/,"")}return{word:r.substring(o.start,o.end),position:o,sentence:g,beforeText:l,afterText:u}}}(),function(){let e;const t=[['"','"'],["'","'"],["“","”"],["„","“"],["‘","’"],["‚","‘"],["«","»"],["»","«"],["`","`"],["´","´"],["{","}"],["[","]"],["(",")"],["<",">"]],r="[^\\S]",n="[.,:;¡!¿?]",s="[\\udc00-\\udfff\\ud800-\\udb7f\\u200d\\ufe0e\\ufe0f\\p{Emoji_Presentation}\\p{Emoji_Modifier}\\p{Emoji}]";let a,i,o,c;const l=/(?:\S+\s+){0,4}\S+$/,u=/^\S+(?:\s+\S+){0,4}/;try{const t=[r,n,s].join("|");a=new RegExp(`(?:${t})`,"u"),i=new RegExp(`^(?:${t})*`,"u"),o=new RegExp(`(?:${t})*$`,"u"),e=new RegExp("^\\s*\\p{L}+(-\\p{L}+)*\\s*$","u"),c=new RegExp("^\\p{L}+$","u")}catch{const t=[r,n].join("|");a=new RegExp(`(?:${t})`),i=new RegExp(`^(?:${t})*`),o=new RegExp(`(?:${t})*$`),e=/^\s*[a-zäöüß]+(-[a-zäöüß]+)*\s*$/i,c=/^[a-zäöüß]+$/i}zt=(n,s,l=s,u)=>{const g=n.substring(s,l),d=s===l,h=d?n.substring(s-1,l):"",m=d?n.substring(s,l+1):"",_=!!d&&0===[h,m].filter(e=>!!e.match(c)).length,p=g.split(new RegExp(`${r}+`)).length>5,[E=""]=g.match(i),[f=""]=g.match(o),S=E.length,T=f.length,A=[E.trim(),f.trim()];if(_||p)return null;const C=function(e,t){const{start:r}=t||{start:-1};if(!e||-1===r)return;const n=e.sort((e,t)=>e.start-t.start).find(e=>{if(r<=e.end&&r>=e.start)return!0});return n||void 0}(u,{start:s,end:l})?.start||0,R=function(e,t){const{end:r}=t||{end:-1};if(!e||void 0===r||-1===r)return;const n=e.sort((e,t)=>e.start-t.start).find(e=>{if(r<=e.end&&r>=e.start)return!0});return n||void 0}(u,{start:s,end:l})?.end||n.length-1;let I=s+S;for(;I>C;){const[e]=n[I-1].match(a)||[];if(e){0===S&&(A[0]+=e.trim());break}I--}let P=l-1-T;for(;P<R-1;){const[e]=n[P+1].match(a)||[];if(e){0===T&&(A[1]+=n[P+1].trim());break}P++}if(P+=1,I===C&&P===R)return null;const L=n.substring(I,P);if(L.split(e).length>=6)return null;let y=!1,b=!1;for(const[e,r]of t){y||!L.startsWith(e)||L.slice(1).includes(r)||(I+=1,y=!0,A[0]+=L[0]);const t=L.length-1;b||!L.endsWith(r)||L.slice(0,t).includes(e)||(P-=1,b=!0,A[1]+=L[t])}return{start:I,end:P,omittedCharacters:A}},Kt=(e,t,r=t,n)=>{let s=zt(e,t,r,n);if(!s)return null;const a=$t(n,{start:t,end:r});s=(()=>{if(!a)return s;const t=e.slice(a.start,s.start),r=e.slice(s.end,a.end),n=!t||!!t.match(/^[¡¿]+$/),i=!r||!!r.match(/^[.!?]+$/);return n&&i&&(s={start:a.start,end:a.end,omittedCharacters:["",""]}),s})();let i="",o="",c="";if(a)c=e.substring(a.start,a.end).trim(),i=e.slice(a.start,s.start).trim(),o=e.slice(s.end,a.end).trim();else{const t=l.exec(e.substring(0,s.start).trim());i=t?t[0]:"",i=i.replace(/^.+\n\n/,"");const r=u.exec(e.substring(s.end).trim());o=r?r[0]:"",o=o.replace(/\n\n.+/,"")}return Kt.trackOmittedCharacters?.(s.omittedCharacters),{phrase:e.substring(s.start,s.end),position:{start:s.start,end:s.end},sentence:c,beforeText:i,afterText:o}}}();const Zt=e=>{const t=_t.charCodeAt(0).toString(16),r=new RegExp(`^(?:[^\\S]|•|\\u${t})+$`),n=new RegExp(`^(?:[^\\S]|\\u${t})+$`),s=e.split("").reverse().join(""),a=Math.floor(e.length/2);let i,o,c=0,l=0;for(let t=0;t<a;t++){const a=e.charAt(t),u=s.charAt(t);if(!0!==i&&a.match(r)?(c+=1,i=!1):i=!0,!0!==o&&u.match(n)?(l+=1,o=!1):o=!0,i&&o)break}return[c,l]};function Qt(e,t){if(e===t)return null;let r=0;const n=Math.max(e.length,t.length);for(r=0;r<n&&e[r]===t[r];r++);let s=0;const a=Math.min(e.length,t.length);for(;r+s<a;){if(e[e.length-s-1]!==t[t.length-s-1])break;s++}return{from:r,oldFragment:e.substring(r,e.length-s),newFragment:t.substring(r,t.length-s)}}function Jt(e,t,r=!1){const n=[];r&&(e=pr(e),t=pr(t));const s=e.split("\n"),a=t.split("\n");let i=0;const o=Math.max(s.length,a.length);for(i=0;i<o&&s[i]===a[i];i++);let c=0;const l=Math.min(s.length,a.length);for(;i+c<l;){if(s[s.length-c-1]!==a[a.length-c-1])break;c++}let u=0;for(let e=0;e<i;e++)u+=s[e].length+1;let g=u;for(let e=i;e<o-c;e++){const t=e<s.length-c?s[e]:null,r=e<a.length-c?a[e]:null;t===r&&u===g||n.push({oldText:t,newText:r,oldOffset:u,newOffset:g,textDiff:Qt(t||"",r||"")}),null!==t&&(u+=t.length+1),null!==r&&(g+=r.length+1)}if(u!==g)for(let e=c-1;e>=0;e--){const t=s[s.length-e-1],r=a[a.length-e-1];n.push({oldText:t,newText:r,oldOffset:u,newOffset:g,textDiff:null}),u+=t.length+1,g+=r.length+1}return n}function er(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/`/g,"&#x60;").replace(/\//g,"&#x2F;")}function tr(e,t){let r=0,n=e.length-1;for(;r<=n;){const s=r+Math.ceil((n-r)/2),a=t(e[s]);if(a>0)r=s+1;else{if(!(a<0)){for(let r=s;r>0;r--)if(0!==t(e[r-1]))return e[r];return e[0]}n=s-1}}return null}function rr(e){const t=[];return e.forEach(e=>{-1===t.indexOf(e)&&t.push(e)}),t}function nr(e){return null===e||"object"!=typeof e?e:e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e):Array.isArray(e)?Array.from(e):Object.assign({},e)}function sr(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e);if(e instanceof RegExp)return new RegExp(e);const t=Array.isArray(e)?[]:{};for(const r in e)t[r]=sr(e[r]);return t}let ar=null;function ir(e){return Intl.Segmenter?(ar||(ar=new Intl.Segmenter(void 0,{granularity:"grapheme"})),Array.from(ar.segment(e),e=>e.segment)):[...e]}function or(){if("about:blank"===location.href||"about:srcdoc"===location.href)try{return(self.opener||self.parent).location.href}catch(e){}return location.href}function cr(e,t=e){if(e.startsWith("about:blank"))return"blank";if(e.startsWith("about:srcdoc"))return"srcdoc";if(e.startsWith("file:"))return"file";e&&!/^([a-z\-]+:\/\/)/i.test(e)&&(e="http://"+e);try{return new URL(e).hostname}catch(e){return t}}function lr(e){return cr(e).toLowerCase().trim().replace(/^www\./,"")}function ur(e,t){const r=lr(t);return(e||[]).some(e=>{const t=lr(e);return t===r||r.endsWith("."+t)})}var gr;!function(e){e.GC="GC",e.GC_RECOMMENDATION="GC_RECOMMENDATION",e.REPHRASING="PPHR"}(gr||(gr={}));const dr=function(){const e=/^\w+\.$/;return(t,r)=>{if(!t.isSpellingError)return!1;let n=t.originalPhrase;if(e.test(n)&&(n=n.substring(0,n.length-1)),r.includes(n))return!0;if(function(e){const t=e.charAt(0);return t===t.toUpperCase()&&t!==t.toLowerCase()}(n)){const e=(s=n).charAt(0).toLowerCase()+s.substr(1);if(r.includes(e))return!0}var s;return!1}}();!function(){const e=/[\u0300-\u036f]/g,t=/\u0142/g,r=/\u00F8/g}();function hr(e,t,r,n,s=!1){return s?e<=n&&t>=r:e<n&&t>r}function mr(e,t,r,n=!1){if(n){if(t<=e&&e<r)return 0}else if(t<=e&&e<=r)return 0;return e-t}async function _r(e,t,r,n){if(t.signal)throw new Error("cannot fetchWithTimeout if 'signal' is already set");const s=n??new AbortController;t.signal=s.signal;const a=self.setTimeout(()=>{n?.signal.removeEventListener("abort",i),s.abort()},r),i=()=>{clearTimeout(a)};return n?.signal.addEventListener("abort",i),await fetch(e,t).finally(()=>{clearTimeout(a)})}const pr=e=>{return(t=e,t.replace(Ht," ")).replace(/[\u00A0]/g," ").normalize();var t};let Er="claudia";async function fr(){const e=function(){const e="object".indexOf("o")>-1;return Er=e?Ze:Er,("__"+Er+"::"+~~(+new Date/1e3)).substring(2,64)}();return await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(r)).map(e=>e.toString(16).padStart(2,"0")).join("")}(e)}const Sr=I.get(A.EXTN_PREFIX);function Tr(e,t,r){const n=new CustomEvent(t,{detail:r,cancelable:!0});return e.dispatchEvent(n)}class Ar{}Ar.eventNames={sentenceRangesChecked:`${Sr}-environmentAdapter.sentenceRangesChecked`,incrementalCheckResponseReceived:`${Sr}-environmentAdapter.incrementalCheckResponseReceived`};const Cr=class{static _onMessage(e){switch(!0){case"sentence-splitter-response"===e.command:{const{checkTimestamp:t,sentenceRangesCheckedText:r,sentenceRangesCheckResult:n,sentenceRanges:s}=e.payload;return this.updateSentenceRanges(r,n,t,s),Promise.resolve()}case"reintialize-writing-session"===e.command:{const{sessionId:t}=e.payload;return t?P.getInstance(or()).reIntializeWritingSession(t):Promise.reject("writing session not found")}case e.command===f:{const{payload:t}=e;return this.onEditorStateSyncAck(t),Promise.resolve()}case e.command===S:{const{payload:t}=e;return this.onEditorStateForceSync(t),Promise.resolve()}case e.command===T:{const{payload:t}=e;return this.onEditorSurroundingContextForceSync(t),Promise.resolve()}case"incremental-check-response"===e.command:{const{currentCheckedText:t,data:r,instanceId:n,paragraph:s,previousCheckedText:a}=e.payload;return this.incrementalCheck(n,r,t,a,s),Promise.resolve()}}}static init(e){this._instance?this._instance=e:(this._instance=e,this.addEventListener())}static onEditorStateForceSync(e){Tr(document,S,e)}static onEditorSurroundingContextForceSync(e){Tr(document,T,e)}static onEditorStateSyncAck(e){Tr(document,f,e)}static isProductionEnvironment(){return this._instance.isProductionEnvironment()}static addEventListener(){return this._instance.addEventListener(e=>this._onMessage(e))}static isRuntimeConnected(){return this._instance.isRuntimeConnected()}static getVersion(){return this._instance.getVersion()}static getTrackingId(){return this._instance.getTrackingId()}static getPinnedState(){return this._instance.getPinnedState()}static shouldTrack(){return this._instance.shouldTrack()}static getType(){return this._instance.getType()}static getBeforeUnloadEventName(){return this._instance.getBeforeUnloadEventName()}static getURL(e){return this._instance.getURL(e)}static getUILanguageCode(){return this._instance.getUILanguageCode()}static openWindow(e){return this._instance.openWindow(e)}static canLoadContentScripts(e){return this._instance.canLoadContentScripts(e)}static loadContentScripts(e,t){return this._instance.loadContentScripts(e,t)}static loadStylesheets(e,t){return this._instance.loadStylesheets(e,t)}static injectShadowStyles(e){return this._instance.injectShadowStyles(e)}static initializeLTAssistant(e,t={}){return this._instance.initializeLTAssistant(e,t)}static getPreferredLanguages(){return this._instance.getPreferredLanguages()}static startDictionarySync(){return this._instance.startDictionarySync()}static addWordToDictionary(e){return this._instance.addWordToDictionary(e)}static addWordsToDictionary(e){return this._instance.addWordsToDictionary(e)}static removeWordFromDictionary(e){return this._instance.removeWordFromDictionary(e)}static clearDictionary(){return this._instance.clearDictionary()}static updateDictionary(){return this._instance.updateDictionary()}static updateSentenceRanges(e,t,r,n){this._instance.updateSentenceRanges(e,t,r,n)}static incrementalCheck(e,t,r,n,s){this._instance.incrementalCheck(e,t,r,n,s)}static injectExecutor(){return this._instance.injectExecutor()}static destroyExecutor(){return this._instance.destroyExecutor()}static executeScript(e,t){return this._instance.executeScript(e,t)}static linkInputAreaProperties(e){return this._instance.linkInputAreaProperties(e)}static ping(){return this._instance.ping()}static loadSynonyms(e,t,r){return this._instance.loadSynonyms(e,t,r)}static abortSynonymsRequest(){return this._instance.abortSynonymsRequest()}static loadPhrases(e,t,r,n,s,a){return this._instance.loadPhrases(e,t,r,n,s,a)}static initializeUserActivity(e){return this._instance.initializeUserActivity(e)}static sendUserActivityPings(e){return this._instance.sendUserActivityPings(e)}static updateUserActivityTextStatistics(e,t){return this._instance.updateUserActivityTextStatistics(e,t)}static updateUserActivityAppliedSuggestions(e,t,r){return this._instance.updateUserActivityAppliedSuggestions(e,t,r)}static updateUserActivityAppliedRewritings(e){return this._instance.updateUserActivityAppliedRewritings(e)}static updateUserActivityMeta(e,t){return this._instance.updateUserActivityMeta(e,t)}static sendUserActivity(e){return this._instance.sendUserActivity(e)}static destroyUserActivity(e){return this._instance.destroyUserActivity(e)}static abortPhraseRequests(e){return this._instance.abortPhraseRequests(e)}static abortTranslateRequest(e){this._instance.abortTranslateRequest(e)}static loadSplitSentence(e,t,r,n,s){return this._instance.loadSplitSentence(e,t,r,n,s)}static trackEvent(e,t){return this._instance.trackEvent(e,t)}static pageLoaded(e,t,r,n,s){return this._instance.pageLoaded(e,t,r,n,s)}static ltAssistantStatusChanged(e,t){return"number"==typeof e?this._instance.ltAssistantStatusChanged(e,t):this._instance.ltAssistantStatusChanged(e)}static check(e,t,r,n,s,a,i,o,c){return this._instance.check(e,t,r,n,s,a,i,o,c)}static createWritingSession(e,t){return this._instance.createWritingSession(e,t)}static fetchRecommendationForSentence(e){return this._instance.fetchRecommendationForSentence(e)}static unlockRecommendation(e){return this._instance.unlockRecommendation(e)}static translateText(e){return this._instance.translateText(e)}static isOptionsPageSupported(){return this._instance.isOptionsPageSupported()}static openOptionsPage(e,t){return this._instance.openOptionsPage(e,t)}static isFeedbackFormSupported(){return this._instance.isFeedbackFormSupported()}static openFeedbackForm(e,t,r){return this._instance.openFeedbackForm(e,t,r)}static openPremiumPage(e,t=0,r=0,n=0,s="",a){return this._instance.openPremiumPage(e,t,r,n,s,a)}static updateSurroundingTextContext(e){return this._instance.updateSurroundingTextContext(e)}static forceSyncEditorState(e){return this._instance.forceSyncEditorState(e)}static checkForPaidSubscription(){return this._instance.checkForPaidSubscription()}static canUseShadowDom(){return this._instance.canUseShadowDom()}static abortAllRequests(e){return this._instance.abortAllRequests(e)}static getTermsOfServiceInfo(e){return this._instance.getTermsOfServiceInfo(e)}static acceptTermsOfService(e){return this._instance.acceptTermsOfService(e)}static syncUserData(){return this._instance.syncUserData()}};class Rr{static merge(e,t=!1,r=!1,n=!1){let{errors:s,pickyErrors:a,premiumErrors:i,premiumPickyErrors:o,sentenceRanges:c=[],recommendationErrors:l=[]}=this.filterAndMigrateErrors(e.existing.errors,e.existing.pickyErrors,e.existing.premiumErrors,e.existing.premiumPickyErrors,e.existing.recommendationErrors,e.existing.sentenceRanges,e.existingCheckedText,e.newCheckedText,e.existingRecommendationCheckedText,e.newRecommendationCheckedText,r,n);this.mergeParagraphLevelErrors(s,a,i,o,l,c,e.new.paragraphLevel.errors,e.new.paragraphLevel.pickyErrors,e.new.paragraphLevel.premiumErrors,e.new.paragraphLevel.premiumPickyErrors,e.new.paragraphLevel.recommendationErrors||[],e.new.paragraphLevel.sentenceRanges),this.mergeTextLevelErrors(s,a,i,o,e.new.textLevel.errors,e.new.textLevel.pickyErrors,e.new.textLevel.premiumErrors,e.new.textLevel.premiumPickyErrors);const u=this.getDuplicateErrors(e.existing,e.existingCheckedText,e.newCheckedText,e.existingRecommendationCheckedText,e.newRecommendationCheckedText);return this.sortErrors(s,a,i,o,l),this.setIdsOnErrors(s,a,i,o,l,u),s=this.migrateOffsetsToOriginalText(s,e.newCheckedText.usedParts),a=this.migrateOffsetsToOriginalText(a,e.newCheckedText.usedParts),i=this.migrateOffsetsToOriginalText(i,e.newCheckedText.usedParts),o=this.migrateOffsetsToOriginalText(o,e.newCheckedText.usedParts),l=this.migrateOffsetsToOriginalText(l,e.newRecommendationCheckedText.usedParts),c=this.migrateOffsetsToOriginalText(c,e.newCheckedText.usedParts),t&&(a=a.filter(e=>!ze.includes(e.rule.id)),a.forEach(e=>{e.rule.id="HIDDEN_RULE",e.fixes=[]}),i=[...i,...o,...a],o=[],a=[],this.sortErrorsByOffset(i)),{errors:s,pickyErrors:a,premiumErrors:i,premiumPickyErrors:o,recommendationErrors:l,sentenceRanges:c}}static getDuplicateErrors(e,t,r,n,s){let{errors:a,pickyErrors:i,premiumErrors:o,premiumPickyErrors:c,recommendationErrors:l=[]}=e;a=this.migrateOffsetsToValuableText(a,t.usedParts),i=this.migrateOffsetsToValuableText(i,t.usedParts),o=this.migrateOffsetsToValuableText(o,t.usedParts),c=this.migrateOffsetsToValuableText(c,t.usedParts),l=this.migrateOffsetsToValuableText(l,n.usedParts);const u=Jt(t.text,r.text),g=Jt(n.text,s.text),d=(e,t)=>{if(!e.isParagraphLevelCheck)return!0;const r=tr(t,t=>{const r=t.oldOffset;if(null===t.oldText)return e.start>=r?1:-1;const n=t.oldOffset+t.oldText.length+1;return mr(e.start,r,n,!0)});return!(!r||!r.textDiff)||void 0};return a=a.filter(e=>d(e,u)),i=i.filter(e=>d(e,u)),o=o.filter(e=>d(e,u)),c=c.filter(e=>d(e,u)),l=l.filter(e=>d(e,g)),a=this.migrateOffsetsBetweenTexts(a,u),i=this.migrateOffsetsBetweenTexts(i,u),o=this.migrateOffsetsBetweenTexts(o,u),c=this.migrateOffsetsBetweenTexts(c,u),l=this.migrateOffsetsBetweenTexts(l,g),{errors:a,pickyErrors:i,premiumErrors:o,premiumPickyErrors:c,recommendationErrors:l}}static migrateOffsetsToValuableText(e,t){const r=[];for(const n of e){const e=tr(t,e=>mr(n.start,e.originalStart,e.originalEnd,!0)),s=tr(t,e=>mr(n.end,e.originalStart,e.originalEnd));if(!e||!s)continue;const a=sr(n);a.start-=e.posDiff,a.end-=s.posDiff,a.length=a.end-a.start,r.push(a)}return r}static migrateOffsetsBetweenTexts(e,t,r,n,s,a){let i,o=!1,c=!1,l=!1;"string"==typeof t&&"string"==typeof r?(i=Jt(t,r),o="boolean"==typeof n&&n,c="boolean"==typeof s&&s,l="boolean"==typeof a&&a):(i=t,o="boolean"==typeof r&&r,c="boolean"==typeof n&&n,l="boolean"==typeof s&&s);const u=[];for(const t of e){const e=tr(i,e=>{const r=e.oldOffset;if(null===e.oldText)return t.start>=r?1:-1;const n=e.oldOffset+e.oldText.length+1;return mr(t.start,r,n,!0)}),r=sr(t);if(e){if(e.textDiff){if(o)continue;{const t=e.oldOffset+e.textDiff.from,n=t+e.textDiff.oldFragment.length,s=!c;if(hr(t,n,r.start,r.end,s)){if(l){if(r.start>t&&r.end<n)continue;const s=e.textDiff.newFragment.length-e.textDiff.oldFragment.length;r.start>t&&(r.start=r.start+s),r.end>=t&&(r.end=r.end+s),r.length=r.end-r.start,r?.rule?.phraseDiff?.forEach(r=>{const n=e.textDiff.newFragment.length-e.textDiff.oldFragment.length;r.sourceStart>t&&(r.sourceStart+=n),r.sourceEnd>t&&(r.sourceEnd+=n)}),u.push(r)}continue}if(r.start>=n){const t=e.textDiff.newFragment.length-e.textDiff.oldFragment.length;r.start+=t,r.end+=t,r?.rule?.phraseDiff?.forEach(e=>{e.sourceStart+=t,e.sourceEnd+=t,e.targetEnd+=t,e.targetStart+=t})}}}r.start+=e.newOffset-e.oldOffset,r.end=r.start+r.length,r?.rule?.phraseDiff?.forEach(t=>{const r=t.sourceEnd-t.sourceStart,n=t.targetEnd-t.targetStart;t.sourceStart+=e.newOffset-e.oldOffset,t.sourceEnd=t.sourceStart+r,t.targetStart+=e.newOffset-e.oldOffset,t.targetEnd=t.targetStart+n})}u.push(r)}return u}static migrateOffsetsToOriginalText(e,t){const r=[];for(const n of e){const e=tr(t,e=>mr(n.start,e.start,e.end,!0)),s=tr(t,e=>mr(n.end,e.start,e.end));if(!e||!s)continue;const a=sr(n);a.start+=e.posDiff,a.end+=s.posDiff,a.length=a.end-a.start,r.push(a)}return r}static filterAndMigrateErrors(e,t,r,n,s,a,i,o,c,l,u=!1,g=!1){g?s=(s||[]).filter(e=>e.isParagraphLevelCheck):(e=e.filter(e=>e.isParagraphLevelCheck),t=t.filter(e=>e.isParagraphLevelCheck),r=r.filter(e=>e.isParagraphLevelCheck),n=n.filter(e=>e.isParagraphLevelCheck)),e=this.migrateOffsetsToValuableText(e,i.usedParts),t=this.migrateOffsetsToValuableText(t,i.usedParts),r=this.migrateOffsetsToValuableText(r,i.usedParts),n=this.migrateOffsetsToValuableText(n,i.usedParts),s=this.migrateOffsetsToValuableText(s||[],c.usedParts),a=this.migrateOffsetsToValuableText(a||[],i.usedParts);const d=Jt(i.text,o.text),h=Jt(c.text,l.text);return u?(e=this.migrateOffsetsBetweenTexts(e,i.text,o.text,!1,!0),t=this.migrateOffsetsBetweenTexts(t,i.text,o.text),r=this.migrateOffsetsBetweenTexts(r,i.text,o.text),n=this.migrateOffsetsBetweenTexts(n,i.text,o.text),s=this.migrateOffsetsBetweenTexts(s,c.text,l.text,!1,!0),a=this.migrateOffsetsBetweenTexts(a,i.text,o.text,!1,!0,!0)):(e=this.migrateOffsetsBetweenTexts(e,d,!0),t=this.migrateOffsetsBetweenTexts(t,d,!0),r=this.migrateOffsetsBetweenTexts(r,d,!0),n=this.migrateOffsetsBetweenTexts(n,d,!0),s=this.migrateOffsetsBetweenTexts(s,h,!1,!1),a=this.migrateOffsetsBetweenTexts(a,d,!0)),{errors:e,pickyErrors:t,premiumErrors:r,premiumPickyErrors:n,recommendationErrors:s,sentenceRanges:a}}static mergeParagraphLevelErrors(e,t,r,n,s,a,i,o,c,l,u,g=[]){e.push(...i),t.push(...o),r.push(...c),n.push(...l),s.push(...u),a.push(...g)}static mergeTextLevelErrors(e,t,r,n,s,a,i,o){for(const t of s)e.some(e=>e.start===t.start&&e.end===t.end)||e.push(t);for(const e of a)t.some(t=>t.start===e.start&&t.end===e.end)||t.push(e);for(const e of i)r.some(t=>t.start===e.start&&t.end===e.end)||r.push(e);for(const e of o)n.some(t=>t.start===e.start&&t.end===e.end)||n.push(e)}static sortErrors(e,t,r,n,s){this.sortErrorsByOffset(e),this.sortErrorsByOffset(t),this.sortErrorsByOffset(r),this.sortErrorsByOffset(n),this.sortErrorsByOffset(s)}static sortErrorsByOffset(e){e.sort((e,t)=>e.start===t.start?e.isParagraphLevelCheck?1:-1:e.start>t.start?1:-1)}static migrateErrorsBetweenSameOriginalTexts(e,t,r){const n=[];for(const s of e){let e=s.start,a=s.end,i=tr(t.usedParts,t=>mr(e,t.originalStart,t.originalEnd,!0)),o=tr(t.usedParts,e=>mr(a,e.originalStart,e.originalEnd));if(!i||!o)continue;if(e-=i.posDiff,a-=o.posDiff,i=tr(r.usedParts,t=>mr(e,t.start,t.end,!0)),o=tr(r.usedParts,e=>mr(a,e.start,e.end)),!i||!o)continue;e+=i.posDiff,a+=o.posDiff;const c=sr(s);c.start=e,c.end=a,c.length=a-e,n.push(c)}return n}static setIdsOnErrors(e,t,r,n,s,a){function i(e,t){if(e.id)return;const r=t.find(t=>{return n=e,(r=t).start===n.start&&r.end===n.end&&r.isParagraphLevelCheck===n.isParagraphLevelCheck;var r,n});e.id=r?r.id:"error:"+ ++Rr.INCREMENTAL_ID}e.forEach(e=>i(e,a.errors)),t.forEach(e=>i(e,a.pickyErrors)),r.forEach(e=>i(e,a.premiumErrors)),n.forEach(e=>i(e,a.premiumPickyErrors)),s.forEach(e=>i(e,a.recommendationErrors||[]))}static sortSentenceRanges(e){e.sort(({start:e},{start:t})=>e-t)}}Rr.INCREMENTAL_ID=0;
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Ir{constructor(e=document){this._window=e.defaultView,this._document=e,this.clearCache()}_getElementCache(e){let t=this._elementCache.get(e);return t||(t={},this._elementCache.set(e,t)),t}_consolidateSVGTransformMatrix(e){const t={a:1,b:0,c:0,d:1,e:0,f:0};for(let r=0;r<e.transform.baseVal.length;r++){const n=e.transform.baseVal[r];1===n.type?(t.a=n.matrix.a,t.b=n.matrix.b,t.c=n.matrix.c,t.d=n.matrix.d,t.e=n.matrix.e,t.f=n.matrix.f):2===n.type?(t.e=n.matrix.e,t.f=n.matrix.f):3===n.type?(t.a=n.matrix.a,t.d=n.matrix.d):5===n.type?t.b=n.matrix.b:6===n.type&&(t.c=n.matrix.c)}return t}clearCache(){this._documentVisibleBox=null,this._documentGap=null,this._documentScroll=null,this._elementCache=new WeakMap}_contains(e,t){return e&&e!==t&&function(e,t){let r=t;for(;r&&r.parentNode;){if(r===e||r.parentNode===e)return!0;r=r.parentNode instanceof DocumentFragment?r.parentNode.host:r.parentNode}return!1}(e,t)}contains(e,t){return this._contains(e,t)}_getComputedStyle(e,t,r){let n,s;return"object"==typeof t?(n=t,s=""):(n=r,s=t),n.computedStyle||(n.computedStyle=new Map),n.computedStyle.has(s)||n.computedStyle.set(s,this._window.getComputedStyle(e,s||null)),n.computedStyle.get(s)}getComputedStyle(e,t=""){return this._getComputedStyle(e,t,this._getElementCache(e))}_getComputedStyleMap(e,t){return e.computedStyleMap?(t.computedStyleMap||(t.computedStyleMap=e.computedStyleMap()),t.computedStyleMap):null}getComputedStyleMap(e){return this._getComputedStyleMap(e,this._getElementCache(e))}getInlineStyle(e,t){return e.style instanceof CSSStyleDeclaration?e.style.getPropertyValue(t):""}getStyle(e,t,r){let n,s;return"string"==typeof r?(n=t,s=r):(n="",s=t),this.getStyles(e,n,[s])[s]}getStyles(e,t,r){const n="string"==typeof t?t:"",s=this._getElementCache(e),a=this._getComputedStyle(e,n,s);let i=null;if(Array.isArray(t))i=t;else if(Array.isArray(r))i=r;else{i=[];for(let e=0;e<a.length;e++)i.push(a[e])}const o={};for(const t of i)if("line-height"===t||"lineHeight"===t){const r=this.getInlineStyle(e,t);r&&r.includes("px")?o[t]=r:o[t]=a[t]||""}else if("font"!==t||a[t])if("transform"===t&&e instanceof SVGGElement&&E.isSafari()&&e.hasAttribute("transform")){const r=this._consolidateSVGTransformMatrix(e);o[t]=`matrix(${r.a}, ${r.b}, ${r.c}, ${r.d}, ${r.e}, ${r.f})`}else o[t]="zoom"===t?a[t]||"1":a[t]||"";else{const r=a["font-style"],n=a["font-variant"],s=a["font-weight"],i=a["font-size"],c=this.getInlineStyle(e,"line-height")||a["line-height"]||"",l=a["font-family"];o[t]=`${r} ${n} ${s} ${i} ${c?"/ "+c:""} ${l}`}return o}getExactStyle(e,t){return this.getExactStyles(e,[t])[t]}getExactStyles(e,t){function r(e){return"number"==typeof e.value&&"string"==typeof e.unit}const n=this._getElementCache(e),s=this._getComputedStyleMap(e,n);if(s){const e={};for(const n of t){const t=s.get(n);t?r(t)?"number"===t.unit?e[n]=t.value.toString():e[n]=t.value+t.unit:e[n]=t.toString():e[n]=""}return e}return this.getStyles(e,t)}setStyle(e,t,r,n=!1){Array.isArray(e)||(e=[e]);const s={[t]:r};this.setStyles(e,s,n)}setStyles(e,t,r=!1){Array.isArray(e)||(e=[e]);for(const n of e)for(const e in t){let s=t[e].trim();const a=r||Ir.IMPORTANT_REG_EXP.test(s);s=s.replace(Ir.IMPORTANT_REG_EXP,""),n.style.setProperty(e,s,a?"important":"")}}copyStyles(e,t,r,n=!1){const s=this.getStyles(e,r);this.setStyles(t,s,n)}resetStyles(e,t,r=!1){Array.isArray(e)||(e=[e]);let n="";for(const e in t){let s=t[e].trim();r&&!Ir.IMPORTANT_REG_EXP.test(s)&&(s+=" !important"),n+=`${e}: ${s};`}for(const t of e)t.style.cssText=n}removeStyle(e,t){Array.isArray(e)||(e=[e]),this.removeStyles(e,[t])}removeStyles(e,t){Array.isArray(e)||(e=[e]);for(const r of e)for(const e of t)r.style.removeProperty(e)}getBoundingClientRect(e){return this._getBoundingClientRect(e,this._getElementCache(e))}_getBoundingClientRect(e,t){return t.boundingClientRect||(t.boundingClientRect=sr(e.getBoundingClientRect())),t.boundingClientRect}getRelativeClientRect(e,t){const r=this._getBoundingClientRect(e,this._getElementCache(e)),n=this._getBoundingClientRect(t,this._getElementCache(t)),s=r.top-n.top,a=r.left-n.left,i=r.width,o=r.height;return{top:s,right:a+i,bottom:s+o,left:a,width:i,height:o}}_getBorderBox(e,t,r,n){const s="borderBox"+(t?"WithScroll":"")+(r?"WithScale":"");if(!n[s]){const a=this._getBoundingClientRect(e,n);let{top:i,left:o,width:c,height:l}=a;if(r){const t=this.getZoom(e);i*=t,o*=t,c*=t,l*=t}else{const t=this._getScaleFactor(e,n);c/=t.x,l/=t.y}if(t){const t=this.getDocumentScroll();if(i+=t.top,o+=t.left,this._document.body&&this._contains(this._document.body,e)){const e=this.getDocumentGap();i-=e.top,o-=e.left}}n[s]={top:i,right:o+c,bottom:i+l,left:o,width:c,height:l}}return n[s]}getBorderBox(e,t=!0,r=!0){return this._getBorderBox(e,t,r,this._getElementCache(e))}_getPaddingBox(e,t,r,n){const s="paddingBox"+(t?"WithScroll":"")+(r?"WithScale":"");if(!n[s]){let{top:a,left:i,width:o,height:c}=this._getBorderBox(e,t,r,n),l={x:1,y:1};r&&(l=this._getScaleFactor(e,n));const u=r?this._getZoom(e,n):1,g=this._getComputedStyle(e,n),d=(parseFloat(g["border-top-width"])||0)*l.y*u,h=(parseFloat(g["border-right-width"])||0)*l.x*u,m=(parseFloat(g["border-bottom-width"])||0)*l.y*u,_=(parseFloat(g["border-left-width"])||0)*l.x*u;let p=0,E=0;if("BackCompat"!==this._document.compatMode||e!==this._document.body||e!==this._document.scrollingElement){let{width:t,height:r}=this._getClientWidthAndHeight(e,n);t=t*l.x*u,r=r*l.y*u;let s=o;s%1>0&&"offsetWidth"in e&&(s=e.offsetWidth*l.x*u);let a=c;a%1>0&&"offsetHeight"in e&&(a=e.offsetHeight*l.y*u),p=s-_-t-h,E=a-d-r-m,p<1&&(p=0),E<1&&(E=0)}a+=d,i+=_,o=o-_-p-h,c=c-d-E-m,this._isRTL(e,n)&&(i+=p),n[s]={top:a,right:i+o,bottom:a+c,left:i,width:o,height:c,border:{top:d,right:h,bottom:m,left:_}}}return n[s]}getPaddingBox(e,t=!0,r=!0){return this._getPaddingBox(e,t,r,this._getElementCache(e))}_getContentBox(e,t,r,n){const s="contentBox"+(t?"WithScroll":"")+(r?"WithScale":"");if(!n[s]){let{top:a,left:i,width:o,height:c,border:l}=this._getPaddingBox(e,t,r,n),u={x:1,y:1};r&&(u=this._getScaleFactor(e,n));const g=r?this._getZoom(e,n):1,d=this._getComputedStyle(e,n),h=(parseFloat(d["padding-top"])||0)*u.y*g,m=(parseFloat(d["padding-right"])||0)*u.x*g,_=(parseFloat(d["padding-bottom"])||0)*u.y*g,p=(parseFloat(d["padding-left"])||0)*u.x*g;a+=h,i+=p,o=o-p-m,c=c-h-_,n[s]={top:a,right:i+o,bottom:a+c,left:i,width:o,height:c,border:l,padding:{top:h,right:m,bottom:_,left:p}}}return n[s]}getContentBox(e,t=!0,r=!0){return this._getContentBox(e,t,r,this._getElementCache(e))}_getClientWidthAndHeight(e,t){let r=e.clientWidth,n=e.clientHeight;if(0===r&&0===n&&"offsetWidth"in e){const s=this._getComputedStyle(e,t);"inline"===s.display&&(r=e.offsetWidth-parseInt(s["border-left-width"])-parseInt(s["border-right-width"]),n=e.offsetHeight-parseInt(s["border-top-width"])-parseInt(s["border-bottom-width"]))}return{width:r,height:n}}_getScrollDimensions(e,t,r){const n="scrollDimensions"+(t?"WithScale":"");if(!r[n]){let s=e.scrollWidth,a=e.scrollHeight;if(0===s&&(0===a||0===e.clientHeight)){const t=this._getClientWidthAndHeight(e,r);s=t.width,a=t.height}if(t){const t=this._getScaleFactor(e,r),n=this._getZoom(e,r);s=s*t.x*n,a=a*t.y*n}r[n]={width:s,height:a}}return r[n]}getScrollDimensions(e,t=!0){return this._getScrollDimensions(e,t,this._getElementCache(e))}_getScrollPosition(e,t,r,n){const s="scrollPosition"+(t?"WithScale":"")+(r?"WithZoom":"");if(!n[s]){let a={x:1,y:1};t&&(a=this._getScaleFactor(e,n));const i=r?this._getZoom(e,n):1,o=e===this._document.body&&"BackCompat"===this._document.compatMode,c=o?0:e.scrollTop*a.y*i,l=o?0:e.scrollLeft*a.x*i;n[s]={top:c,left:l}}return n[s]}getScrollPosition(e,t=!0,r=t){return this._getScrollPosition(e,t,r,this._getElementCache(e))}_isPositionFixed(e,t){if(void 0===t.isPositionFixed){t.isPositionFixed=!1;let r=e;for(;r;){if("fixed"===this.getStyle(r,"position")){t.isPositionFixed=!0;break}r=r.parentElement}}return t.isPositionFixed}isPositionFixed(e){return this._isPositionFixed(e,this._getElementCache(e))}_getContainingBlock(e,t,r){const n="absolute"===t,s=n?"containingBlockForAbsolutePosition":"containingBlockForFixedPosition";let a=r[s];if(void 0===a){a=null;const t=[document.documentElement,document.body],r=["layout","paint","strict","content"],s=["transform","perspective"];let i=e;for(;i&&!t.includes(i);){const e=this.getStyles(i,["position","transform","perspective","will-change","filter","contain","container-type","backdrop-filter"]);if(n&&"static"!==e.position||"none"!==e.transform||"none"!==e.perspective||"none"!==e.filter||r.includes(e.contain)||s.includes(e["will-change"])||"normal"!==e["container-type"]||"none"!==e["backdrop-filter"]&&""!==e["backdrop-filter"]||E.isFirefox()&&"filter"===e["will-change"]){a=this.getPaddingBox(i);break}i=i.parentElement}}return r[s]=a,a}getContainingBlock(e,t="absolute"){return this._getContainingBlock(e,t,this._getElementCache(e))}getScaleFactor(e){return this._getScaleFactor(e,this._getElementCache(e))}_getScaleFactor(e,t){if(void 0===t.scaleFactor){if(e instanceof SVGElement){let t=1;const r=e.getAttribute("transform")||"",n=/scale\((\d+(\.\d+)?)\)/.exec(r);return n&&(t=+n[1]),{x:t,y:t}}{const r=this._getBoundingClientRect(e,t),n=e.offsetWidth,s=e.offsetHeight;t.scaleFactor={x:1,y:1},r.width>0&&n>0&&Math.abs(r.width-n)>1&&(t.scaleFactor.x=r.width/n),r.height>0&&s>0&&Math.abs(r.height-s)>1&&(t.scaleFactor.y=r.height/s)}}return t.scaleFactor}_getZoom(e,t){if(E.isFirefox()||E.isThunderbird())return 1;if("number"!=typeof t.zoom){let r=1,n=e;for(;n&&n!==this._document.documentElement;){r*=+this.getStyle(n,"zoom"),n=n.parentNode instanceof ShadowRoot&&n.parentNode.host instanceof HTMLElement?n.parentNode.host:n.parentElement}t.zoom=r}return t.zoom}getZoom(e){return this._getZoom(e,this._getElementCache(e))}_getStackingContextWithZIndex(e){const t=this.getComputedStyle(e),r=parseInt(t.zIndex||"");if(isNaN(r))return null;if(t.position&&Ir.NON_STATIC_POSITIONS.indexOf(t.position)>-1)return{zIndex:r};if(e.parentElement){const t=this.getComputedStyle(e.parentElement);if("flex"===t.display||"grid"===t.display)return{zIndex:r}}return null}getZIndex(e,t=this._document.documentElement){let r="auto",n=e;if(!n.ownerDocument)return"auto";const s=n.ownerDocument.defaultView;if(!s)throw new Error("Failed to retrieve the current element's window object.");const{Element:a,ShadowRoot:i}=s;for(;n&&n!==this._document&&n!==t&&n instanceof a;){const e=this._getStackingContextWithZIndex(n);e&&(r=e.zIndex),n=n.parentNode instanceof i?n.parentNode.host:n.parentElement}return r}_isRTL(e,t){return"boolean"!=typeof t.isRTL&&(t.isRTL="rtl"===this.getStyle(e,"direction")),t.isRTL}isRTL(e){return this._isRTL(e,this._getElementCache(e))}isStackingContext(e){const t=this.getComputedStyle(e);return!!(t.position&&Ir.NON_STATIC_POSITIONS.indexOf(t.position)>-1)||("none"!==t.transform||"none"!==t.filter||"none"!==t.clipPath||"none"!==t.perspective||Number(t.opacity)<1)}_getTextClientRects(e){const t=this._document.createRange();return t.setStart(e.node,e.start),t.setEnd(e.node,e.end),Array.from(t.getClientRects())}getTextBoundingBoxes(e,t,r=!0){Array.isArray(e)||(e=[e]);const n=[];let s=0,a=0;if(r){const e=this.getDocumentScroll();if(s+=e.top,a+=e.left,this._document.body&&this._contains(this._document.body,t)){const e=this.getDocumentGap();s-=e.top,a-=e.left}}for(const t of e)try{const e=this._getTextClientRects(t);for(const t of e){if(t.width<Ir.MIN_TEXT_BOX_WIDTH)continue;const e=n[n.length-1],r=t.top+s,i=t.right+a,o=t.bottom+s,c=t.left+a,l=t.width,u=t.height;e&&e.right===c&&e.top===r&&e.bottom===o&&e.height===u?(e.right=i,e.width=e.width+l):n.push({top:r,right:i,bottom:o,left:c,width:l,height:u})}}catch(e){}return n}getRelativeTextBoundingBoxes(e,t,r=this.getScrollPosition(t)){Array.isArray(e)||(e=[e]);const n=[],s=this.getPaddingBox(t,!1,!1),a=s.left-r.left,i=s.top-r.top;for(const t of e)try{const e=this._getTextClientRects(t);for(const t of e){if(t.width<Ir.MIN_TEXT_BOX_WIDTH)continue;const e=n[n.length-1],r=t.top-i,s=t.right-a,o=t.bottom-i,c=t.left-a,l=t.width,u=t.height;e&&e.right===c&&e.top===r&&e.bottom===o&&e.height===u?(e.right=s,e.width=e.width+l):n.push({top:r,right:s,bottom:o,left:c,width:l,height:u})}}catch(e){console.error("LT range error",e)}const o=this.getScaleFactor(t);for(const e of n)e.top=Math.round(e.top/o.y),e.right=Math.round(e.right/o.x),e.bottom=Math.round(e.bottom/o.y),e.left=Math.round(e.left/o.x),e.width=e.right-e.left,e.height=e.bottom-e.top;return n}getRelativeTextBoundingBox(e,t){const r=this.getRelativeTextBoundingBoxes(e,t),n=Math.min(...r.map(e=>e.top)),s=Math.max(...r.map(e=>e.right)),a=Math.max(...r.map(e=>e.bottom)),i=Math.min(...r.map(e=>e.left));return{top:n,right:s,bottom:a,left:i,width:s-i,height:a-n}}_hasRelativePosition(e,t){const r=this._getComputedStyle(e,t).position||"static";return Ir.NON_STATIC_POSITIONS.indexOf(r)>-1}getDocumentGap(){if(!this._documentGap&&(this._documentGap={top:0,left:0},this._document.body&&this._hasRelativePosition(this._document.body,this._getElementCache(this._document.body)))){const e=this.getBorderBox(this._document.documentElement),t=this.getBorderBox(this._document.body);let r=this._document.documentElement.offsetTop,n=this._document.documentElement.offsetLeft;if(E.isFirefox()||E.isThunderbird()){let e=null;0===r&&(e=this.getComputedStyle(this._document.documentElement),r=parseInt(e["margin-top"])||0),0===n&&(e=e||this.getComputedStyle(this._document.documentElement),n=parseInt(e["margin-left"])||0)}const s=t.top-e.top+r,a=t.left-e.left+n,i=this.getComputedStyle(this._document.body),o=parseFloat(i["border-top-width"])||0,c=parseFloat(i["border-left-width"])||0;this._documentGap={top:s+o,left:a+c}}return this._documentGap}getDocumentVisibleBox(){if(!this._documentVisibleBox){const e=this.getDocumentScroll();let t=this._document.documentElement.clientHeight,r=this._document.documentElement.clientWidth;E.isThunderbird()&&(t=self.innerHeight,r=self.innerWidth),this._documentVisibleBox={top:e.top,right:e.left+r,bottom:e.top+t,left:e.left,width:r,height:t}}return this._documentVisibleBox}getDocumentScroll(){if(!this._documentScroll){const e=this._document.documentElement&&this._document.documentElement.scrollTop||this._document.body&&this._document.body.scrollTop||0,t=this._document.documentElement&&this._document.documentElement.scrollLeft||this._document.body&&this._document.body.scrollLeft||0;this._documentScroll={top:e,left:t}}return this._documentScroll}_isScrollable(e,t,r){if("boolean"==typeof r.isScrollable?.[t])return r.isScrollable?.[t];r.isScrollable??(r.isScrollable={});const n=this.getComputedStyle(e);return"x"===t?(r.isScrollable.x=e.scrollWidth>e.clientWidth||"scroll"===n.overflowX,r.isScrollable.x):"y"===t?(r.isScrollable.y=e.scrollHeight>e.clientHeight||"scroll"===n.overflowY,r.isScrollable.y):void 0}isScrollable(e,t){return this._isScrollable(e,t,this._getElementCache(e))}}Ir.IMPORTANT_REG_EXP=/!important$/,Ir.TRANSFORM_MATRIX_REG_EXP=/(?:matrix|scale)\(([\d\.]+),/,Ir.NON_STATIC_POSITIONS=["relative","fixed","absolute","sticky"],Ir.MIN_TEXT_BOX_WIDTH=.1;var Pr=r(4629),Lr=r.n(Pr);function yr(){return Lr()}var br,Or=function(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
const Nr=I.get(A.EXTN_PREFIX);class wr{}wr.eventNames={localeChanged:`${Nr}-i18nManager.localeChanged`};const vr=(br=class{static init(e){this._instance=e}static addEventListener(e,t){this._instance.addEventListener(e,t)}static setLocale(e){this._instance.setLocale(e)}static getMessage(e,t){return this._instance.getMessage(e,t)}static getLanguageNameForCode(e){return this.getMessage(this._languageCodeToTranslationKeyMap[e])}},Or(br,"i18nManager"),br._languageCodeToTranslationKeyMap={ar:"ar",ast:"ast","ast-es":"ast",be:"be","be-by":"be",br:"br","br-fr":"br",ca:"ca","ca-es":"ca","ca-es-valencia":"ca_ES_valencia","crh-ua":"crh","da-dk":"da_DK",de:"de","de-at":"de_AT","de-ch":"de_CH","de-de":"de_DE",el:"el","el-gr":"el",en:"en","en-au":"en_AU","en-ca":"en_CA","en-gb":"en_GB","en-nz":"en_NZ","en-us":"en_US","en-za":"en_ZA",eo:"eo",es:"es","es-es":"es",fa:"fa",ga:"ga","ga-ie":"ga",fr:"fr","fr-fr":"fr",gl:"gl","gl-es":"gl",it:"it",ja:"ja","ja-jp":"ja",km:"km","km-kh":"km",nl:"nl",no:"no",pl:"pl","pl-pl":"pl",pt:"pt","pt-ao":"pt_AO","pt-br":"pt_BR","pt-mz":"pt_MZ","pt-pt":"pt_PT",ro:"ro","ro-ro":"ro","ru-ru":"ru",sk:"sk","sk-sk":"sk",sl:"sl","sl-si":"sl",sv:"sv",ta:"ta","ta-in":"ta",tl:"tl","tl-ph":"tl",uk:"uk","uk-ua":"uk",zh:"zh","zh-cn":"zh"},br);I.get(A.EXTN_PREFIX);function Dr(e=25,t){return new Promise((r,n)=>{const s=setTimeout(()=>{i(),r()},e),a=()=>{const e=new DOMException(t.reason||"`wait` was aborted","AbortError");clearTimeout(s),i(),n(e)},i=()=>{t&&t.removeEventListener("abort",a)};t?.aborted?a():t&&t.addEventListener("abort",a)})}(()=>{const e=(e,t,r,n)=>{const s=e.ownerDocument;let a=s.elementFromPoint(r,n);if(!a)return!1;if(e===a||e.contains(a))return!0;if(!t.length)return!1;return t.find(e=>e.contains(a))&&(a=s.elementsFromPoint(r,n).find(e=>!1===t.some(t=>t.contains(e)))||null),Boolean(a&&(e===a||e.contains(a)))}})();function xr(e,t,r){const n=new CustomEvent(t,{detail:r,cancelable:!0});return e.dispatchEvent(n)}(()=>{let e;const t=[]})(),(()=>{let e=null,t=[];function r(r){if(!r.some(e=>e.removedNodes.length>0))return;const s=[];for(const e of t)kr(e.element)||(e.callback(e.element),s.push(e),e.signal?.removeEventListener("abort",n));t.filter(e=>!s.includes(e)),t.length||(e.disconnect(),null)}function n(r){t.filter(e=>e.signal===r.currentTarget),t.length||(e.disconnect(),null)}})();function kr(e){if(e.ownerDocument&&e.ownerDocument.contains(e))return!0;let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t.parentNode instanceof DocumentFragment?t.parentNode.host:t.parentNode}return!1}new Set(["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]);function Ur(e){return function(e){return e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}(e)&&"ShadowRoot"===Object.getPrototypeOf(e).constructor.name}function Mr(e,t){const r=t||"content/styles/shadow.css",n=yr().runtime.getURL(r);if(!e.querySelector(`[href="${n}"]`)){const t=document.createElement("link");t.href=n,t.rel="stylesheet",e.append(t)}}function Fr(e,t,r,n=Date.now().toString()){const s=self,a=void 0!==s.screenLeft?s.screenLeft:s.screenX,i=void 0!==s.screenTop?s.screenTop:s.screenY,o=s.innerWidth?s.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,c=s.innerHeight?s.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,l=o/s.screen.availWidth,u=(o-t)/2/l+a,g=(c-r)/2/l+i;return s.open(e,n,`\n      scrollbars=yes,\n\t  resizable=yes,\n      width=${t/l},\n      height=${r/l},\n      top=${g},\n      left=${u}\n      `)}(function(){let e,t=null;const r=t=>{t.origin.match(/^chrome|moz|safari/)&&e(t.data)}})(),function(){const e="GET_LOGIN_CREDENTIALS";let t,r=null;const n=e=>{t(e.data)}}();const Gr=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,Br=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,Hr=/^rgba?\((\d{1,3}), (\d{1,3}), (\d{1,3})(?:, (\d(?:\.\d+)?))?\)/i,Wr=/^lab\((none|\d+(?:\.\d+)?) (none|-?\d+(?:\.\d+)?) (none|-?\d+(?:\.\d+)?)(?: \/ (none|1|0(?:\.\d+)?))?\)$/i,jr=/^lch\((none|\d+(?:\.\d+)?) (none|\d+(?:\.\d+)?) (none|\d+(?:\.\d+)?)(?: \/ (none|1|0(?:\.\d+)?))?\)$/i,Vr=/^oklab\((none|0(?:\.\d+)?) (none|-?0(?:\.\d+)?) (none|-?0(?:\.\d+)?)(?: \/ (none|1|0(?:\.\d+)?))?\)$/i,Xr=/^oklch\((none|1|0(?:\.\d+)?) (none|0(?:\.\d+)?) (none|\d+(?:\.\d+)?)(?: \/ (none|1|0(?:\.\d+)?))?\)$/i;function $r(e,t,r){const n=Math.abs(e),s=Math.abs(t),a=Math.abs(r);return[255*(n>.0031308?Math.sign(e)*(1.055*Math.pow(n,1/2.4)-.055):12.92*e),255*(s>.0031308?Math.sign(t)*(1.055*Math.pow(s,1/2.4)-.055):12.92*t),255*(a>.0031308?Math.sign(r)*(1.055*Math.pow(a,1/2.4)-.055):12.92*r)]}function qr(e,t,r){return function(e,t,r){return $r(3.1341359569958707*e-1.6173863321612538*t-.4906619460083532*r,-.978795502912089*e+1.916254567259524*t+.03344273116131949*r,.07195537988411677*e-.2289768264158322*t+1.405386058324125*r)}(...function(e,t,r){const n=Math.pow(29,3)/Math.pow(3,3),s=Math.pow(6,3)/Math.pow(29,3),a=(e+16)/116,i=t/500+a,o=a-r/200,c=Math.pow(i,3),l=Math.pow(a,3),u=Math.pow(o,3);return[.3457*(c>s?c:(116*i-16)/n)/.3585,l>s?l:(116*a-16)/n,.2958*(u>s?u:(116*o-16)/n)/.3585]}(e,t,r))}function Yr(e,t,r){return[e,t*Math.cos(r/180*Math.PI),t*Math.sin(r/180*Math.PI)]}function zr(e,t,r){return $r(...function(e,t,r){const n=Math.pow(.9999999984505198*e+.3963377921737678*t+.2158037580607588*r,3),s=Math.pow(1.0000000088817607*e-.1055613423236563*t-.0638541747717059*r,3),a=Math.pow(1.00000005467241*e-.0894841820949657*t-1.2914855378640917*r,3);return[4.076741661347994*n-3.307711590408193*s+.230969928729428*a,-1.2684380040921763*n+2.6097574006633715*s-.3413193963102197*a,-.004196086541837188*n-.7034186144594493*s+1.7076147009309444*a]}(e,t,r))}function Kr(e,t,r){const n=Math.max(e,t,r)/255,s=Math.min(e,t,r)/255;return Math.round((n+s)/2*100)}function Zr(e,t,r){return Kr(...qr(e,t,r))}function Qr(e,t,r){return Kr(...zr(e,t,r))}function Jr(e){if(Array.isArray(e)){return{opacity:4===e.length?e[3]:1,lightness:Kr(e[0],e[1],e[2])}}if(!e)return null;if("transparent"===e)return{opacity:0,lightness:100};let t=Gr.exec(e)||Br.exec(e);if(t){return{opacity:t[4]?parseInt(t[4].padEnd(2,t[4]),16)/255:1,lightness:Kr(parseInt(t[1].padEnd(2,t[1]),16),parseInt(t[2].padEnd(2,t[2]),16),parseInt(t[3].padEnd(2,t[3]),16))}}if(t=Hr.exec(e),t){return{opacity:t[4]?parseFloat(t[4]):1,lightness:Kr(parseInt(t[1]),parseInt(t[2]),parseInt(t[3]))}}if(t=Wr.exec(e),t){return{opacity:t[4]?"none"===t[4]?0:parseFloat(t[4]):1,lightness:Zr("none"===t[1]?0:parseFloat(t[1]),"none"===t[2]?0:parseFloat(t[2]),"none"===t[3]?0:parseFloat(t[3]))}}if(t=jr.exec(e),t){const e=t[4]?"none"===t[4]?0:parseFloat(t[4]):1,r=function(e,t,r){return Zr(...Yr(e,t,r))}("none"===t[1]?0:parseFloat(t[1]),"none"===t[2]?0:parseFloat(t[2]),"none"===t[3]?0:parseFloat(t[3]));return{opacity:e,lightness:r}}if(t=Vr.exec(e),t){return{opacity:t[4]?"none"===t[4]?0:parseFloat(t[4]):1,lightness:Qr("none"===t[1]?0:parseFloat(t[1]),"none"===t[2]?0:parseFloat(t[2]),"none"===t[3]?0:parseFloat(t[3]))}}if(t=Xr.exec(e),t){const e=t[4]?"none"===t[4]?0:parseFloat(t[4]):1,r=function(e,t,r){return Qr(...Yr(e,t,r))}("none"===t[1]?0:parseFloat(t[1]),"none"===t[2]?0:parseFloat(t[2]),"none"===t[3]?0:parseFloat(t[3]));return{opacity:e,lightness:r}}return null}Array.from({length:16},(e,t)=>t.toString(16));const en=/^(https?:\/\/)?localhost(:[0-9]{1,5})?(\/.*)?$/i,tn=/^(https?:\/\/)?[a-z0-9]+([-.]{1}[a-z0-9]+)*\.[a-z]{2,15}(:[0-9]{1,5})?(\/.*)?$/i,rn=/^(?:https?:\/\/)?(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])(?:\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3}(?::[0-9]{1,5})?$/;function nn(e){return en.test(e)||tn.test(e)||rn.test(e)}function sn(e){return e.filter(e=>nn(e))}function an(e){return sn(e).map(e=>{try{return cr(e)}catch{return null}}).filter(e=>!!e)}new Map([["paraphrase","rephrase"],["correct","correct"]]),new Map([["hover","hover"],["click","click"],["toolbar","click"],["dblClick","click"],["dblPress","click"]]);
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class on extends Ar{constructor(){super(...arguments),this._isProductionEnvironmentCached=null}incrementalCheck(e,t,r,n,s){throw new Error("Method not implemented.")}isProductionEnvironment(){if(null===this._isProductionEnvironmentCached){if(E.isSafari())return!0;E.isFirefox()||E.isThunderbird()?this._isProductionEnvironmentCached=!yr().runtime.id.match("languagetool.dev"):this._isProductionEnvironmentCached="update_url"in yr().runtime.getManifest()}return this._isProductionEnvironmentCached}isRuntimeConnected(){try{return yr().runtime.getManifest(),!0}catch(e){return!1}}getVersion(){if(this.isRuntimeConnected()){const e=yr().runtime.getManifest();return e&&e.version?e.version:"unknown"}return"unknown"}getTrackingId(){return E.isSafari()?"13":E.isThunderbird()?"22":"12"}shouldTrack(){return"1"!==navigator.doNotTrack&&!E.isFirefox()}getPinnedState(){const e=yr();return e.action&&"function"==typeof e.action.getUserSettings?e.action.getUserSettings().then(e=>Promise.resolve("boolean"==typeof e.isOnToolbar?e.isOnToolbar:null)).catch(()=>Promise.resolve(null)):Promise.resolve(null)}getType(){return"extension"}getBeforeUnloadEventName(){return"pagehide"}getURL(e){return yr().runtime.getURL(e)}getUILanguageCode(){return yr().i18n.getUILanguage?yr().i18n.getUILanguage():navigator.language}openWindow(e){yr().runtime.sendMessage({command:"OPEN_URL",url:e})}injectExecutor(){return new Promise((e,t)=>{if(E.isThunderbird())return e();const r=setTimeout(()=>{t()},2e3),n=function(){const e=document.createElement("script");return e.setAttribute("data-cookieconsent","ignore"),e.setAttribute("data-uc-allowed","true"),e}();n.src=yr().runtime.getURL("/content/executor.js"),n.async=!0,n.setAttribute("fetchpriority","low"),n.onload=function(){n.remove(),clearTimeout(r),e()},n.onerror=function(){n.remove(),clearTimeout(r),t()},(document.head||document.documentElement).appendChild(n)})}destroyExecutor(){xr(document,"lt-execute-destroy")}addEventListener(){}updateSentenceRanges(){}executeScript(e,t){const r=new self.Object;r.code=t,xr(e,"lt-execute-code",r)}linkInputAreaProperties(e){xr(e,"lt-execute-link-properties")}ping(){return new Promise((e,t)=>{const r=self.setTimeout(()=>t("timeout"),5e3);yr().runtime.sendMessage({command:"BACKGROUND_PING"}).then(n=>{self.clearTimeout(r),"success"===n?e():t("unknown")}).catch(()=>{self.clearTimeout(r),t("error")})})}canLoadContentScripts(e){return"css"===e||2===yr().runtime.getManifest().manifest_version}loadContentScripts(e,t){return this.isRuntimeConnected()&&this.canLoadContentScripts(t)?(yr().runtime.getManifest().content_scripts.forEach(r=>{if("js"===t&&r.js){const t=r.js.map(e=>{const t=this.getURL(e);return fetch(t).then(e=>e.text())});return Promise.all(t).then(t=>{const r=t.join("\n");if("eval"in e&&Ft(e.eval)){if("safari"in e)try{e.eval("window.safari = window.safari || window.parent.safari;")}catch{}e.eval(r)}})}if("css"===t&&r.css)return this.loadStylesheets(e,r.css)}),Promise.resolve()):Promise.reject()}loadStylesheets(e,t){const r=(Array.isArray(t)?t.map(e=>[null,e]):Object.entries(t)).map(([e,t])=>{const r=this.getURL(t);return fetch(r).then(e=>e.text()).then(t=>[e,t])});return Promise.all(r).then(t=>{t.forEach(([t,r])=>{const n=e.document.createElement("style");n.textContent=r,t&&n.setAttribute("id",t),(e.document.head||e.document.documentElement).appendChild(n)})})}injectShadowStyles(e){Mr(e)}initializeLTAssistant(e,t={}){return Promise.resolve()}getPreferredLanguages(){return yr().runtime.sendMessage({command:"GET_PREFERRED_LANGUAGES"})}startDictionarySync(){return yr().runtime.sendMessage({command:"START_DICTIONARY_SYNC"})}updateDictionary(){return yr().runtime.sendMessage({command:"UPDATE_DICTIONARY"})}addWordToDictionary(e){const t={command:"ADD_WORD_TO_DICTIONARY",word:e};return yr().runtime.sendMessage(t)}addWordsToDictionary(e){const t={command:"BATCH_ADD_WORDS_TO_DICTIONARY",words:e};return yr().runtime.sendMessage(t)}removeWordFromDictionary(e){const t={command:"REMOVE_WORD_FROM_DICTIONARY",word:e};return yr().runtime.sendMessage(t)}clearDictionary(){return yr().runtime.sendMessage({command:"CLEAR_DICTIONARY"})}loadSynonyms(e,t,r){const n={command:"LOAD_SYNONYMS",wordContext:e,language:t,motherTongue:r};return yr().runtime.sendMessage(n)}abortSynonymsRequest(){return yr().runtime.sendMessage({command:"ABORT_SYNONYMS_REQUEST"})}loadPhrases(e,t,r,n,s,a){const i={command:"LOAD_PHRASES",uuid:e,phrase:t,language:r,inhouseOnly:n,user:s,mode:a};return yr().runtime.sendMessage(i)}abortPhraseRequests(e){const t={command:"ABORT_PHRASE_REQUESTS",type:e};return yr().runtime.sendMessage(t)}abortTranslateRequest(e){const t={command:"ABORT_TRANSLATE_REQUESTS",abortId:e};return yr().runtime.sendMessage(t)}initializeUserActivity(e){const t={command:"INITIALIZE_USER_ACTIVITY",data:e};return yr().runtime.sendMessage(t)}sendUserActivityPings(e){const t={command:"SEND_USER_ACTIVITY_PINGS",uuids:e};return yr().runtime.sendMessage(t)}updateUserActivityTextStatistics(e,t){const r={command:"UPDATE_USER_ACTIVITY_TEXT_STATISTICS",uuid:e,stats:t};return yr().runtime.sendMessage(r)}updateUserActivityAppliedSuggestions(e,t,r){const n={command:"UPDATE_USER_ACTIVITY_APPLIED_SUGGESTIONS",isPremium:r,type:t,uuid:e};return yr().runtime.sendMessage(n)}updateUserActivityAppliedRewritings(e){const t={command:"UPDATE_USER_ACTIVITY_APPLIED_REWRITINGS",uuid:e};return yr().runtime.sendMessage(t)}updateUserActivityMeta(e,t){const r={command:"UPDATE_USER_ACTIVITY_META",uuid:e,meta:t};return yr().runtime.sendMessage(r)}sendUserActivity(e){const t={command:"SEND_USER_ACTIVITY",uuid:e};return yr().runtime.sendMessage(t)}destroyUserActivity(e){const t={command:"DESTROY_USER_ACTIVITY",uuid:e};return yr().runtime.sendMessage(t)}loadSplitSentence(e,t,r,n,s){const a={command:"LOAD_SPLIT_SENTENCE",uuid:e,phrase:t,language:r,inhouseOnly:n,user:s};return yr().runtime.sendMessage(a)}trackEvent(e,t){const r={command:"TRACK_EVENT",action:e,label:t};return yr().runtime.sendMessage(r)}pageLoaded(e,t,r,n,s){const a={command:"PAGE_LOADED",enabled:e,supported:t,beta:r,unsupportedMessage:n,isDarkMode:s};return yr().runtime.sendMessage(a)}ltAssistantStatusChanged(e,t){const r={command:"LTASSISTANT_STATUS_CHANGED",tabId:"number"==typeof e?e:void 0,enabled:("object"==typeof e?e:t).enabled};return yr().runtime.sendMessage(r)}createWritingSession(e,t){return yr().runtime.sendMessage({command:"INTIALIZE_WRITING_SESSION",payload:{hostUrl:e,uniqueIdentifier:t}})}check(e,t,r,n,s){const a={command:"CHECK_TEXT",text:t,changedParagraphs:r,language:e.language,forceLanguage:e.forceLanguage,metaData:n,options:s,changedContent:[]};return yr().runtime.sendMessage(a)}fetchRecommendationForSentence(e){const t={command:"FETCH_SENTENCE_RECOMMENDATION",...e};return yr().runtime.sendMessage(t)}unlockRecommendation(e){const t={command:"UNLOCK_RECOMMENDATION",...e};return yr().runtime.sendMessage(t)}translateText(e){const t={command:"TRANSLATE_TEXT",...e};return yr().runtime.sendMessage(t)}isOptionsPageSupported(){return!0}openOptionsPage(e,t){const r={command:"OPEN_OPTIONS",target:e,ref:t};return yr().runtime.sendMessage(r)}isFeedbackFormSupported(){return!0}openFeedbackForm(e,t="",r=""){const n={command:"OPEN_FEEDBACK_FORM",url:e,title:t,html:r};return yr().runtime.sendMessage(n)}openPremiumPage(e,t=0,r=0,n=0,s="",a){const i={command:"OPEN_PREMIUM_PAGE",campaign:e,hiddenGrammarMatches:t,hiddenStyleMatches:r,hiddenPunctuationMatches:n,historicMatches:s,textLanguage:a||void 0};return yr().runtime.sendMessage(i)}updateSurroundingTextContext(e){const t={command:"UPDATE_SURROUNDING_TEXT_CONTEXT",data:e};return yr().runtime.sendMessage(t)}forceSyncEditorState(e){const t={command:"FORCE_SYNC_EDITOR_STATE",data:e};return yr().runtime.sendMessage(t)}checkForPaidSubscription(){return yr().runtime.sendMessage({command:"CHECK_FOR_PAID_SUBSCRIPTION"})}canUseShadowDom(){return!navigator.webdriver}abortAllRequests(e){e.checkRequestController&&e.checkRequestController.abort(),e.recommendationRequestAbortController.abort&&e.recommendationRequestAbortController.abort();const t={command:"ABORT_ALL_REQUESTS",instanceId:e.id};return yr().runtime.sendMessage(t)}getTermsOfServiceInfo(e){const t={command:"GET_TERMS_OF_SERVICE_INFO",version:e};return yr().runtime.sendMessage(t)}acceptTermsOfService(e){const t={command:"ACCEPT_TERMS_OF_SERVICE",version:e};return yr().runtime.sendMessage(t)}syncUserData(){return yr().runtime.sendMessage({command:"SYNC_USER_DATA"})}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class cn extends wr{addEventListener(e,t){}setLocale(e){}getMessage(e,t){return yr().i18n.getMessage?yr().i18n.getMessage(e,t):e}}const ln={hallo:"de",moin:"de",viele:"de",servus:"de",gruezi:"de",kacke:"de",und:"de","und los":"de","na denn":"de",gut:"de",eins:"de",nie:"de",immer:"de",neein:"de",neeein:"de",neeeein:"de",stimmts:"de",das:"de",den:"de",hier:"de",sowas:"de","och nö":"de","hey du":"de","na gut":"de","hallo leute":"de","hey leute":"de",nagut:"de",ahoi:"de",bald:"de",juhu:"de",juchu:"de",alter:"de",fertig:"de",korrekt:"de",digga:"de",diggah:"de",digger:"de",gratis:"de",schade:"de",nicht:"de",meins:"de",willkommen:"de",schuldigung:"de",tschuldigung:"de",entschuldigung:"de",hö:"de",höhö:"de",sicher:"de",bitte:"de",klappt:"de",krass:"de",funzt:"de",hä:"de",häh:"de",hähä:"de",passt:"de",nee:"de",tschö:"de",tschöh:"de",du:"de",sie:"de",prima:"de",grüezi:"de",grüzi:"de",komme:"de",jepp:"de",japp:"de",anbei:"de","guten tag":"de","gute tag":"de","dank dir":"de",oha:"de",herr:"de",frau:"de",ja:"de",oja:"de",jo:"de",nö:"de",nöö:"de",nööö:"de",geil:"de",klasse:"de",nix:"de","oh ja":"de","oh je":"de",ohje:"de",oje:"de",wieso:"de",wann:"de",achso:"de",was:"de",ups:"de",hihi:"de",hihihi:"de",bitteschön:"de","bitte schön":"de",dankeschön:"de","danke schön":"de","besten dank":"de","vielen dank":"de","ja klar":"de","ja, klar":"de",au:"de",aua:"de",tja:"de",bäh:"de",ähm:"de",ähem:"de",hoppla:"de",uff:"de",zack:"de",bumm:"de",pfui:"de",hurra:"de",puh:"de",mist:"de",hi:"en",hey:"en",wassup:"en",wazzup:"en",yo:"en",oh:"en",done:"en",dollar:"en",yay:"en",yep:"en",nope:"en",please:"en",pls:"en",damn:"en",dammit:"en",shit:"en",bad:"en",usa:"en",rofl:"en",lol:"en",wtf:"en",huh:"en",thx:"en",ugh:"en",like:"en",ouch:"en",boo:"en",booo:"en",boooo:"en",no:"en",noo:"en",nooo:"en",noooo:"en",nooooo:"en","see ya":"en","see you":"en","love u":"en",yea:"en",hooray:"en",best:"en",jeez:"en",yeez:"en",geez:"en",woah:"en",omg:"en",gosh:"en",si:"es","mui bien":"es",oye:"es",vale:"es",que:"es",anda:"es",orale:"es",correcto:"es",ay:"es",eh:"es",claro:"es",hala:"es",bien:"es",cabron:"es",joder:"es",culo:"es",pendejo:"es","maldita sea":"es",hostia:"es",como:"es",cómo:"es",ajá:"es",aja:"es","como dice":"es",carajo:"es",jajaja:"es",jejeje:"es",perdon:"es",donde:"es",dale:"es",portada:"es",oi:"pt",ola:"pt",olá:"pt",tchau:"pt",adeus:"pt",beleza:"pt","ate logo":"pt","e ai":"pt","e aí":"pt",xau:"pt",oba:"pt",nossa:"pt",poxa:"pt",então:"pt",entao:"pt",uau:"pt",bom:"pt",certo:"pt",ufa:"pt",eita:"pt",otimo:"pt",ótimo:"pt","está ótimo":"pt","esta otimo":"pt","cruz credo":"pt",salut:"fr",coucou:"fr",daccord:"fr",accord:"fr",bonne:"fr",bonsoir:"fr","bon jour":"fr","bon soir":"fr","d'acc":"fr","d´acc":"fr","d`acc":"fr",allo:"fr",merde:"fr",ouf:"fr",aie:"fr",bon:"fr",zut:"fr",boum:"fr",donc:"fr",mince:"fr",comment:"fr",pardon:"fr",quand:"fr",beurk:"fr",putain:"fr",connard:"fr","a propos":"fr","quand meme":"fr","oh la la":"fr","miam miam":"fr","merci beacoup":"fr","ca va":"fr",dag:"nl",hoi:"nl",goedemorgen:"nl",welkom:"nl",dank:"nl","dank u":"nl","dank je":"nl",bedankt:"nl",verdorie:"nl",godverdomme:"nl",verdomme:"nl",klote:"nl",kloten:"nl",kak:"nl",kut:"nl",lul:"nl",flikker:"nl",hé:"nl",czesc:"pl","bon dia":"ca","si us plau":"ca","moltes gràcies":"ca","moltes gracies":"ca","com estàs":"ca","com estas":"ca","fins aviat":"ca",gràcies:"ca",gracies:"ca",perdó:"ca",enhorabona:"ca",índex:"ca"},un=/^([Hh]allo|[Ll]ieber?|[Mm]oin|[Nn]a|[Ss]ervus|[Dd]anke|Grüe?zi|Gruezi|Herr|Frau|Fräulein)\s[A-ZÄÖÜ][a-zäüß]/,gn=/(\b|^)(guten\s(tag|abend|morgen)|sehr\sgeehrter?)(\b|$)/,dn=/^ol[aáà]\s|((\b|^)(boa\snoite|bom\sdia)(\b|$))/,hn=/(\b|^)(bon\sdia|moltes\sgr[aà]cies|bona\ssort|no\spassa\sres|com\sest[àa]s)(\b|$)/,mn=/^[¿¡.…]+$/,_n=/[!.:;…?,]+$/;const pn=.5,En=(e,t,r)=>e>=t&&e<=r;const fn=le,Sn=/\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}\b/gi,Tn=/\b(?:(https?|ftp|mailto|tel|wss):\/\/|www\.|(chrome|moz|safari)(-extension)?:\/\/|file:\/\/)[^\s]+/gi,An=/@[A-Z0-9._-]+/gi,Cn=/[\-~\$]?[0-9]+/g,Rn=/^([0-9a-z]+\.)(\s|$)/gim,In=/[\u25CF\u25CB\u25C6\u27A2\u25A0\u25A1\u2605\u274F\u2794\u21B5\u2756\u25AA\u2751\u2022]+(\s|$)/gim,Pn=/^[-*](\s|$)/gim,Ln=/\b([0-9]+[.,][0-9]+[.,][0-9]+[.,][0-9]+|[0-9]+[.,][0-9]+[.,][0-9]+|[0-9]+[.,][0-9]+)\b/g,yn=/(?<=(\s|^))(:\-?[\)(DPpoO]|;\-?\)|(xo|xO|XO){1,10}|xD|XD|\<3)(?=(\s|$))/g,bn=/[\u2665\u2661\u2764]+/g,On=/\b[A-Z\-]{1,10}[\-_]?\d{2,100}\b/gi,Nn=/\u203D/g,wn=/(\!{2,50}|\?{2,50}|(\?\!){2,50}|\.{4,50}|\-{2,10}|\:{2,50}|\;{2,50}|…{2,50}|\_{2,50}|\,{2,50}|\<{2,50}|\>{2,50}|\#{2,50}|\*{2,50}|\+{2,50}|\={2,50}|\/{2,50}|\\{2,50}|\%{2,50}|\~{2,50})/g,vn=/[—–-]+/g,Dn=/\u2011+/g,xn=/[\uFEFF\u200B\u200C\u200D\u00AD\u2060\u2063\u202A\u202B\u202C\u202D]+/g,kn=/\s+/g,Un=/^\/[a-z\-_]+/gm,Mn=/(?<=(\s|^))#[a-z0-9]+/gi,Fn=/(?<=(\s|^))[#%_\$€§*><~]+(?=(\s|$))/g,Gn=/\b[a-z0-9-_\/\.]+\.(com?|de|co\.uk|ch|at|fr|org|dk|se|no|info|net|eu|ai|io|nl|pl|ru|com\.br|br|pt|it|ca|com\.mx|mx|cn|mp[43]|jpe?g|gif|php|html?|s?css|jsx?|mov|png|web[mp]|pdf|docx?|xlsx?|pptx?|txt|rtf|bmp|svg|odt|zip|rar|gz|tar|app|dmg|exe|cad|psd|dotx?|tiff?|tsx?|woff|xml|csv|wav|ogg|pkg|rpm|iso|sql|php|email|eml|msi|otf|ttf|aspx?|py|java|swift|ods|sys|log|avi|wmv|m4v|sh)\b/gi,Bn=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF]|[\uFE00-\uFE0F]|[\u2B50-\u2B52])/g,Hn=["haw","hmn","co","fy","gd","cbk","und"],Wn={fil:"tl"};class jn{static supported(e=[]){return self.LanguageDetector&&"function"==typeof self.LanguageDetector.create&&"function"==typeof self.LanguageDetector.availability&&!e.includes("uk")&&!e.includes("br")&&!e.includes("ast")&&!e.includes("crh")&&this.isAtLeastChromeVersion(138)}static isAtLeastChromeVersion(e){return navigator.userAgent.includes("Chrome/")&&Number((navigator.userAgent.match(/Chrome\/(\d+)/)||[void 0,0])[1])>=e&&!navigator.userAgent.includes("Chromium/")&&!navigator.userAgent.includes("Edge/")&&!navigator.userAgent.includes("Edg/")&&!navigator.userAgent.includes("YaBrowser/")&&!navigator.userAgent.includes("OPR/")&&!navigator.userAgent.includes("Brave/")}static async init(){if(this.supported()&&["downloadable","available"].includes(await self.LanguageDetector.availability()))try{this._browserLanguageDetector=this._browserLanguageDetector||await self.LanguageDetector.create()}catch(e){}}static async detect(e,t,r=!1){if(!this.supported(t))throw new Error("Language detection unsupported");if("unavailable"===await self.LanguageDetector.availability())throw new Error("Language detection unavailable");let n=this.normalizeText(e);n||(n=e.trim()),n=n.slice(0,1e4);let s=this.normalizeLanguages(t);s.length&&n.length<fn&&!r&&(s=this.addLanguagesToDetect(s,n));const a=function(e,t){if(e.length>50)return null;const r=e.trim(),n=r.replace(mn,"").replace(_n,"").trim().toLowerCase();if(t.includes("de")&&(un.test(r)||gn.test(n)))return"de";if(t.includes("pt")&&dn.test(n))return"pt";if(t.includes("ca")&&hn.test(n))return"ca";const s=ln[n];return s&&t.includes(s)?s:null}(n,t);if(a)return{language:a,confidence:.99};this._browserLanguageDetector=this._browserLanguageDetector||await self.LanguageDetector.create();let i=await this._browserLanguageDetector.detect(n);return i=i.filter(e=>!Hn.includes(e.detectedLanguage)&&!e.detectedLanguage.endsWith("-Latn")),!r&&1===i.length&&i[0].confidence>.9&&n.length>10&&n.split(" ").length>1?{language:this.mapToSupportedLanguageCode(i[0].detectedLanguage),confidence:i[0].confidence}:(!t.includes("gl")&&(t.includes("pt")||t.includes("ca")||t.includes("es"))&&(i=i.filter(e=>"gl"!==e.detectedLanguage)),s.length&&(n.length<fn||r)&&(i=i.filter(e=>s.includes(e.detectedLanguage.toLowerCase()))),i[0]?{language:this.mapToSupportedLanguageCode(this.getPrimaryLanguageCode(i[0].detectedLanguage)),confidence:i[0].confidence}:null)}static normalizeText(e){return e=this.stripEmojis(e),e=this.stripEmailAdresses(e),e=this.stripURLs(e),e=this.stripSmileys(e),e=this.stripBulletPoints(e),e=this.stripFileNamesAndDomains(e),e=this.stripTokensWithNumbers(e),e=this.stripNumbers(e),e=this.stripMentions(e),e=this.stripUnicodeHearts(e),e=this.stripInvisibleWhitespace(e),e=this.stripChatCommands(e),e=this.stripHashTags(e),e=this.stripRepeatedWords(e),e=this.stripLeftoverChars(e),e=this.normalizePunctuation(e),e=this.normalizeHyphens(e),(e=this.normalizeWhitespace(e)).trim()}static stripEmojis(e){return e.replace(Bn,"")}static stripEmailAdresses(e){return e.replace(Sn,"")}static stripURLs(e){return e.replace(Tn,"")}static stripFileNamesAndDomains(e){return e.replace(Gn,"")}static stripBulletPoints(e){return e.replace(Rn,"").replace(In,"").replace(Pn,"")}static stripMentions(e){return e.replace(An,"")}static stripSmileys(e){return e.replace(yn,"")}static stripUnicodeHearts(e){return e.replace(bn,"")}static stripTokensWithNumbers(e){return e.replace(On,"")}static stripHashTags(e){return e.replace(Mn,"")}static stripNumbers(e){return e.replace(Ln,"").replace(Cn,"")}static stripInvisibleWhitespace(e){return e.replace(xn,"")}static stripChatCommands(e){return e.replace(Un,"")}static stripLeftoverChars(e){return e.replace(Fn,"")}static stripRepeatedWords(e){try{return e.replace(new RegExp("(?<![\\p{L}])([\\p{L}]+(?:-[\\p{L}]+)*)(?:\\s+\\1)+(?![\\p{L}])","giu"),"$1")}catch(t){return e.replace(/(^|[^a-zäöüß-])([a-zäöüß]+(?:-[a-zäöüß]+)*)(?:\s+\2)+(?![a-zäöüß-])/gi,"$1$2")}}static normalizeHyphens(e){return e.replace(vn,"-").replace(Dn,"-")}static normalizePunctuation(e){return e.replace(Nn,"!").replace(wn,(e,t)=>t.charAt(0))}static normalizeWhitespace(e){return e.replace(kn,e=>e.includes("\n")?"\n":" ")}static addLanguagesToDetect(e,t){return e=rr(e.concat(function(e){e=e.slice(0,50);let t=0,r=0,n=0,s=0,a=0,i=0,o=0,c=0,l=0,u=0,g=0;for(let d=0;d<e.length;d++){const h=e[d]??"",m=h.charCodeAt(0);/\s/.test(h)||/\d/.test(h)||"."===h||g++,En(m,1536,1791)&&t++,En(m,1024,1279)&&r++,(En(m,19968,40959)||En(m,12352,12447)||En(m,12448,12543))&&n++,En(m,6016,6143)&&s++,En(m,2946,3066)&&a++,(En(m,880,1023)||En(m,7936,8191))&&i++,En(m,2304,2431)&&o++,En(m,3584,3711)&&c++,(En(m,1424,1535)||En(m,64285,64320))&&l++,(En(m,44032,55215)||En(m,4352,4607)||En(m,12592,12687)||En(m,43360,43391)||En(m,55216,55295))&&u++}if(0===g)return[];const d=e=>e/g,h=[];return d(t)>=pn&&h.push("ar","fa"),d(r)>=pn&&h.push("ru","uk","be"),d(n)>=pn&&h.push("zh","ja"),d(s)>=pn&&h.push("km"),d(a)>=pn&&h.push("ta"),d(i)>=pn&&h.push("el"),d(o)>=pn&&h.push("hi","mr"),d(c)>=pn&&h.push("th"),d(l)>=pn&&h.push("he"),d(u)>=pn&&h.push("ko"),h}(t))),t.includes("ß")&&!e.includes("de")&&e.push("de"),!t.includes("ł")&&!t.includes("Ł")||e.includes("pl")||e.push("pl"),!t.includes("¡")&&!t.includes("¿")||e.includes("es")||e.push("es"),e}static mapToSupportedLanguageCode(e){return Wn[e]||e}static normalizeLanguages(e){return e.map(e=>this.getPrimaryLanguageCode(e))}static getPrimaryLanguageCode(e){return e.split("-")[0].toLowerCase()}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Vn{static getServerBaseUrl(e,t=!1,r=!0){const n=r&&(t?this._useFallbackServerForParagraphLevelRequests:this._useFallbackServerForTextLevelRequests)&&!e.apiServerUrl;return e.apiServerUrl&&!this._isLanguageToolServer(e.apiServerUrl)?e.apiServerUrl:e.isPremium||e.user||e.apiServerUrl===z?n?K:z:n?Y:q}static _getServerFullUrl(e,t=!1){const r=this.getServerBaseUrl(e,t),n=r.endsWith("/")?"":"/",s=new URL(r+n+"check");return s.searchParams.set("c","1"),s.searchParams.set("instanceId",e.instanceId),e.version&&s.searchParams.set("v",e.version),s.toString()}static _abortTextLevelCheckRequest(e){this._textLevelAbortControllers.has(e)&&(this._textLevelAbortControllers.get(e).abort(),this._textLevelAbortControllers.delete(e))}static _abortParagraphLevelCheckRequest(e){this._paragraphLevelAbortControllers.has(e)&&(this._paragraphLevelAbortControllers.get(e).abort(),this._paragraphLevelAbortControllers.delete(e))}static _abortLanguageDetectionRequest(e){this._languageDetectionAbortControllers.has(e)&&(this._languageDetectionAbortControllers.get(e).abort(),this._languageDetectionAbortControllers.delete(e))}static _abortRecommendationRequest(e){const t=this._recommendationAbortControllers.get(e);t&&(t.abort(),this._recommendationAbortControllers.delete(e))}static abortTextLevelCheck(e){this._abortTextLevelCheckRequest(e)}static abortParagraphLevelCheck(e){this._abortParagraphLevelCheckRequest(e)}static abortLanguageDetection(e){this._abortLanguageDetectionRequest(e)}static abortRecommendation(e){this._abortRecommendationRequest(e)}static _prepareText(e){return e.replace(this.ZWNJ_REGEXP,this.ZWS)}static _joinInChunks(e,t=Ee){const r=[];let n=0,s=[];return e.forEach(e=>{n>t&&(n=0,s=[]),s.push(e),n+=e.text.length,r.includes(s)||r.push(s)}),r}static _getRequestData(e,t,r){const n=new URLSearchParams,s={text:e};r.recipientInfo&&(r.recipientInfo.address||r.recipientInfo.fullName)&&(s.metaData={EmailToAddress:r.recipientInfo.address,FullName:r.recipientInfo.fullName}),n.append("data",JSON.stringify(s));const a=Boolean(r.isPremium||!r.apiServerUrl||r.apiServerUrl&&r.apiServerUrl.startsWith(z)||r.apiServerUrl&&!this._isLanguageToolServer(r.apiServerUrl));if(a&&r.user&&"password"in r.user?(n.append("username",r.user.email),n.append("password",r.user.password)):a&&r.user&&"token"in r.user&&(n.append("username",r.user.email),n.append("tokenV2",r.user.token)),n.append("textSessionId",r.instanceId),!r.isPremium&&r.enableHiddenMatches&&n.append("enableHiddenRules","true"),r.motherTongue&&tt.includes(r.motherTongue)&&n.append("motherTongue",r.motherTongue),"normal"!==r.checkLevel&&n.append("level",r.checkLevel.replace("hidden-","")),t)n.append("language",t.code);else{n.append("language","auto"),n.append("noopLanguages",r.preferredLanguages.join(","));const e=this._getPreferredVariants(r.languageVariants);e.length>0&&n.append("preferredVariants",e.toString())}if(r.testGroups){const e=[];for(const[t,n]of Object.entries(r.testGroups))n&&e.push(t);e.length&&n.append("abtest",e.join(","))}if(n.append("preferredLanguages",r.preferredLanguages.join(",")),r.forcePreferredLanguages&&n.append("forcePreferredLanguages","true"),r.writingGoalId){const e=this.HIGH_LEVEL_GOALS.find(e=>e.id===r.writingGoalId);e&&n.append("toneTags",e.tags.join(","))}const i=["WHITESPACE_RULE"].concat(r.disabledRules.filter(e=>Ke.includes(e)));return n.append("disabledRules",i.join(",")),r.userAgent&&n.append("useragent",r.userAgent),n}static _getHeaders(e){if(!e.accessToken)return;const t=new Headers;return t.append("Authorization",`Bearer ${e.accessToken}`),t}static _getPreferredVariants(e){return Object.values(e)}static _getTextLevelRequestData(e,t,r){const n=this._getRequestData(e,t,r);return n.append("mode","textLevelOnly"),n}static _getParagraphLevelCheckRequestData(e,t,r){const n=this._getRequestData(e,t,r);return n.append("mode","allButTextLevelOnly"),n.append("allowIncompleteResults",String(r.allowIncompleteResults||!1)),n}static async _sendRequest(e,t,r=M){const n=fetch(e,t).catch(t=>{throw"AbortError"===t.name?{reason:"AbortError",status:0,response:t.message||""}:{reason:"ConnectionError",status:0,url:e.replace(/\?.*/,""),response:t.message||""}}).then(this._checkForException).then(e=>e.json()),s=new Promise((t,n)=>{setTimeout(()=>{n({reason:"TimeoutError",status:0,url:e.replace(/\?.*/,""),response:""})},r)});return Promise.race([n,s])}static _isConnectionOrServerIssue(e){return ie.includes(e.status)||["ConnectionError","TimeoutError"].includes(e.reason)}static _getGraphemesCount(e,t,r=0){for(let n=r;n<e.length;n++){if(t<=0)return n-r;t-=e[n].length}return e.length-r}static _getCodepointsCount(e,t,r=0){let n=0;for(let s=r;s<Math.min(e.length,r+t);s++)n+=e[s].length;return n}static _correctMatches(e,t,r){if(t!==r){const n=ir(t),s=ir(r);for(const t of e){const e=Vn._getGraphemesCount(n,t.offset),r=Vn._getGraphemesCount(n,t.length,e);t.offset=Vn._getCodepointsCount(s,e),t.length=Vn._getCodepointsCount(s,r,e)}}return e}static _getLeftText(e,t,r,n=15,s=!1,a=[],i="auto",o=!1){let c=Math.max(t-n,0);if(s&&a.length>0){const e=a.find(e=>t>=e.start&&t<=e.end);e&&(c=o?e.start:Math.max(c,e.start))}if(r){const r=e.lastIndexOf("\n",t);r>=c&&(c=r+1)}let l=e.substring(c,t).replace(this.NON_ALPHANUMERIC_AT_BEGINNING_REGEXP,""),u=!1;return u="always"===i?0!==c:"never"!==i&&!(0===c||r&&"\n"===e[c-1]||s&&a.some(e=>c===e.start)),u&&(l="..."+l),l}static _getRightText(e,t,r,n=15,s=!1,a=[],i="auto",o=!1){let c=Math.min(t+n,e.length);if(s&&a.length>0){const e=a.find(e=>t>=e.start&&t<=e.end);e&&(c=o?e.end:Math.min(c,e.end))}if(r){const r=e.indexOf("\n",t);-1!==r&&r<=c&&(c=r)}let l=e.substring(t,c).replace(this.NON_ALPHANUMERIC_AT_END_REGEXP,""),u=!1;return u="always"===i?c!==e.length:"never"!==i&&!(c===e.length||r&&"\n"===e[c]||s&&a.some(e=>c===e.end)),u&&(l+="..."),l}static _transformMatches(e,t,r,n=!1,s,a=[]){return e.map(e=>{const i=e.rule.id.startsWith("DB_"),o=this.SPELLING_RULES_ID.some(t=>e.rule.id.includes(t)),c=this.STYLE_ISSUE_TYPES.some(t=>e.rule.issueType===t),l="typographical"===e.rule.issueType&&"CASING"!==e.rule.category.id||"PUNCTUATION"===e.rule.category.id||"TYPOGRAPHY"===e.rule.category.id||e.rule.category.id.includes("KOMMA"),u=Boolean(e.rule.tags&&e.rule.tags.includes("picky")),g="RECOMMENDATION"===e.rule.issueType||"PHRASAL_RECOMMENDATION"===e.rule.issueType,d=!1===e.rule.showInline,h=t.substr(e.offset,e.length),m=s?.strictByParagraph??n,_=s?.useSentenceAwareContext??!1,p=s?.shortContext,E=p?.maxContextLength??15,f=p?.ellipsisMode??"auto",S=p?.forceCompleteSentences??!1,T=s?.longContext,A=T?.maxContextLength??60,C=T?.ellipsisMode??"auto",R=T?.forceCompleteSentences??!1,I=`${Vn._getLeftText(t,e.offset,m,E,_,a,f,S)}|${h}|${Vn._getRightText(t,e.offset+e.length,m,E,_,a,f,S)}`,P=Vn._getLeftText(t,e.offset,!0,A,_,a,C,R),L=Vn._getRightText(t,e.offset+e.length,!0,A,_,a,C,R),y=`${er(P)}<lt-em>${er(h)}</lt-em>${er(L)}`;let b="";e.shortMessage&&e.shortMessage.length<60&&e.shortMessage!==e.message&&(b=e.shortMessage.replace(this.PUNCTUATION_AT_END,""));const O=e.replacements.map(e=>({value:e.value,htmlValue:e.htmlValue,prefix:e.prefix,suffix:e.suffix,type:e.type,shortDescription:e.shortDescription}));return{isParagraphLevelCheck:n,rule:e.rule,isCustomError:i,isSpellingError:o,isStyleError:c,isPunctuationError:l,isPicky:u,isRecommendation:g,isOptional:d,contextForSureMatch:e.contextForSureMatch,language:{code:r.code,name:r.name},description:e.message,shortDescription:b,goodExample:e.goodExample,badExample:e.badExample,start:e.offset,end:e.offset+e.length,length:e.length,originalPhrase:h,contextPhrase:I,longContextPhrase:y,fixes:O,isLocked:e.isLocked}})}static _adjustErrors(e,t,r){const n=r.recipientInfo?r.recipientInfo.fullName.split(" ").filter(e=>e):[];return e.filter(e=>{if(!e.isPicky&&e.rule.id.startsWith("QB_NEW_")&&1===e.fixes.length&&e.originalPhrase+"."===e.fixes[0].value&&(e.end===t.length||"\n"===t.substring(e.end,e.end+1))&&(e.isPicky=!0,!r.checkLevel.includes("picky")))return!1;if(e.originalPhrase.startsWith(_t)){const t=e.originalPhrase.length;if(e.originalPhrase=e.originalPhrase.replace(jt,""),e.start+=t-e.originalPhrase.length,e.fixes[0]&&e.originalPhrase===e.fixes[0].value)return!1}if(e.originalPhrase.endsWith(_t)){const t=e.originalPhrase.length;if(e.originalPhrase=function(e){return e.replace(Vt,"")}(e.originalPhrase),e.end-=t-e.originalPhrase.length,e.fixes[0]&&e.originalPhrase===e.fixes[0].value)return!1}e.fixes=e.fixes.filter(t=>t.value!=="("+e.originalPhrase+")"&&t.value!==e.originalPhrase&&"(suggestion limit reached)"!==t.value&&"(se ha alcanzado el límite de sugerencias)"!==t.value&&"(Vorschlagslimit erreicht)"!==t.value),e.language.code.startsWith("en")&&Xt(e.originalPhrase)&&!/[a-z]/i.test(e.contextPhrase)&&e.fixes.forEach(t=>{t.value.toLowerCase()!==e.originalPhrase.toLowerCase()&&(t.value=t.value.toUpperCase())}),"PT_CLICHE_REPLACE"!==e.rule.id&&"PT_WORDINESS_REPLACE"!==e.rule.id||e.fixes.forEach(t=>{(t.value.startsWith("REFORMULAR")||t.value.startsWith("APAGAR")||t.value.startsWith("ESPECIFICAR"))&&(e.description=e.description.replace(/\sÉ preferível dizer.+(REFORMULAR|APAGAR|ESPECIFICAR).+$/,""),t.value="")});if(this.EMAIL_SIGNATURE_SEPARATOR_REGEXP.test(e.originalPhrase))return!1;if(this.INVISIBLE_PHRASE_REGEXP.test(e.originalPhrase))return!1;if(e.rule.id.endsWith("WORD_REPEAT_BEGINNING_RULE")&&this.ONLY_NUMBERS_REGEXP.test(e.originalPhrase))return!1;if("LEERZEICHEN_HINTER_DOPPELPUNKT"===e.rule.id&&this.COLON_WHITESPACE_REGEXP.test(e.originalPhrase))return!1;const s=t.substring(e.start-25,e.start),a=t.substr(e.end,25);if(r.ignoreCapitalizationErrorsAtLineStart&&"UPPERCASE_SENTENCE_START"===e.rule.id&&this.PREVENT_MID_SENTENCE_CAPITALIZATION.test(s))return!1;if(r.ignoreCapitalizationErrorsAtLineStart&&"PUNCTUATION_PARAGRAPH_END"===e.rule.id&&this.PREVENT_MID_SENTENCE_PUNCTUATION.test(a))return!1;if("DE_CASE"===e.rule.id&&this.BULLET_POINT_REGEXP.test(s))return!1;if("DE_CASE"===e.rule.id&&this.NUMBER_WITH_PARENTHESIS_AT_END_REGEXP.test(s))return!1;if("DE_CASE"===e.rule.id&&this.PIPE_AT_END_REGEXP.test(s))return!1;if("DE_CASE"===e.rule.id&&this.MARKDOWN_HEADLINE_REGEXP.test(s))return!1;if("DE_CASE"===e.rule.id&&this.EMOJI_SENTENCE_START_REGEXP.test(s))return!1;if("LEERZEICHEN_HINTER_DOPPELPUNKT"===e.rule.id&&this.MARKDOWN_INLINE_FORMAT_AT_BEGINNING_REGEXP.test(a))return!1;if("LEERZEICHEN_HINTER_DOPPELPUNKT"===e.rule.id&&this.WIKI_MARKUP_AT_END_REGEXP.test(s))return!1;if(e.rule.id.endsWith("UNPAIRED_BRACKETS")&&this.ONE_LETTER_AT_END_REGEXP.test(s))return!1;if(e.rule.id.endsWith("UNPAIRED_BRACKETS")&&this.NUMBER_WITH_DOT_AT_END_REGEXP.test(s))return!1;if("SENTENCE_WHITESPACE"===e.rule.id&&s.endsWith("{!"))return!1;if("SENTENCE_WHITESPACE"===e.rule.id&&this.SINGLE_UPPERCASE_LETTER_REGEXP.test(e.originalPhrase)&&this.ABBREVIATION_AT_END_REGEXP.test(s))return!1;if("SENTENCE_WHITESPACE"===e.rule.id&&"net"===e.originalPhrase.toLowerCase())return!1;if("COMMA_PARENTHESIS_WHITESPACE"===e.rule.id&&this.NET_AT_BEGINNING_REGEXP.test(a))return!1;if(e.rule.id.startsWith("AI_")&&1===e.fixes.length&&e.originalPhrase.replace(this.INVISIBLE_CHARS_REGEXP,"")===e.fixes[0].value)return!1;if("COMMA_PARENTHESIS_WHITESPACE"===e.rule.id&&e.originalPhrase.endsWith(")")&&s.endsWith(this.ZWS))return!1;if("COMMA_PARENTHESIS_WHITESPACE"===e.rule.id&&e.originalPhrase.endsWith(".")&&this.FILE_TYPE_AT_BEGINNING_REGEXP.test(a))return!1;if("COMMA_PARENTHESIS_WHITESPACE"===e.rule.id&&s.endsWith("(")&&(",)"===e.originalPhrase||".)"===e.originalPhrase))return!1;if("COMMA_PARENTHESIS_WHITESPACE"===e.rule.id&&s.endsWith("\n")&&[")","}","]","."].includes(e.originalPhrase))return!1;if("COMMA_PARENTHESIS_WHITESPACE"===e.rule.id&&a.startsWith("/"))return!1;if("COMMA_PARENTHESIS_WHITESPACE"===e.rule.id&&e.originalPhrase.includes(this.ZWS))return!1;if("WORT1_BINDESTRICH_SPACE_WORT2"===e.rule.id&&e.originalPhrase.endsWith(this.ZWS))return!1;if("MULTIPLICATION_SIGN"===e.rule.id&&(this.AT_LEAST_TWO_LETTERS_AT_END_REGEXP.test(s)||!a||this.PUNCTUATION_AT_BEGINNING_REGEXP.test(a)))return!1;if("ZBEDNA_SPACJA_PRZED"===e.rule.id&&e.originalPhrase.includes(this.ZWS))return!1;if("UNLIKELY_OPENING_PUNCTUATION"===e.rule.id&&this.PUNCTUATION_SPACE_AT_END_REGEXP.test(s))return!1;if("WORD_CONTAINS_UNDERSCORE"===e.rule.id&&(!this.LOWERCASE_REGEXP.test(e.originalPhrase)||e.originalPhrase.includes("-")||e.originalPhrase.includes("__")||this.SLASH_AT_END_REGEXP.test(s)||this.SLASH_AT_BEGINNING_REGEXP.test(a)))return!1;if("WORD_CONTAINS_UNDERSCORE"===e.rule.id&&s.endsWith("[")&&a.startsWith("]"))return!1;if("WORD_CONTAINS_UNDERSCORE"===e.rule.id&&at.test(s)&&it.test(a))return!1;if("WORD_CONTAINS_UNDERSCORE"===e.rule.id&&(s.endsWith("=")||s.endsWith("&")||s.endsWith("?")))return!1;if(["APOS_INCORRECT","LOOSE_ACCENTS"].includes(e.rule.id)&&"`"===e.originalPhrase)return!1;if(["_2_AANH_B","FALSCHES_ANFUEHRUNGSZEICHEN_2"].includes(e.rule.id)&&"``"===e.originalPhrase)return!1;if("DASH_RULE"===e.rule.id&&a.startsWith(" [")&&(!s||s.endsWith("\n")))return!1;if(e.isSpellingError&&e.originalPhrase.length>6&&e.fixes.length>4&&e.language.code.startsWith("de")&&(e.fixes.length=4),e.isSpellingError||"WORD_CONTAINS_UNDERSCORE"===e.rule.id){const t=e.originalPhrase.charAt(0),i=e.originalPhrase.toLowerCase();if(dr(e,r.dictionary))return!1;if((a.startsWith("_")||s.endsWith("_"))&&!e.language.code.startsWith("de"))return!1;if(e.originalPhrase.startsWith("$")&&a.startsWith("}")&&s.endsWith("{"))return!1;if(e.originalPhrase.startsWith("$")&&e.originalPhrase.endsWith("$"))return!1;if(this.HTML_ENTITIES.includes(e.originalPhrase)&&s.endsWith("&")||this.HTML_ENTITIES_WITH_AND.includes(e.originalPhrase)||this.HTML_ENTITIES_WITH_AND.includes("&"+e.originalPhrase))return!1;if(this.COMMON_TLDS.some((e,t)=>i.endsWith("."+e)||this.COMMON_TLD_WITH_DOT_REGEXPS[t].test(a)))return!1;if(this.DOT_WITH_PREFIX_REGEXP.test(s)&&this.COMMON_TLDS.includes(i))return!1;if(this.COMMON_FILE_TYPES.some((e,t)=>i.endsWith("."+e)||this.COMMON_FILE_TYPE_WITH_DOT_REGEXPS[t].test(a)))return!1;if(this.DOT_WITH_PREFIX_REGEXP.test(s)&&this.COMMON_FILE_TYPES.includes(i))return!1;const o="@"===t||this.MENTION_SYMBOL_AT_BEGINNING_REGEXP.test(s),c="#"===t||this.HASH_SYMBOL_AT_BEGINNING_REGEXP.test(s);if(o||c)return!1;if(n.some(t=>t===e.originalPhrase))return!1;if(this.WAVY_DASH_REGEXP.test(e.originalPhrase))return!1;for(const t of n)if(t.toLowerCase()===e.originalPhrase.toLowerCase()&&!e.fixes.some(e=>e.value===t)){e.fixes.unshift({value:t});break}}return!0})}static _processResponse(e,t,r,n,s,a=!1,i=!1,o=!1){e.matches=this._correctMatches(e.matches,r,n);let c=this._transformMatches(e.matches,n,e.language,a,s?.contextConfig,t);c=this._adjustErrors(c,n,s);let l=[];const u=[],g=[];if(t=this._correctMatches(t.filter(({start:e,end:t})=>t-e>-1).map(({start:e,end:t,detectedLanguages:r,checkStatus:n})=>({offset:e,length:t-e,detectedLanguages:r,checkStatus:n})),r,n).map(({offset:e,length:t,detectedLanguages:r,checkStatus:n})=>({start:e,end:e+t,length:t,detectedLanguages:r,checkStatus:n})),i)return{errors:[],premiumErrors:[],pickyErrors:[],premiumPickyErrors:[],sentenceRanges:t};if(o){const e=I.get(A.FIX_ALL_CONFIG);return{errors:c.filter(t=>!(!t.isRecommendation||e.FIX_RECOMMENDATIONS)||(!(!t.isStyleError||e.FIX_STYLE_ERRORS)||!e.FIX_GC_ERRORS)),premiumErrors:[],pickyErrors:[],premiumPickyErrors:[],sentenceRanges:t}}return s.debug&&c.forEach(e=>{e.description=(e.rule.isPremium?"prem:":"")+e.rule.id+"["+(e.rule.subId||"")+"] "+e.description}),e.hiddenMatches&&(l=l.concat(this._transformMatches(e.hiddenMatches,n,e.language,a,s?.contextConfig,t))),"hidden-picky"===s.checkLevel&&(c=c.filter(e=>!e.isPicky||(g.push(e),!1)),e.hiddenMatches&&(l=l.filter(e=>!e.isPicky||(u.push(e),!1)))),{errors:c,premiumErrors:l,pickyErrors:g,premiumPickyErrors:u,sentenceRanges:t}}static _correctErrorOffsets(e,t){const r=[];let n=0;for(const s of e){const e=s.text.length;for(const a of t)if(a.start>=n&&a.end<=n+e){const e=Object.assign({},a);e.start=e.start-n+s.offset,e.end=e.start+e.length,e.rule?.phraseDiff?.forEach(e=>{e.sourceStart=e.sourceStart-n+s.offset,e.sourceEnd=e.sourceEnd-n+s.offset,e.targetEnd=e.targetEnd-n+s.offset,e.targetStart=e.targetStart-n+s.offset}),r.push(e)}n+=e+2}return r}static async checkTextLevel(e,t,r){e=this._prepareText(e);const n=Boolean(r.adapter);if(!e.trim()||n)return{language:t,errors:[],premiumErrors:[],pickyErrors:[],premiumPickyErrors:[]};this._abortTextLevelCheckRequest(r.instanceId),this._textLevelAbortControllers.set(r.instanceId,new AbortController),this._useFallbackServerForTextLevelRequests&&Date.now()-this._mainServerUnavailabilityTimeStamp>=oe&&(this._useFallbackServerForTextLevelRequests=!1);const s=e.normalize(),a=this._getServerFullUrl(r,!1),i={method:"post",mode:"cors",credentials:"omit",body:this._getTextLevelRequestData(s,t,r),headers:this._getHeaders(r),signal:this._textLevelAbortControllers.get(r.instanceId).signal};return this._sendRequest(a,i).then(t=>{const{errors:n,premiumErrors:a,pickyErrors:i,premiumPickyErrors:o}=this._processResponse(t,[],s,e,r);return{language:{code:t.language.code,name:t.language.name,detectedLanguage:t.language.detectedLanguage},errors:n,premiumErrors:a,pickyErrors:i,premiumPickyErrors:o}}).catch(n=>{if(this._isConnectionOrServerIssue(n)){this._abortTextLevelCheckRequest(r.instanceId);if(!r.apiServerUrl&&!this._useFallbackServerForTextLevelRequests)return this._useFallbackServerForTextLevelRequests=!0,this._mainServerUnavailabilityTimeStamp=Date.now(),this.checkTextLevel(e,t,r)}throw n})}static _buildSentenceRanges(e,t){if(!t.extendedSentenceRanges&&!t.sentenceRanges)return[];let r=t.extendedSentenceRanges;r||(r=(t.sentenceRanges||[]).map(e=>({from:e[0],to:e[1],detectedLanguages:[{language:t.language.code.split("-")[0],rate:1}]})));return((e,t)=>{const r=new RegExp(_t,"g"),n=[];for(const s of e){const{start:e,end:a}=s,i=t.substring(e,a);if(!i.replace(r,"").trim())continue;const[o,c]=Zt(i),l=e+o,u=l+i.length-o-c,g=u-l;n.push({start:l,end:u,length:g,detectedLanguages:s.detectedLanguages,checkStatus:s.checkStatus})}return n})(r.map(e=>({start:e.from,end:e.to,length:e.to-e.from,detectedLanguages:e.detectedLanguages.map(e=>({language:e.language,confidence:e.rate})),checkStatus:e.checkStatus})),e)}static cancelAllRequests(e){this._abortParagraphLevelCheckRequest(e),this._abortLanguageDetectionRequest(e),this._abortTextLevelCheckRequest(e),this._abortRecommendationRequest(e)}static async checkParagraphLevel(e,t,r,n,s,a,i){e.forEach(e=>{e.text=this._prepareText(e.text)});if(!e.some(e=>!!e.text.trim())){const c={input:{acceptChangeType:gr.GC,language:t?.code,paragraphs:e,editorCompleteText:n||"",preferredVariants:this._getPreferredVariants(r.languageVariants),disableRecommendations:r.disableRecommendations,replacementText:a?.replacementText,hasUserAppliedFix:!1,changedParagraphsSentencesLength:s,appliedFixAll:i,writingGoal:r.writingGoalId,changedContent:r.changedContent||[]},signal:this._paragraphLevelAbortControllers.get(r.instanceId).signal,handleResponseCallback:(t,n)=>{if("editor_content_save_ack"===n)r?.handleResponseCallback?.(t,"editor_content_save_ack");else{const a=this._postProcessParagraphLevelCheckResult(t,e,e.map(e=>e.text).join("\n\n").normalize(),e.map(e=>e.text).join("\n\n"),r,o,s,i);r.handleResponseCallback?.(a,n)}},metaData:{instanceId:r.instanceId,tabId:r.tabId,hostUrl:r.hostUrl||"",hostCategory:r.hostCategory,writingSessionId:r.writingSessionId,lastEditorContentSavedTimestamp:r.lastEditorContentSavedTimestamp}};return r?.adapter?.grammarCheck?.(c),{language:t,errors:[],premiumErrors:[],pickyErrors:[],premiumPickyErrors:[],isIncompleteResult:!1,areErrorsSuppressed:!1}}this._abortParagraphLevelCheckRequest(r.instanceId),this._paragraphLevelAbortControllers.set(r.instanceId,new AbortController),this._useFallbackServerForParagraphLevelRequests&&Date.now()-this._mainServerUnavailabilityTimeStamp>=oe&&(this._useFallbackServerForParagraphLevelRequests=!1);let o=!1;if(a&&a.ruleId){const e=I.get(A.AI_RULE_ID_REGEX);o=e.test(a.ruleId)}const c=this._getServerFullUrl(r,!0);let l=[e];r.adapter||(l=this._joinInChunks(e));const u=[];for(const e of l){const l=e.map(e=>e.text).join("\n\n"),g=l.normalize(),d={method:"post",mode:"cors",credentials:"omit",body:this._getParagraphLevelCheckRequestData(g,t,r),headers:this._getHeaders(r),signal:this._paragraphLevelAbortControllers.get(r.instanceId).signal},h=(t,n)=>{if("editor_content_save_ack"===n)r.handleResponseCallback?.(t,"editor_content_save_ack");else{const a=this._postProcessParagraphLevelCheckResult(t,e,g,l,r,o,s,i);r.handleResponseCallback?.(a,n)}};let m;m="REPHRASING"===a?.ruleId?gr.REPHRASING:a?.isRecommendation?gr.GC_RECOMMENDATION:gr.GC;const _={input:{acceptChangeType:m,language:t?.code,paragraphs:e,editorCompleteText:n||"",preferredVariants:this._getPreferredVariants(r.languageVariants),disableRecommendations:r.disableRecommendations,replacementText:a?.replacementText,hasUserAppliedFix:!!a&&o,changedParagraphsSentencesLength:s,appliedFixAll:i,writingGoal:r.writingGoalId,changedContent:r.changedContent||[],responseType:r.responseType},signal:this._paragraphLevelAbortControllers.get(r.instanceId).signal,handleResponseCallback:h,metaData:{instanceId:r.instanceId,tabId:r.tabId,hostUrl:r.hostUrl||"",hostCategory:r.hostCategory,writingSessionId:r.writingSessionId,lastEditorContentSavedTimestamp:r.lastEditorContentSavedTimestamp}},p=(r.adapter?r.adapter?.grammarCheck(_):this._sendRequest(c,d)).then(t=>this._postProcessParagraphLevelCheckResult(t,e,g,l,r,o,s,i));u.push(p)}return Promise.all(u).then(e=>{const t=e[0].language,r=e[0].areErrorsSuppressed,n=e[0].metaData;return{language:t,errors:Array.prototype.concat.apply([],e.map(e=>e.errors)),premiumErrors:Array.prototype.concat.apply([],e.map(e=>e.premiumErrors)),premiumPickyErrors:Array.prototype.concat.apply([],e.map(e=>e.premiumPickyErrors)),pickyErrors:Array.prototype.concat.apply([],e.map(e=>e.pickyErrors)),isIncompleteResult:e.some(e=>e.isIncompleteResult),sentenceRanges:Array.prototype.concat.apply([],e.filter(e=>Boolean(e.sentenceRanges)).map(e=>e.sentenceRanges)),areErrorsSuppressed:r,metaData:n}}).catch(s=>{if(this._isConnectionOrServerIssue(s)){this._abortParagraphLevelCheckRequest(r.instanceId);if((!r.apiServerUrl||this._isLanguageToolServer(r.apiServerUrl))&&!this._useFallbackServerForParagraphLevelRequests)return this._useFallbackServerForParagraphLevelRequests=!0,this._mainServerUnavailabilityTimeStamp=Date.now(),this.checkParagraphLevel(e,t,r,n)}throw s})}static _postProcessParagraphLevelCheckResult(e,t,r,n,s,a,i,o){const{language:c,warnings:l}=e,u=e.ignoreRanges||[];s.debug&&u.length&&(e.matches=this._filterErrorsInIgnoredRanges(e.matches,u),e.hiddenMatches&&(e.hiddenMatches=this._filterErrorsInIgnoredRanges(e.hiddenMatches,u)),this._addIgnoredRangeMatches(r,e.matches,u));let g=this._buildSentenceRanges(r,e);const d=s.adapter?.grammarCheck?a:a&&1===t.length&&g.length===i,{errors:h,premiumErrors:m,pickyErrors:_,premiumPickyErrors:p,...E}=this._processResponse(e,g,r,n,s,!0,d,o);g=E.sentenceRanges;const f=this._correctErrorOffsets(t,h),S=this._correctErrorOffsets(t,m),T=this._correctErrorOffsets(t,_),A=this._correctErrorOffsets(t,p);return g=this._correctErrorOffsets(t,g),{language:{code:c.code,name:c.name},errors:f,premiumErrors:S,pickyErrors:T,premiumPickyErrors:A,isIncompleteResult:!!l&&l.incompleteResults,areErrorsSuppressed:d,sentenceRanges:g,metaData:e?.metaData}}static async checkRecommendation(e,t){e.isForcedRecommendation||this._abortRecommendationRequest(e.instanceId);const r=new AbortController;this._recommendationAbortControllers.set(e.instanceId,r);const n={input:{language:e.language.code,texts:e.texts,priorities:e.priorities,writingGoal:e.writingGoal||""},metaData:{...t?.metaData}};if(t?.adapter){const s=await t.adapter.recommendation(n,{...t.options,signal:t.options?.signal||r.signal});let a=[];t.contextConfig?.useSentenceAwareContext&&e.texts.length>0&&(a=e.texts.map(t=>{const r=t.offset,n=t.offset+t.text.length;return{start:r,end:n,length:n-r,detectedLanguages:[{language:e.language.code.split("-")[0],confidence:1}]}}));return this._transformMatches(s.matches||[],e.originalText,e.language,!0,t.contextConfig,a)}return new Promise(e=>{e([])})}static async unlockRecommendation(e,t){return await(t.adapter?.unlockRecommendation({lockId:e,metaData:t.metaData}))}static translateText(e,t){return t.adapter.translate(e)}static _filterErrorsInIgnoredRanges(e,t){return e.filter(e=>{const r=e.offset,n=e.offset+e.length;return!t.some(e=>r>=e.from&&r<=e.to||n>=e.from&&n<=e.to)})}static _addIgnoredRangeMatches(e,t,r){r.forEach(r=>{let n=r.to-r.from;const s=e.substring(r.from,r.to).match(/\s+$/);s&&(n-=s[0].length);const a={offset:r.from,length:n,rule:{id:"IGNORED_RANGE",category:{id:"IGNORED_RANGE",name:"Ignored Range"},issueType:"ignoredRange",description:"",isPremium:!1},contextForSureMatch:0,message:"This text is in a different language than the rest of the text.",shortMessage:"Different language: "+r.language.code,replacements:[]};t.push(a)})}static async detectLanguage(e,t,r){e=this._prepareText(e);const n=Boolean(r.adapter);if(!e.trim()||t||n)return{language:t,errors:[],premiumErrors:[],pickyErrors:[],premiumPickyErrors:[]};this._abortLanguageDetectionRequest(r.instanceId),this._languageDetectionAbortControllers.set(r.instanceId,new AbortController),this._useFallbackServerForLanguageDetection&&Date.now()-this._mainServerUnavailabilityTimeStamp>=oe&&(this._useFallbackServerForLanguageDetection=!1);const s=e.substr(0,1e3).normalize(),a=this._getServerFullUrl(r,!1),i={method:"post",mode:"cors",credentials:"omit",body:this._getTextLevelRequestData(s,t,r),headers:this._getHeaders(r),signal:this._languageDetectionAbortControllers.get(r.instanceId).signal};return this._sendRequest(a,i).then(e=>({language:{code:e.language.code,name:e.language.name},errors:[],premiumErrors:[],premiumPickyErrors:[],pickyErrors:[]})).catch(n=>{if(this._isConnectionOrServerIssue(n)){this._abortLanguageDetectionRequest(r.instanceId);if((!r.apiServerUrl||this._isLanguageToolServer(r.apiServerUrl))&&!this._useFallbackServerForLanguageDetection)return this._useFallbackServerForLanguageDetection=!0,this._mainServerUnavailabilityTimeStamp=Date.now(),this.detectLanguage(e,t,r)}throw n})}static _isLanguageToolServer(e){return!!e&&(e.includes("api.languagetool.org")||e.includes("languagetool.org/api")||e.includes("api.languagetoolplus.com"))}static checkForPaidSubscription(e,t,r,n=z){return new Promise((s,a)=>{n+=n.endsWith("/")?"check":"/check";const i=new URLSearchParams;i.append("language","en-us"),i.append("data",JSON.stringify({text:"The languagetool testrule 8634756."})),e&&t?(i.append("username",e),i.append("password",t)):e&&r&&(i.append("username",e),i.append("tokenV2",r));const o={method:"post",mode:"cors",credentials:"omit",body:i};this._sendRequest(n,o).then(e=>{const t=e.matches.some(e=>"PREMIUM_FAKE_RULE"===e.rule.id);s(t)}).catch(a)})}static addWordToDictionary(e,t){if(Boolean(t.adapter))return;const r=this.getServerBaseUrl(t),n=r.endsWith("/")?"":"/",s=new URL(r+n+"words/add");if(t.user&&"token"in t.user)s.searchParams.set("username",t.user.email),s.searchParams.set("tokenV2",t.user.token);else{if(!t.user||!("password"in t.user))return Promise.reject(new Error("Not logged-in for adding words to dictionary"));s.searchParams.set("username",t.user.email),s.searchParams.set("password",t.user.password)}return s.searchParams.set("word",e.trim()),fetch(s.toString(),{method:"POST"}).then(e=>e.ok?Promise.resolve():Promise.reject(new Error(`Status: ${e.status}`)))}static getLanguageVariant(e,t){if("en"===(e=e.toLowerCase()))return t.languageVariants.en||"en-us";if("de"===e)return t.languageVariants.de||"de-de";if("pt"===e)return t.languageVariants.pt||"pt-pt";if("ca"===e)return t.languageVariants.ca||"ca-es";return I.get(A.SUPPORTED_LANGUAGES).find(t=>t===e||t.startsWith(e+"-"))||e}static check(e,t,r,n,s,a,i,o,c){return"client"===o?this.checkWithClientLanguageDetection(e,t,r,n,s,a,i,c):this.checkWithServerLanguageDetection(e,t,r,n,s,a,i)}static async checkWithClientLanguageDetection(e,t,r,n,s,a,i,o){if(!t){let c=null,l=null;try{c=await jn.detect(e,r.preferredLanguages,r.forcePreferredLanguages)}catch(e){l=e.message}if(!c)return o&&o(l||"Could not detect language"),this.checkWithServerLanguageDetection(e,t,r,n,s,a,i);if(t={code:this.getLanguageVariant(c.language,r),name:""},!this.isSupportedLanguage(t.code))return{textLevelResult:{...this.EMPTY_ERRORS_RESPONSE,language:{code:"zz",name:"NoopLanguage"}},paragraphLevelResult:{...this.EMPTY_ERRORS_RESPONSE,sentenceRanges:[],isIncompleteResult:!1,areErrorsSuppressed:!1,language:{code:"zz",name:"NoopLanguage"}}}}const c=[];r.skipTextLevelCheck?c.push(Promise.resolve({...this.EMPTY_ERRORS_RESPONSE,language:t})):c.push(Vn.checkTextLevel(e,t,r)),c.push(Vn.checkParagraphLevel(n,t,r,e,s,a,i));const[l,u]=await Promise.all(c);return l.language&&(l.language.detectedLanguage={...t,source:"client"}),{textLevelResult:l,paragraphLevelResult:u}}static isSupportedLanguage(e){return I.get(A.SUPPORTED_LANGUAGES).some(t=>t===e.toLowerCase())}static async checkWithServerLanguageDetection(e,t,r,n,s,a,i){const o=[r.skipTextLevelCheck?Vn.detectLanguage(e,t,r):Vn.checkTextLevel(e,t,r),Vn.checkParagraphLevel(n,t,r,e,s,a,i)],[c,l]=await Promise.all(o);return c.language?.detectedLanguage&&(c.language.detectedLanguage.source="server"),{textLevelResult:c,paragraphLevelResult:l}}}Vn.SPELLING_RULES_ID=["SPELLER_RULE","MORFOLOGIK_RULE","HUNSPELL","SPELLING_RULE","ORTHOGRAPHY"],Vn.EMPTY_ERRORS_RESPONSE={errors:[],pickyErrors:[],premiumErrors:[],premiumPickyErrors:[]},Vn.STYLE_ISSUE_TYPES=["style","locale-violation","register"],Vn.EMAIL_SIGNATURE_SEPARATOR_REGEXP=/^[‐|\-]{2,}|[‐|\-]{2,}$/,Vn.ONLY_NUMBERS_REGEXP=/^[0-9]+$/,Vn.COLON_WHITESPACE_REGEXP=/^[;:]\s/,Vn.ONE_LETTER_AT_END_REGEXP=/(\s|^|\()[a-z]\.?\s?$/i,Vn.NUMBER_WITH_DOT_AT_END_REGEXP=/\d\.?\s?$/,Vn.NUMBER_WITH_PARENTHESIS_AT_END_REGEXP=/\d\.?\)\s$/,Vn.PUNCTUATION_AT_END=/(\.|\!)$/,Vn.BULLET_POINT_REGEXP=/(\u25b6\ufe0e|\u25BA|\*|-|–|\u2606|\u2605|\u25cf|\u2022|\u25e6|\u27A4|\u2714)\s+$/,Vn.LOWERCASE_REGEXP=/[a-z]/,Vn.DOT_WITH_PREFIX_REGEXP=/\w\.$/,Vn.SLASH_AT_END_REGEXP=/(\/|\\)$/,Vn.AT_LEAST_TWO_LETTERS_AT_END_REGEXP=/[a-z]{2}$/i,Vn.SLASH_AT_BEGINNING_REGEXP=/^(\/|\\)/,Vn.PUNCTUATION_AT_BEGINNING_REGEXP=/^\s?[\.\!\?,:…]/,Vn.PUNCTUATION_SPACE_AT_END_REGEXP=/[\.…\?\!]\s+/,Vn.MARKDOWN_HEADLINE_REGEXP=/^#{1,6}\s/m,Vn.MARKDOWN_INLINE_FORMAT_AT_BEGINNING_REGEXP=/^[\*\~\_\^\+\%\@]/m,Vn.WIKI_MARKUP_AT_END_REGEXP=/\[\[[a-z]+$/,Vn.PIPE_AT_END_REGEXP=/\|\s+$/,Vn.MENTION_SYMBOL_AT_BEGINNING_REGEXP=/@[a-z\.\-]*$/i,Vn.HASH_SYMBOL_AT_BEGINNING_REGEXP=/#[a-z\.\-]*$/i,Vn.EMOJI_SENTENCE_START_REGEXP=/(\.|!|\?|^)\s?(\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])\s+/,Vn.ABBREVIATION_AT_END_REGEXP=/(\s|\(|^)[A-Z]\.$/,Vn.NET_AT_BEGINNING_REGEXP=/^net\b/i,Vn.SINGLE_UPPERCASE_LETTER_REGEXP=/^[A-Z]$/,Vn.NON_ALPHANUMERIC_AT_BEGINNING_REGEXP=/^[^a-z0-9äöüßáàâéèêíìîóòôúùû\.\?\!,\:\;¿¡]+/i,Vn.NON_ALPHANUMERIC_AT_END_REGEXP=/[^a-z0-9äöüßáàâéèêíìîóòôúùû\.\?\!,\:\;¿¡]+$/i,Vn.HTML_ENTITIES=["amp","nbsp","gt","lt","bull","euro","copy","laquo","raquo","hellip","middot"],Vn.HTML_ENTITIES_WITH_AND=Vn.HTML_ENTITIES.map(e=>`&${e}`),Vn.WAVY_DASH_REGEXP=/^\u3030+$/,Vn.INVISIBLE_PHRASE_REGEXP=/^[\u2063\uFEFF]+$/,Vn.INVISIBLE_CHARS_REGEXP=/[\u2063\uFEFF]/g,Vn.ZWNJ_REGEXP=/\u200B|\u200C/g,Vn.ZWS="\ufeff",Vn.PREVENT_MID_SENTENCE_CAPITALIZATION=/[\wáàâóòìíéèùúâôîêûäöüß,\)][\u0020\u00A0\uFEFF]*\n\n\n?[\u0020\u00A0\uFEFF"„»«“‘]*$/,Vn.PREVENT_MID_SENTENCE_PUNCTUATION=/^[\u0020\u00A0\uFEFF]*\n\n\n?[a-záàâóòìíéèùúâôîêûäöüß,\)]/,Vn.COMMON_TLDS=["com","co","org","net","de","info","biz","es","fr","be","in","gov","nl","ca","com.br","br","at","us","au","ru","pl","ly","it","cat","edu","jp","ko","cn","se","no","mil","ch","dk","com.mx","mx","eu","co.uk","uk","ir","cz","ua","kr","gr","tw","nz","co.nz","za","ro","vn","io","tr","me","fi","tv","xyz","pt","ie","app"],Vn.COMMON_TLD_WITH_DOT_REGEXPS=Vn.COMMON_TLDS.map(e=>new RegExp(`^\\.${e.replace(".","\\.")}\\b`,"i")),Vn.COMMON_FILE_TYPES=["jpeg","jpg","gif","png","bmp","indd","stl","svg","ai","sketch","ico","ics","env","amf","ps","psd","tiff","tif","mp3","wav","midi","mid","aif","mpa","ogg","wma","wpl","cda","7z","arj","deb","pkg","plist","rar","rpm","tar.gz","tar","zip","bin","dmg","iso","toast","vcd","csv","dat","db","log","mdb","sav","sql","xml","apk","bat","bin","cgi","com","exe","gadget","jar","py","js","jsx","json","wsf","ts","tsx","fnt","fon","otf","ttf","woff","woff2","rb","java","php","html","asp","aspx","cer","cfm","cgi","pl","css","scss","htm","jsp","part","rss","xhtml","key","odp","pps","ppt","pptx","class","cpp","cs","h","sh","swift","vb","ods","odt","xlr","xls","xlsx","xlt","xltx","bak","cab","cfg","cpl","cur","dll","dmp","msi","ini","tmp","3g2","3gp","avi","flv","h264","m4v","mkv","mov","mp4","mpg","mpeg","rm","swf","vob","wmv","doc","docx","dot","dotx","pdf","rtf","srx","text","tex","wks","wps","wpd","txt","yaml","yml","csl","md","adm"],Vn.COMMON_FILE_TYPE_WITH_DOT_REGEXPS=Vn.COMMON_FILE_TYPES.map(e=>new RegExp(`^[\\wáàâóòìíéèùúâôîêûäöüß\\-\\.\\(\\)]*?\\.${e}\\b`,"i")),Vn.FILE_TYPE_AT_BEGINNING_REGEXP=new RegExp(`(${Vn.COMMON_FILE_TYPES.join("|")})\b`,"i"),Vn.HIGH_LEVEL_GOALS=[{id:"professional",tags:["clarity","confident","formal","general","positive","professional"]},{id:"scientific",tags:["academic","clarity","formal","general","objective","povrem","scientific"]},{id:"persuasive",tags:["clarity","confident","general","persuasive","positive"]},{id:"personal",tags:["clarity","general","informal","positive","povadd"]},{id:"creative",tags:["clarity","general"]}],Vn._textLevelAbortControllers=new Map,Vn._paragraphLevelAbortControllers=new Map,Vn._languageDetectionAbortControllers=new Map,Vn._recommendationAbortControllers=new Map,Vn._useFallbackServerForTextLevelRequests=!1,Vn._useFallbackServerForParagraphLevelRequests=!1,Vn._useFallbackServerForLanguageDetection=!1,Vn._mainServerUnavailabilityTimeStamp=0,Vn._checkForException=e=>e.ok?e:e.text().catch(()=>"").then(t=>{const r=t.toLowerCase();if(r.includes("too many error"))throw{reason:"TooManyErrors",status:e.status,response:t};if(413===e.status||r.includes("text exceeds the limit"))throw{reason:"TextTooLong",status:e.status,response:t};if(t.toLowerCase().includes("checking took longer than"))throw{reason:"TimeoutError",status:e.status,url:e.url?e.url.replace(/\?.*/,"?..."):"unknown",response:t};if(429===e.status)throw{reason:"TooManyRequests",status:e.status,response:t};if(403===e.status){if(r.includes("client request size limit")||r.includes("client request limit")||r.includes("ip request limit")||r.includes("ip request size limit"))throw{reason:"TooManyRequests",status:e.status,response:t};if(r.includes("authexception"))throw{reason:"InvalidCredentials",status:e.status,response:t};throw{reason:"AccessDenied",status:e.status,response:t}}if(r.includes("checking took longer than"))throw{reason:"TimeoutError",status:e.status,url:e.url?e.url.replace(/\?.*/,"?..."):"unknown",response:t};throw{reason:"UnknownError",status:e.status,response:t}});
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Xn{constructor(){this._eventHandlers=new Map}subscribe(e,t){this._eventHandlers.has(e)||this._eventHandlers.set(e,[]),this._eventHandlers.get(e).push(t)}unsubscribe(e,t){const r=this._eventHandlers.get(e)?.indexOf(t)??-1;r>-1&&(this._eventHandlers.get(e).splice(r,1),this._eventHandlers.get(e).length||this._eventHandlers.delete(e))}fire(e,t){const r=this._eventHandlers.get(e);r&&r.forEach(e=>{try{e(t)}catch(e){console.error(e)}})}destroy(){this._eventHandlers.clear()}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class $n{static get SUPPORTED_LANGUAGES(){return this._supportedLanguages||(this._supportedLanguages=I.get(A.SUPPORTED_LANGUAGES).map(e=>({code:e,name:vr.getLanguageNameForCode(e)})),this._supportedLanguages.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),this._isSubscribed||(vr.addEventListener(wr.eventNames.localeChanged,()=>this._supportedLanguages=null),this._isSubscribed=!0)),this._supportedLanguages}static isLanguageVariant(e){return e.code.includes("-")}static getPrimaryLanguageCode(e){return e.split("-")[0]}static formatLanguageCode(e){const t=e.split("-");return 1===t.length?t[0]:2===t.length?t[0]+"-"+t[1].toUpperCase():t[0]+"-"+t[1].toUpperCase()+"-"+t[2]}static getUserLanguageCode(){for(const e of navigator.languages){if(e.includes("-")&&e.startsWith(navigator.language))return e}return navigator.language}static getUserLanguageCodes(){const e=Array.from(navigator.languages,e=>this.getPrimaryLanguageCode(e).toLowerCase());try{e.push(this.getPrimaryLanguageCode(Cr.getUILanguageCode()).toLowerCase())}catch(e){}return rr(e)}static getPreferredLanguageVariant(e){const t={"en-in":"en-us","en-ie":"en-gb"},r=navigator.languages||[];for(let n of r){n=n.toLowerCase(),n=t[n]||n;for(const t of e){const e=t.toLowerCase();if(n.length>2&&n===e)return t}}return null}static getLanguagesForGeoIPCountry(){return new Promise(function(e,t){let r=!1;const n=self.setTimeout(()=>{r=!0,t(new Error("geoip timeout"))},15e3);fetch("https://languagetool.org/webextension/init",{method:"GET",mode:"cors",referrerPolicy:"no-referrer",headers:{Accept:"application/json"}}).then(e=>e.json()).then(t=>{if(!r){const r=(t.geoIpCountry||"").toUpperCase();e({geoIpLanguages:t.geoIpLanguages||[],geoIpCountry:r}),clearTimeout(n)}}).catch(e=>{console.error(e),r||(t(e),clearTimeout(n))})})}static getSynonymsRequestLanguage(e){let t=this.getPrimaryLanguageCode(e);return"de-ch"===e.toLowerCase()?t="de-CH":"pt-br"===e.toLowerCase()&&(t="pt-BR"),Xe.includes(t)?t:null}}$n._supportedLanguages=null,$n._isSubscribed=!1,$n.ALL_LANGUAGES=[{code:"af",name:"Afrikaans"},{code:"ak",name:"Akan"},{code:"am",name:"አማርኛ"},{code:"an",name:"aragonés"},{code:"ar",name:"عربي"},{code:"as",name:"অসমীয়া"},{code:"ast",name:"Asturianu"},{code:"be",name:"Беларуская"},{code:"bg",name:"Български"},{code:"bm",name:"Bamanankan"},{code:"bn",name:"বাংলা"},{code:"br",name:"Brezhoneg"},{code:"bs",name:"босански"},{code:"ca",name:"Català"},{code:"cs",name:"čeština"},{code:"cy",name:"Cymraeg"},{code:"da",name:"Dansk"},{code:"de",name:"Deutsch"},{code:"el",name:"Ελληνικά"},{code:"en",name:"English"},{code:"eo",name:"Esperanto"},{code:"es",name:"Español"},{code:"et",name:"Eesti keel"},{code:"eu",name:"Euskara"},{code:"fa",name:"فارسی"},{code:"fi",name:"suomi"},{code:"fj",name:"Vosa vaka-Viti"},{code:"fr",name:"Français"},{code:"ga",name:"Gaeilge"},{code:"gd",name:"Gàidhlig"},{code:"gl",name:"Galego"},{code:"gn",name:"Avañe'ẽ"},{code:"gu",name:"ગુજરાતી"},{code:"ha",name:"هَرْشَن هَوْسَ‎"},{code:"he",name:"עברית"},{code:"hi",name:"हिन्दी"},{code:"hr",name:"hrvatski"},{code:"hu",name:"magyar"},{code:"hy",name:"Հայերեն"},{code:"ia",name:"Interlingua"},{code:"id",name:"Bahasa Indonesia"},{code:"ig",name:"Ásụ̀sụ̀ Ìgbò"},{code:"is",name:"íslenska"},{code:"it",name:"Italiano"},{code:"ja",name:"日本語"},{code:"kk",name:"Қазақ"},{code:"km",name:"ខ្មែរ"},{code:"kn",name:"ಕನ್ನಡ"},{code:"ko",name:"한국어"},{code:"ku",name:"Kurdî"},{code:"ks",name:"كشمیری"},{code:"la",name:"Latina"},{code:"lg",name:"Luganda"},{code:"lo",name:"ພາສາລາວ"},{code:"lt",name:"Lietuvių"},{code:"lv",name:"Latviešu"},{code:"mg",name:"malagasy"},{code:"mi",name:"Māori"},{code:"ml",name:"മലയാളം"},{code:"mk",name:"Македонски"},{code:"mn",name:"Монгол"},{code:"mr",name:"मराठी"},{code:"ms",name:"Melayu"},{code:"my",name:"မြန်မာဘာသာ"},{code:"nb",name:"Norsk bokmål"},{code:"ne",name:"नेपाली"},{code:"nn",name:"Norsk nynorsk"},{code:"no",name:"Norsk"},{code:"nl",name:"Nederlands"},{code:"nr",name:"isiNdebele"},{code:"oc",name:"Occitano"},{code:"or",name:"ଓଡ଼ିଆ"},{code:"pa",name:"ਪੰਜਾਬੀ"},{code:"pl",name:"Polski"},{code:"ps",name:"پښتو"},{code:"pt",name:"Português"},{code:"rm",name:"rumantsch"},{code:"ro",name:"românesc"},{code:"ru",name:"Русский"},{code:"rw",name:"Ikinyarwanda"},{code:"sa",name:"संस्कृत"},{code:"si",name:"සිංහල"},{code:"sk",name:"slovenčina"},{code:"sl",name:"Slovenščina"},{code:"so",name:"Soomaali"},{code:"sr",name:"Српски"},{code:"ss",name:"siSwati"},{code:"st",name:"Sesotho"},{code:"sv",name:"Svenska"},{code:"ta",name:"தமிழ்"},{code:"te",name:"తెలుగు"},{code:"th",name:"ภาษาไทย"},{code:"tl",name:"Tagalog"},{code:"fil",name:"Filipino"},{code:"tr",name:"Türkçe"},{code:"ts",name:"Xitsonga"},{code:"tt",name:"Tatarça"},{code:"uk",name:"Українська"},{code:"ur",name:"اُردو"},{code:"uz",name:"Oʻzbek tili"},{code:"ve",name:"Tshivenḓa"},{code:"vi",name:"Tiếng Việt"},{code:"yo",name:"عِدعِ يوْرُبا"},{code:"zh",name:"中文"},{code:"zu",name:"isiZulu"}],$n.POPULAR_LANGUAGES=["de","en","es","fr","nl","pl","pt","ru","uk","zh","it","hi"];r(6326);const qn=["de","en","es","fr","nl","pt-br"],Yn=(String.fromCharCode(32),String.fromCharCode(160),"\b\t          ‏　");new RegExp("^["+Yn+"]$"),new RegExp("["+Yn+"]","g");Intl.Segmenter&&new Intl.Segmenter(void 0,{granularity:"grapheme"});Error;const zn="​‌‍­⁠‪‫‬‭";new RegExp("^["+zn+"]$"),new RegExp("["+zn+"]"),new RegExp("["+zn+"]","g");const Kn=e=>e.replace("_","-").toLocaleLowerCase(),Zn=e=>qn.includes(String(e)),Qn=e=>{const t=String(e),r=Kn(t),[n]=(e=>Kn(e).split("-")[0])(t);switch(!0){case Zn(r):return r;case Zn(n):return n;default:return"en"}};const Jn=class{static init(e){this._instance=e}static getUiLanguage(){const e=I.get(A.LOLLIPOP_CONFIG).TOOLBOX_AVAILABLE_UI_LANGUAGES,t=Qn(Cr.getUILanguageCode());return e.includes(t)?t:"en"}static getToolboxEnvironment(e){return this._instance.getToolboxEnvironment(e)}static getToolboxConfig(e){return this._instance.getToolboxConfig(e)}static preApplyToolboxResult(e){return this._instance.preApplyToolboxResult(e)}static canSeeLollipop(e){return this._instance.canSeeLollipop(e)}static isUsedForRephrasing(){return this._instance.isUsedForRephrasing()}static isPremiumParaphraseMode(e,t){return this._instance.isPremiumParaphraseMode(e,t)}static getParaphraserSkill(e){return this._instance.getParaphraserSkill(e)}static isParaphraserSentenceSkill(e){return this._instance.isParaphraserSentenceSkill(e)}};class es{static init(){this._storageController=this._storageController||ns.create()}static isEligible(){if(!I.get(A.SUPPORTS_TRIAL))return!1;if("extension"!==Cr.getType())return!1;if(navigator.webdriver)return!1;if(!E.isChromium()&&!E.isFirefox())return!1;if((this._storageController.hasCustomLogin()||this._storageController.hasCustomServer())&&!this._storageController.isInternalTester())return!1;const{hasPaidSubscription:e,hasPaidSubscriptionEnded:t}=this._storageController.getUIState();if(e||t)return!1;if(!this._storageController.getTrialSettings().isTrialSupportedInCountry)return!1;if(!this._storageController.getPrivacySettings().allowRemoteCheck)return!1;const{username:r}=this._storageController.getSettings();return!r||!vt.test(r)}static isRunning(){if(!this.isEligible())return!1;const{trialStartedAt:e}=this._storageController.getTrialSettings();return!!e&&e+bt>=Date.now()}static getStartDate(){const{trialStartedAt:e}=this._storageController.getTrialSettings();return e?new Date(e):null}static getEndDate(){const{trialStartedAt:e}=this._storageController.getTrialSettings();return e?new Date(e+bt):null}static hasEnded(){const{trialStartedAt:e}=this._storageController.getTrialSettings();return!!e&&e+bt<Date.now()}static isFunctionalityLocked(){return this.isEligible()&&this.hasEnded()}static hasUpgraded(){const{trialStartedAt:e}=this._storageController.getTrialSettings(),{hasPaidSubscription:t}=this._storageController.getUIState();return Boolean(e&&t)}static canStart(){return this.isEligible()&&!this._storageController.getTrialSettings().trialStartedAt}static getRemainingDays(){if(!this.isRunning())return null;const e=this.getEndDate();if(!e)return null;const t=new Date;return(e.getTime()-t.getTime())/1e3/60/60/24}static start(e){return this.canStart()?this._storageController.updateTrialSettings({trialUserType:e,trialStartedAt:Date.now()}):Promise.reject("Cannot start, isEligible:"+this.isEligible()+" isRunning:"+this.isRunning())}static getCoupon(){if(!this.isRunning()&&!this.isFunctionalityLocked())return null;const e=this.getEndDate();if(!e)return null;if((new Date).getTime()-e.getTime()>2592e6)return null;const t=this._storageController.getActiveCoupon();return t&&t.percent>20?t:{code:"TRIAL",percent:20}}static getToken(){return this._storageController.getTrialSettings().trialToken?.jwt||null}static getStatus(){return this.hasUpgraded()?"upgraded":this.isRunning()?"started":this.hasEnded()?"ended":this.isEligible()?"eligible":"ineligible"}static getUserType(){const{trialUserType:e}=this._storageController.getTrialSettings();return e}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
const ts=I.get(A.EXTN_PREFIX);class rs{static get DEFAULT_SETTINGS(){return null===this.DEFAULT_SETTINGS_CACHED&&(this.DEFAULT_SETTINGS_CACHED={apiServerUrl:q,autoCheck:!0,knownEmail:"",username:"",password:"",token:"",userId:null,motherTongue:"",geoIpLanguages:[],geoIpCountry:"",preferredLanguages:[],forcePreferredLanguages:!1,enVariant:$n.getPreferredLanguageVariant(["en-US","en-GB","en-AU","en-CA","en-NZ","en-ZA"])||"en-US",deVariant:$n.getPreferredLanguageVariant(["de-DE","de-AT","de-CH"])||"de-DE",ptVariant:$n.getPreferredLanguageVariant(["pt-PT","pt-BR","pt-MZ","pt-AO"])||"pt-BR",caVariant:"ca-ES",dictionary:[],hasSynonymsEnabled:!1,hasPickyModeEnabledGlobally:!1,openCardHotkey:"",isDictionarySynced:!1,ignoredRules:[],disabledDomains:[],disabledEditorGroups:[],ignoreCheckOnDomains:[],disableRecommendationOnDomains:[],autoCheckOnDomains:[],remainingRephrasingsAmount:null,remainingRephrasingsDate:null,hasRephrasingEnabled:!0,hasContextMenuOptionEnabled:!0,hasLollipopEnabled:!1,lastMigration:null,translateLanguages:[]}),this.DEFAULT_SETTINGS_CACHED}static _combineObjects(e,t){const r=sr(e);for(const e in r)t.hasOwnProperty(e)&&(r[e]=t[e]);return r}static _dec2hex(e){return("0"+e.toString(16)).substr(-2)}static _generateUniqueId(){const e=new Uint8Array(8);return crypto.getRandomValues(e),Array.from(e,rs._dec2hex).join("")}static _isListContainsDomain(e,t){return ur(e,t)}static getDefaultSettings(){return sr(rs.DEFAULT_SETTINGS)}static getDefaultPrivacySettings(){return nr(rs.DEFAULT_PRIVACY_SETTINGS)}constructor(){this._eventBus=new Xn,this._onReadyCallbacks=[]}addEventListener(e,t){this._eventBus.subscribe(e,t)}removeEventListener(e,t){this._eventBus.unsubscribe(e,t)}disableDomain(e){const t=lr(e),r=this.getSettings(),n="object"==typeof r.disabledDomains?r.disabledDomains:[];return n.push(t),this.updateSettings({disabledDomains:n})}enableDomain(e){const t=lr(e),r=this.getSettings();let n="object"==typeof r.disabledDomains?r.disabledDomains:[];return n=n.filter(e=>{const r=lr(e);return r!==t&&!t.endsWith("."+r)}),this.updateSettings({disabledDomains:n})}addToDomainSettings(e,t){const r=lr(e),n=this.getSettings()[t]||[];return n.push(r),this.updateSettings({[t]:rr(n)})}removeFromDomainSettings(e,t){const r=lr(e);let n=this.getSettings()[t]||[];return n=n.filter(e=>{const t=lr(e);return t!==r&&!r.endsWith("."+t)}),this.updateSettings({[t]:n})}isInternalTester(){const e=this.getSettings();return this.getUIState().showRuleId||De.test(e.username)||"quillbotautomation+1@gmail.com"===e.username}disableEditorGroup(e,t){const r=lr(e),n=this.getSettings(),s="object"==typeof n.disabledEditorGroups?n.disabledEditorGroups:[];return s.push({domain:r,editorGroupId:t}),this.updateSettings({disabledEditorGroups:s})}enableEditorGroup(e,t){const r=lr(e),n=this.getSettings(),s="object"==typeof n.disabledEditorGroups?n.disabledEditorGroups:[],a=s.filter(e=>!(e.domain===r&&e.editorGroupId===t));return a.length!==s.length?this.updateSettings({disabledEditorGroups:a}):Promise.resolve()}enableDomainAndEditorGroup(e,t){return this.getCheckSettings(e,t).isEditorGroupDisabled&&this.enableEditorGroup(e,t),this.enableDomain(e)}grantUnlimitedRephrasings(){return this.updateSettings({remainingRephrasingsAmount:null,remainingRephrasingsDate:null})}restrictRephrasings(){const{remainingRephrasingsAmount:e,remainingRephrasingsDate:t}=this.getSettings();return this.updateSettings({remainingRephrasingsAmount:e??rt,remainingRephrasingsDate:t||(new Date).toISOString()})}enablePaidSubscription(){return this.updateUIState({hasPaidSubscription:!0,hasPaidSubscriptionEnded:!1})}disablePaidSubscription(){const{hasPaidSubscription:e,hasPaidSubscriptionEnded:t}=this.getUIState();return this.updateUIState({hasPaidSubscription:!1,hasPaidSubscriptionEnded:t||!0===e})}isPremium(){return this.getUIState().hasPaidSubscription||es.isRunning()}getIgnoredRuleIds(){return this.getManagedSettings().disableIgnoredRules?[]:this.getSettings().ignoredRules.map(e=>e.id)}hasIgnoredRule(e){return this.getIgnoredRuleIds().includes(e)}addIgnoredRule(e){const{ignoredRules:t}=this.getSettings();this.hasIgnoredRule(e.id)||this.updateSettings({ignoredRules:[...t,e]})}async removeIgnoredRule(e){if(this.hasIgnoredRule(e)){const t=this.getSettings().ignoredRules.filter(t=>t.id!==e);await this.updateSettings({ignoredRules:t})}}hasRephrasingEnabled(){return!this.hasCustomServer()&&(!es.isFunctionalityLocked()&&(!!Jn.canSeeLollipop(this)||this.getSettings().hasRephrasingEnabled))}destroy(){this._eventBus.destroy(),this._onReadyCallbacks=[]}}rs.eventNames={settingsChanged:`${ts}-storageController.settingsChanged`,userCredentialsChanged:`${ts}-storageController.userCredentialsChanged`,configurationChanged:`${ts}-storageController.configurationChanged`,privacySettingsChanged:`${ts}-storageController.privacySettingsChanged`,uiStateChanged:`${ts}-storageController.uiStateChanged`},rs.DEFAULT_SETTINGS_CACHED=null,rs.DEFAULT_MANAGED_SETTINGS={apiServerUrl:"",loginUrl:"",disablePrivacyConfirmation:!1,disablePersonalDictionary:!1,disableIgnoredRules:!1,disableOpenInEditor:!1,allowedURLs:[]},rs.DEFAULT_REMOTE_CONFIGURATION={unsupportedDomains:[]},rs.DEFAULT_PRIVACY_SETTINGS={allowRemoteCheck:!1,hasStatisticsCollectionEnabled:!0,hasMLDataCollectionEnabled:!1,acceptedTermsOfServiceVersion:null,lastTermsOfServiceModalShown:null,hasOptedIntoThirdPartyAiGrammarChecking:!0,hasOptedIntoThirdPartyAiParaphrasing:!0},rs.DEFAULT_STATISTICS={sessionCount:0,appliedSuggestions:0,appliedSynonyms:0,hiddenErrors:[],firstVisit:null,lastActivity:null,ratingValue:null,premiumClicks:0,lastPing:null,hasInstalledQBExtension:!1},rs.DEFAULT_UI_STATE={hasSeenPrivacyConfirmationDialog:!1,hasPaidSubscription:!1,hasPaidSubscriptionEnded:!1,hasRated:!1,hasUsedValidator:!1,hasSeenOnboarding:!1,hasSeenNewGoogleDocsTeaser:!1,hasSeenNewGoogleSlidesTeaser:!1,hasSeenGoogleDocsMenuBarHint:!1,lastChangelogNov2024Seen:null,changelogNov2024CountdownEnd:null,changelogNov2024Coupon:null,showRuleId:!1,dialogPosition:"default",countMode:"characters",hasSeenTurnOnMessagePopup:!1,isDarkModeEnabled:!1,skipFixAllConfirmation:!1,skipFixAllOverLimitConfirmation:!1,hasClickedLollipop:!1},rs.DEFAULT_TEST_FLAGS={testGroups:{},experiments:{}},rs.DEFAULT_TRIAL_SETTINGS={isTrialSupportedInCountry:!1,trialToken:null,trialStartedAt:null,lastTrialTokenAttempt:null,trialUserType:null,hasSeenTrialPage:!1},rs.DEFAULT_COPY_PASTE_INFO={copiedText:"",copiedAt:null,copiedFrom:null};class ns{static init(e){this._instanceCtor=e}static create(){return this._instanceCtor()}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class ss extends rs{static _getStringSize(...e){let t=0;for(const r of e)for(let e=0;e<r.length;e++){const n=r.charCodeAt(e);t+=n<128?1:n<2048?2:n<65536?3:n<1<<21?4:n<1<<26?5:n<1<<31?6:Number.NaN}return t}static _getStorage(){const e=yr();return this._shouldUseSyncedStorage()?e.storage.sync:e.storage.local}static _getLocalStorage(){return yr().storage.local}static _shouldUseSyncedStorage(){return yr().storage.sync&&!E.isFirefox()}static _getManagedStorage(){return yr().storage.managed}constructor(){super(),this._onStoredDataChanged=(e,t)=>{const r=["username","token"].filter(t=>e.hasOwnProperty(t)&&e[t].oldValue!==e[t].newValue),n=[],s=[];for(const e of ss.SETTINGS_CHUNKED_PROPERTIES)n.push(!1),s.push(new RegExp(`^${e}(_\\d+)?$`));let a=!1,i=!1,o=!1,c=!1;for(const r in e)if("managed"!==t){"local"===t&&(this._copyPasteInfo&&rs.DEFAULT_COPY_PASTE_INFO.hasOwnProperty(r)&&(this._copyPasteInfo[r]=e[r].newValue),this._trialSettings&&rs.DEFAULT_TRIAL_SETTINGS.hasOwnProperty(r)&&(this._trialSettings[r]=e[r].newValue));for(let e=0;e<ss.SETTINGS_CHUNKED_PROPERTIES.length;e++)if(s[e].test(r)){n[e]=!0;break}if(this._settings&&rs.DEFAULT_SETTINGS.hasOwnProperty(r)&&!ss.SETTINGS_CHUNKED_PROPERTIES.includes(r)){const t=!("oldValue"in e[r])&&rs.DEFAULT_SETTINGS[r]===e[r].newValue,n=e[r].oldValue!==e[r].newValue;this._settings[r]=e[r].newValue,a=!1===t&&n}this._configuration&&rs.DEFAULT_REMOTE_CONFIGURATION.hasOwnProperty(r)&&(this._configuration[r]=e[r].newValue,i=!0),this._privacySettings&&rs.DEFAULT_PRIVACY_SETTINGS.hasOwnProperty(r)&&(this._privacySettings[r]=e[r].newValue,o=!0),this._statistics&&rs.DEFAULT_STATISTICS.hasOwnProperty(r)&&(this._statistics[r]=e[r].newValue),this._uiState&&rs.DEFAULT_UI_STATE.hasOwnProperty(r)&&(this._uiState[r]=e[r].newValue,c=!0),this._testFlags&&rs.DEFAULT_TEST_FLAGS.hasOwnProperty(r)&&(this._testFlags[r]=e[r].newValue),"uniqueId"===r&&(this._uniqueId=e[r].newValue)}else this._managedSettings&&rs.DEFAULT_MANAGED_SETTINGS.hasOwnProperty(r)&&(this._managedSettings[r]=e[r].newValue);a&&(this._ensureIgnoredRuleTurnOffDate(),this._eventBus.fire(rs.eventNames.settingsChanged,e)),r.length&&this._eventBus.fire(rs.eventNames.userCredentialsChanged,r.reduce((t,r)=>({...t,[r]:e[r]}),{})),n.some(e=>e)&&this._storage.get().then(e=>{if(!this._settings)return;const t={};for(let r=0;r<ss.SETTINGS_CHUNKED_PROPERTIES.length;r++)if(n[r]){const n=ss.SETTINGS_CHUNKED_PROPERTIES[r];if(!ss._isSettingsPropertyArrayName(n))continue;const s=this._joinChunks(e,n);t[n]={oldValue:this._settings[n],newValue:s},this._settings[n]=s}this._ensureIgnoredRuleTurnOffDate(),this._eventBus.fire(rs.eventNames.settingsChanged,t)}),i&&this._eventBus.fire(rs.eventNames.configurationChanged,e),o&&this._eventBus.fire(rs.eventNames.privacySettingsChanged,e),c&&this._eventBus.fire(rs.eventNames.uiStateChanged,e)},this._storage=ss._getStorage(),this._managedStorage=ss._getManagedStorage(),this._localStorage=ss._getLocalStorage(),this._isInitialized=!1,this._loadData(),yr().storage.onChanged.addListener(this._onStoredDataChanged)}_splitInChunks(e,t,r=this._storage.QUOTA_BYTES_PER_ITEM){const n=e[t];if(!n)return;let s=0,a=[],i=ss._getStringSize(t,"[]");for(;n.length;){const o=n.shift(),c=JSON.stringify(o),l=ss._getStringSize(`,${c}`);if(i+l<=r)a.push(o),i+=l;else{e[0===s?t:`${t}_${s}`]=a,s++,a=[o],i=ss._getStringSize(`${t}_${s}`,`[${c}]`)}if(0===n.length){e[0===s?t:`${t}_${s}`]=a}}e[`${t}_${s+1}`]=[]}_joinChunks(e,t,r=this._storage.MAX_ITEMS){let n=e[t]||[];for(let s=1;s<r;s++){const r=e[`${t}_${s}`];if(void 0===r||0===r.length)break;n=n.concat(r)}return n}_loadData(){const e=this._storage.get().then(e=>{const t=rs._combineObjects(rs.DEFAULT_SETTINGS,e);for(const r of ss.SETTINGS_CHUNKED_PROPERTIES)t[r]=this._joinChunks(e,r);for(const e of t.ignoredRules){if(void 0===e.description){const t=rs.DEFAULT_SETTINGS.ignoredRules.find(t=>t.id===e.id&&t.language===e.language);e.description=t?t.description:""}if(void 0===e.turnOffDate){const t=rs.DEFAULT_SETTINGS.ignoredRules.some(t=>t.id===e.id&&t.language===e.language);e.turnOffDate=t?null:new Date(2019,9,1)}else null!==e.turnOffDate&&(e.turnOffDate=new Date(e.turnOffDate))}t.disabledDomains=t.disabledDomains.map(e=>cr(e,"")).filter(e=>e),t.ignoreCheckOnDomains=t.ignoreCheckOnDomains.map(e=>cr(e,"")).filter(e=>e),t.autoCheckOnDomains=t.autoCheckOnDomains.map(e=>cr(e,"")).filter(e=>e),this._settings=t,this._configuration=rs._combineObjects(rs.DEFAULT_REMOTE_CONFIGURATION,e),this._privacySettings=rs._combineObjects(rs.DEFAULT_PRIVACY_SETTINGS,e),this._statistics=rs._combineObjects(rs.DEFAULT_STATISTICS,e),this._uiState=rs._combineObjects(rs.DEFAULT_UI_STATE,e),this._testFlags=rs._combineObjects(rs.DEFAULT_TEST_FLAGS,e),e.uniqueId?this._uniqueId=e.uniqueId:(this._uniqueId=rs._generateUniqueId(),this._storage.set({uniqueId:this._uniqueId})),this._statistics.firstVisit||this.updateStatistics({firstVisit:Math.round(Date.now()/1e3)})}),t=this._managedStorage.get().then(e=>{this._managedSettings=rs._combineObjects(rs.DEFAULT_MANAGED_SETTINGS,e)}).catch(()=>{this._managedSettings=rs._combineObjects(rs.DEFAULT_MANAGED_SETTINGS,{})}),r=this._localStorage.get().then(e=>{this._trialSettings=rs._combineObjects(rs.DEFAULT_TRIAL_SETTINGS,e),this._copyPasteInfo=rs._combineObjects(rs.DEFAULT_COPY_PASTE_INFO,e)});Promise.all([e,t,r]).then(()=>{this._isInitialized=!0,this._onReadyCallbacks.forEach(e=>e(this)),this._onReadyCallbacks=[]})}_ensureIgnoredRuleTurnOffDate(){if(this._settings)for(const e of this._settings.ignoredRules)e.turnOffDate&&"string"==typeof e.turnOffDate&&(e.turnOffDate=new Date(e.turnOffDate))}isReady(){return this._isInitialized}onReady(e){this._isInitialized?e(this):this._onReadyCallbacks.push(e)}getUniqueId(){return this._uniqueId}getSettings(){return sr(this._settings)}updateSettings(e){for(const t in e)if(!rs.DEFAULT_SETTINGS.hasOwnProperty(t))throw new Error(`Unknown setting ${t}`);if(Object.assign(this._settings||{},sr(e)),void 0!==e.ignoredRules)for(const t of e.ignoredRules)t.turnOffDate&&"string"!=typeof t.turnOffDate&&(t.turnOffDate=t.turnOffDate.toISOString());if(!E.isFirefox()&&!E.isThunderbird()&&!E.isSafari()){e=sr(e);for(let t=0;t<ss.SETTINGS_CHUNKED_PROPERTIES.length;t++){const r=ss.SETTINGS_CHUNKED_PROPERTIES[t];void 0!==e[r]&&ss._isSettingsPropertyArrayName(r)&&this._splitInChunks(e,r)}}return this._storage.set(e)}getCheckSettings(e,t){if(!this._settings)return{isDomainDisabled:!1,isEditorGroupDisabled:!1,isAutoCheckEnabled:!0,isRecommendationsDisabled:!0};if(e===yr().runtime.id)return{isDomainDisabled:!1,isEditorGroupDisabled:!1,isAutoCheckEnabled:!0,isRecommendationsDisabled:!0};const r=(this._settings.disabledEditorGroups||[]).some(r=>lr(r.domain)===lr(e)&&r.editorGroupId===t),n=rs._isListContainsDomain(this._settings.disabledDomains,e),s=(a=this._managedSettings?.allowedURLs||[]).length>0&&a.every(e=>nn(e));var a;const i=!0;if(this._settings.autoCheck&&!s){return{isDomainDisabled:n,isEditorGroupDisabled:r,isAutoCheckEnabled:!rs._isListContainsDomain(this._settings.ignoreCheckOnDomains,e),isRecommendationsDisabled:i}}return{isDomainDisabled:n,isEditorGroupDisabled:r,isAutoCheckEnabled:rs._isListContainsDomain([...this._settings.autoCheckOnDomains,...an(this._managedSettings?.allowedURLs||[])],e),isRecommendationsDisabled:i}}hasLanguageToolAccount(){return Boolean(this._settings&&this._settings.username&&!this.hasCustomServer())}hasCustomServer(){return this._managedSettings&&this._managedSettings.apiServerUrl?this._managedSettings.apiServerUrl!==rs.DEFAULT_SETTINGS.apiServerUrl:Boolean(this._settings&&this._settings.apiServerUrl&&this._settings.apiServerUrl.trim()&&this._settings.apiServerUrl!==q&&this._settings.apiServerUrl!==z)}getCustomServerUrl(){if(this.hasCustomServer())return this._managedSettings.apiServerUrl||this._settings.apiServerUrl}hasCustomLogin(){return!!this._managedSettings?.loginUrl}getManagedSettings(){return nr(this._managedSettings)}getConfiguration(){return nr(this._configuration)}updateRemoteConfiguration(e){for(const t in e)if(!rs.DEFAULT_REMOTE_CONFIGURATION.hasOwnProperty(t))throw new Error(`Unknown configuration ${t}`);return this._configuration&&this._isInitialized&&!this._hasAnythingChanged(this._configuration,e)?Promise.resolve():(Object.assign(this._configuration||{},nr(e)),this._storage.set(e))}isDomainSupported(e){return!this._configuration||!this._configuration.unsupportedDomains.includes("*")&&!rs._isListContainsDomain(this._configuration.unsupportedDomains,e)}isDomainExcludedByGroupPolicy(e){const t=sn(this._managedSettings?.allowedURLs||[]);return!!t.length&&!1===ur(t,e)}getPrivacySettings(){return nr(this._privacySettings)}updatePrivacySettings(e){for(const t in e)if(!rs.DEFAULT_PRIVACY_SETTINGS.hasOwnProperty(t))throw new Error(`Unknown privacy setting ${t}`);return this._privacySettings&&this._isInitialized&&!this._hasAnythingChanged(this._privacySettings,e)?Promise.resolve():(Object.assign(this._privacySettings||{},e),this._storage.set(e))}getStatistics(){return sr(this._statistics)}updateStatistics(e){for(const t in e)if(!rs.DEFAULT_STATISTICS.hasOwnProperty(t))throw new Error(`Unknown privacy setting ${t}`);return this._statistics&&this._isInitialized&&!this._hasAnythingChanged(this._statistics,e)?Promise.resolve():(Object.assign(this._statistics||{},e),this._storage.set(e))}getUIState(){return sr(this._uiState)}updateUIState(e){for(const t in e)if(!rs.DEFAULT_UI_STATE.hasOwnProperty(t))throw new Error(`Unknown UI state ${t}`);return this._uiState&&this._isInitialized&&!this._hasAnythingChanged(this._uiState,e)?Promise.resolve():(Object.assign(this._uiState||{},e),this._storage.set(e))}_hasAnythingChanged(e,t){let r=!1;for(const n in t)if(t.hasOwnProperty(n)&&(t[n]!==e[n]||"object"==typeof t[n])){r=!0;break}return r}checkForPaidSubscription(){return new Promise((e,t)=>{this.onReady(()=>{const{username:r,password:n,token:s}=this.getSettings();let a;this.hasCustomServer()&&(a=this.getCustomServerUrl()),Vn.checkForPaidSubscription(r,n,s,a).then(t=>{t?(this.enablePaidSubscription(),this.grantUnlimitedRephrasings()):(this.disablePaidSubscription(),this.restrictRephrasings()),e(t)}).catch(t)})})}getTestFlags(){return nr(this._testFlags)}updateTestFlags(e){for(const t in e)if(!rs.DEFAULT_TEST_FLAGS.hasOwnProperty(t))throw new Error(`Unknown test flag ${t}`);return Object.assign(this._testFlags||{},e),this._storage.set(e)}getActiveCoupon(){const{hasPaidSubscription:e}=this.getUIState();if(e)return null;const{geoIpCountry:t}=this.getSettings();return this._getDefaultCoupon(t)}_getDefaultCoupon(e){for(const t in $e)if($e.hasOwnProperty(t)&&$e[t].countries.includes(e))return{code:t,percent:$e[t].percent};return null}isRelevantForChangelogCoupon(){return{status:!1,reason:-1}}startChangelogCoupon(){if(!this.canStartChangelogCoupon())return;const e=Date.now();var t,r;this.updateUIState({changelogNov2024Coupon:"2024-NOV-CHANGELOG",changelogNov2024CountdownEnd:e+1656e5+(t=0,r=72e5,t=Math.ceil(t),r=Math.floor(r),Math.floor(Math.random()*(r-t+1))+t)})}isChangelogCouponRunning(){if(!this.isRelevantForChangelogCoupon().status)return!1;const{changelogNov2024CountdownEnd:e}=this.getUIState();return Boolean(e&&e>Date.now())}canStartChangelogCoupon(){if(!this.isRelevantForChangelogCoupon().status)return!1;const e=Date.now(),{changelogNov2024CountdownEnd:t}=this.getUIState();return!t||e-t>qe}getTrialSettings(){return sr(this._trialSettings)}updateTrialSettings(e){for(const t in e)if(!rs.DEFAULT_TRIAL_SETTINGS.hasOwnProperty(t))throw new Error(`Unknown trial setting ${t}`);return this._trialSettings&&this._isInitialized&&!this._hasAnythingChanged(this._trialSettings,e)?Promise.resolve():(Object.assign(this._trialSettings||{},e),this._localStorage.set(e))}getCopyPasteInfo(){return sr(this._copyPasteInfo)}updateCopyPasteInfo(e){for(const t in e)if(!rs.DEFAULT_COPY_PASTE_INFO.hasOwnProperty(t))throw new Error(`Unknown copy/paste info ${t}`);return this._copyPasteInfo&&this._isInitialized&&!this._hasAnythingChanged(this._copyPasteInfo,e)?Promise.resolve():(Object.assign(this._copyPasteInfo||{},e),this._localStorage.set(e))}destroy(){this._isInitialized=!1,super.destroy();try{yr().storage.onChanged.removeListener(this._onStoredDataChanged)}catch(e){}}}ss.SETTINGS_CHUNKED_PROPERTIES=["dictionary","ignoredRules","disabledDomains","disabledEditorGroups","ignoreCheckOnDomains","autoCheckOnDomains"],ss._isSettingsPropertyArrayName=e=>ss.SETTINGS_CHUNKED_PROPERTIES.includes(e);class as{static getOrCreateShadow(e){let t=document.querySelector("lt-container");if(t||(t=document.createElement("lt-container"),document.documentElement.appendChild(t)),!t.shadowRoot)try{t.attachShadow({mode:"open"})}catch{}let r=t.shadowRoot.querySelector("slot");return r||(r=document.createElement("slot"),t.shadowRoot.append(r)),Mr(t.shadowRoot),{root:t.shadowRoot,slot:r}}static isComposer(e){return function(e){return location.href.startsWith("about:blank?compose")&&"BODY"===e.tagName&&"on"===document.designMode}(e)}static registerComposeScripts(){const e=yr(),t=e.composeScripts;if(t){const r=[],n=[],s=e.runtime.getURL("");e.runtime.getManifest().content_scripts.forEach(e=>{e.js&&e.js.forEach(e=>{r.push({file:e.replace(s,"")})}),e.css&&e.css.forEach(e=>{n.push({file:e.replace(s,"")})})}),t.register({css:n,js:r})}}static setNativeSpellCheck(e){const t=yr().spellcheck;t&&t.setValue(e)}}as.COMPOSE_URL="about:blank?compose",as.COMPOSE_URL_REGEXP=/^about:blank\?compose/;const is=class{static init(e){this._instance=e,e.initialize()}static initialize(){this._instance.initialize()}static trackPageView(e,t){this._instance.trackPageView(e,t)}static trackDisabledRule(e,t,r,n){return this._instance.trackDisabledRule(e,t,r,n)}static trackDictionaryEvent(e,t,r){return this._instance.trackDictionaryEvent(e,t,r)}static trackEvent(e,t,r,n,s){this._instance.trackEvent(e,t,r,n,s)}static trackSampledEvent(e,t,r,n=100){Math.random()*n<1&&(n>1&&(t+=`:sampling_${n}`),this.trackEvent(e,t,r))}static trackInstall(){this._instance.trackInstall()}static trackActivity(){this._instance.trackActivity()}static trackUserActivity(){this._instance.trackUserActivity()}static trackError(e,t,r){this._instance.trackError(e,t,r)}static trackStat(e,t){this._instance.trackStat(e,t)}static trackPerformanceMetrics(e){this._instance.trackPerformanceMetrics(e)}static trackUserTextChangeMetrics(e){this._instance.trackUserTextChangeMetrics(e)}static trackHealthMetrics(e){this._instance.trackHealthMetrics(e)}static trackFixAllMetrics(e){this._instance.trackFixAllMetrics(e)}static trackUnderlineMismatchMetrics(e){this._instance.trackUnderlineMismatchMetrics(e)}static trackEmptyTextDiffMetrics(e){this._instance.trackEmptyTextDiffMetrics(e)}};
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class os{static init(){this._isInitialized||(this._storageController=ns.create(),this._startSync(),this._isInitialized=!0)}static _startSync(){this._storageController.onReady(()=>{if(!this._isSyncCapable())return;const{isDictionarySynced:e}=this._storageController.getSettings();e?this.downloadAll():this.checkForInitialSync()})}static _isSyncCapable(){if(!this._storageController.isReady())return!1;if("extension"!==Cr.getType())return!1;if(this._storageController.hasCustomServer())return!1;const{username:e,password:t,token:r}=this._storageController.getSettings();return e&&(t||r)}static disableSync(){return this._storageController.updateSettings({isDictionarySynced:!1})}static checkForInitialSync(){this._storageController.onReady(()=>{const{isDictionarySynced:e,dictionary:t}=this._storageController.getSettings();if(e)return;if(!this._isSyncCapable())return;is.trackEvent("Action","dict_sync:started");const r=t.slice(0),n=t.length;this.addBatch(r).then(()=>this.downloadList()).then(e=>{const t=e.filter(e=>r.includes(e)).length,s=t/n;s<.9&&n-t>=10?is.trackEvent("Action","dict_sync:failed_comparison",String(s)):this._storageController.updateSettings({isDictionarySynced:!0,dictionary:e}).then(()=>{is.trackEvent("Action","dict_sync:succeeded")}).catch(()=>{is.trackEvent("Action","dict_sync:failed_storage")})}).catch(e=>{console.error(e),is.trackEvent("Action","dict_sync:failed_sync",String(e))})})}static addBatch(e){if(this._syncing)return Promise.reject("already syncing");if(!this._isSyncCapable())return Promise.reject("not capable of syncing");if(e.length>this.MAX_WORDS)return is.trackEvent("Action","too_many_words_for_dictionary_batch_add",String(e.length)),Promise.reject("too many words");this._syncing=!0;const t=this._chunkBatches(e);let r=0;return new Promise((e,n)=>{const s=()=>{const a=t.shift();if(!a?.length&&!t.length)return this._syncing=!1,void e();const i=this._filterValidWords(a);i.length?this.addWord(i).then(()=>Dr(1400)).then(s).catch(e=>++r>4?(this._syncing=!1,void n(e)):s()):s()};s()})}static _filterValidWords(e){return(Array.isArray(e)?e:[e]).filter(e=>Boolean(e?.trim()&&!e.trim().match(/\s/)&&!e.match(this.EMOJI_REGEXP)))}static _chunkBatches(e){const t=[],r=e.slice(0,this.MAX_WORDS);let n;for(;(n=r.splice(0,this.BATCH_SIZE))&&n.length>0;)t.push(n);return t}static removeBatch(e){return this._deleting?Promise.reject():this._isSyncCapable()?(is.trackEvent("Action","dict_batch_delete:started",String(e.length)),e=e.slice(0,this.MAX_WORDS),this._deleting=!0,new Promise((t,r)=>{const n=()=>{if(void 0===e.shift()&&!e.length)return this._deleting=!1,is.trackEvent("Action","dict_batch_delete:succeeded"),void t();const s=this._filterValidWords(e);s.length?this.removeWord(s).then(()=>Dr(1500)).then(n).catch(e=>{this._deleting=!1,is.trackEvent("Action","dict_batch_delete:failed",e&&e.message),r(e)}):n()};n()})):Promise.reject()}static downloadAll(){this._deleting||this._storageController.onReady(()=>{if(!this._isSyncCapable())return;const{isDictionarySynced:e}=this._storageController.getSettings();e&&this.downloadList().then(e=>{this._storageController.updateSettings({dictionary:e})}).catch(()=>null)})}static _getBaseUrl(){const e=new URL("/enterprise/v1/dictionary/words",z);return e.searchParams.append("type","personal"),e}static _getHeaders(){const{username:e,token:t}=this._storageController.getSettings(),r=new Headers;if(!e||!t)return[r,new Error("User must be authenticated for interacting with the dictionary")];{const n=btoa(`${e}:${t}`);r.append("Authorization",`Basic ${n}`),r.append("Content-Type","application/json")}return[r,null]}static addWord(e,t=!1){const r=this._getBaseUrl(),[n,s]=this._getHeaders(),a=(Array.isArray(e)?e:[e]).map(e=>e.trim());return s?Promise.reject(s):fetch(r.toString(),{method:"POST",body:JSON.stringify({words:a}),headers:n}).then(e=>e.ok?Promise.resolve():Promise.reject(new Error(`Status: ${e.status}`))).catch(r=>t?(is.trackEvent("Action","dict_sync_add:failed",a.slice(0,3).concat(["…"]).join(",")),Promise.reject(r)):Dr(5e3).then(()=>this.addWord(e,!0)))}static removeWord(e,t=!1){const r=this._getBaseUrl(),[n,s]=this._getHeaders(),a=(Array.isArray(e)?e:[e]).map(e=>e.trim());return s?Promise.reject(s):fetch(r.toString(),{method:"DELETE",body:JSON.stringify({words:a}),headers:n}).then(e=>e.ok?Promise.resolve():Promise.reject(new Error(`Status: ${e.status}`))).catch(r=>t?(is.trackEvent("Action","dict_sync_remove:failed",a.slice(0,3).concat(["…"]).join(",")),Promise.reject(r)):Dr(5e3).then(()=>this.removeWord(e,!0)))}static downloadList(){const e=this._getBaseUrl(),[t,r]=this._getHeaders();return r?Promise.reject(r):(e.searchParams.append("limit",String(2e3)),fetch(e.toString(),{method:"GET",headers:t}).then(e=>e.ok?e.json():Promise.reject(new Error(`[${e.status}] Download request failed`))).then(e=>Mt(e)&&"words"in e&&Array.isArray(e?.words)?Promise.resolve(e.words.filter(e=>"string"==typeof e)):Promise.reject(new Error("Empty response while loading dictionary"))).catch(e=>(is.trackSampledEvent("Action","dict_download:failed",e&&e.message),Promise.reject(e))))}}os.MAX_WORDS=5e3,os.BATCH_SIZE=250,os._isInitialized=!1,os._syncing=!1,os._deleting=!1,os.EMOJI_REGEXP=/\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff]/;const cs={accept:"application/json","content-type":"application/json"};function ls(e){return Mt(e)&&!1===Object.values(e).some(e=>"number"!=typeof e)}function us(e){return!!Mt(e)&&[["text"],["score",ls],["label"],["origin"],["uuid"]].reduce((t,[r,n=Gt])=>!!(t&&Ft(n)&&String(r)in e)&&n(e[String(r)]),!0)}class gs{static async load(e,t,r,n,s,a){const i=[a,t.trim()].join("@"),o=this._rewriteCache.get(i),c=this._history.get(t)??null;if(o)return Promise.resolve({rephrases:o,previousSentence:c});let l="/rewriting/rewrite";a&&(l+="/"+function(e){switch(e){case"simple":return"simplicity";case"formal":return"formality";case"natural":return"humanize";default:return e}}(a));const u=(await this._request("rewrite",l,e,t,r,n,s)).filter(e=>us(e)).map(({text:e,score:t,label:r,origin:n,uuid:s})=>({text:e,score:t,label:r,origin:n,uuid:s})).filter(({text:e},t,r)=>r.findIndex(({text:t})=>e===t)===t);return u.length>0&&this._rewriteCache.set(i,u),{rephrases:u,previousSentence:c}}static abort(e){const t=void 0===e?["rewrite"]:[e];for(const e of t){const t=this._abortControllers.get(e)||[];this._abortCurrentRequests(t),this._abortControllers.set(e,[])}}static async _request(e,t,r,n,s,a,i){this.abort(e);const o=JSON.stringify({text:n,offset:0,length:0,count:"rewrite"===e?5:1,userID:r,language:s.slice(0,2),inhouseOnly:a,email:i?.email,token:i?.token,p:!0}),c=new AbortController,l=this._abortControllers.get(e)||[];cs["X-LT-checksum"]=await fr(),cs["X-LT-p"]="1",l.push(c),this._abortControllers.set(e,l);const u=await fetch(X+t,{method:"post",signal:c.signal,mode:"cors",headers:cs,body:o});if(!1===u.ok){const e=(()=>{switch(u.status){case 413:return"PayloadTooLarge";case 524:return"ServerTimeout";default:return`ServerFailure (${u.status})`}})();throw new Error(e)}const g=await u.json(),{rewrites:d=[]}=g||{};return d}static async requestSplitSentence(e,t,r,n,s){const a=this._splitSentenceCache.get(t.trim());if(a)return Promise.resolve(a);const[i]=await this._request("sentence-splitting","/rewriting/rewrite/sentence_splitting",e,t,r,n,s);return us(i)?(this._splitSentenceCache.set(t.trim(),i),i):null}static _abortCurrentRequests(e){for(const t of e)t.abort()}}gs._rewriteCache=new Map,gs._splitSentenceCache=new Map,gs._history=new Map,gs._abortControllers=new Map([["rewrite",[]],["sentence-splitting",[]]]);
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
const ds='([.…,:;?!"”“„)(]+)',hs=new RegExp("^"+ds),ms=new RegExp(ds+"$");class _s{static load(e,t,r){return-1===Xe.indexOf(t)?Promise.reject(new Error("Sorry, synonyms are not supported in this language.")):this._request(e,t,r)}static async abort(){this._abortCurrentRequest()}static _request(e,t,r){const n=this._getFromCache(e.word,e.beforeText,e.afterText,t,r);if(n)return Promise.resolve(n);this._abortCurrentRequest(),clearTimeout(this._timeout),this._abortController=new AbortController,this._timeout=self.setTimeout(()=>this._abortCurrentRequest,this.HTTP_TIMEOUT);return("en"===t?this._requestFromNewServer(this._abortController,e,t,r):this._requestFromOldServer(this._abortController,e,t,r)).finally(()=>{this._abortController=null,clearTimeout(this._timeout)})}static _requestFromOldServer(e,t,r,n){const s=t.word,a=this._prepareWord(t.word),i=new URL(`https://synonyms.languagetool.org/synonyms/${r}/${a}`);i.searchParams.set("before",t.beforeText),i.searchParams.set("after",t.afterText),n&&i.searchParams.set("motherTongue",n);const o={method:"get",mode:"cors",signal:e.signal};return fetch(i.toString(),o).then(e=>e.json()).then(e=>{if(!e||!e.synsets)throw new Error("Error loading synonyms.");const i=this._buildSynonymSets(a,s,e),o={dataSource:e.dataSource,synonymSets:i,genders:e.genders};return this._setInCache(t.word,t.beforeText,t.afterText,r,n,o),o})}static _requestFromNewServer(e,t,r,n){let s=t.word;const a=t.afterText.match(hs);a&&(s+=a[1]);const i=t.beforeText.match(ms);return i&&(s=i[1]+s),fetch(se,{method:"POST",signal:e.signal,headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({message:{text:t.sentence,phrases:[s],mode:0,indices:[t.beforeText?t.beforeText.split(" ").length:0]},response_queue:"string",meta:{traceID:"string",userID:"string",product:"string",clientStatus:"string"}})}).then(e=>e.json()).then(e=>{if(!(e&&"OK"===e.message&&e.data&&e.data.suggestions&&Array.isArray(e.data.suggestions[s])))throw new Error("Unexpected response");let o=[];if(e.data.suggestions[s].forEach(e=>{i&&a?e.startsWith(i[1])&&e.endsWith(a[1])&&o.push(e.replace(ms,"").replace(hs,"")):a?e.endsWith(a[1])&&!e.includes(a[1]+" ")&&o.push(e.replace(ms,"")):i?e.startsWith(i[1])&&!e.includes(" "+i[1])&&o.push(e.replace(hs,"")):o.push(e.replace(ms,""))}),!o.length)return Promise.reject(new Error("No synonyms found"));o=rr(o),o.length=Math.min(o.length,12);const c={synonymSets:[{title:"",type:"",synonyms:o.filter(e=>e!==s).map(e=>({word:e,hints:[]}))}],genders:[]};return this._setInCache(t.word,t.beforeText,t.afterText,r,n,c),c}).catch(s=>"AbortError"!==s?.name?this._requestFromOldServer(e,t,r,n):Promise.reject(s))}static _prepareWord(e){return e=e.trim(),Xt(e)?e.charAt(0)+e.substr(1).toLowerCase():e}static _containsSynonymObj(e,t){return e.some(e=>e.word===t.word)}static _buildSynonymSets(e,t,r){const n=[],s=Xt(t)&&t.length>3;return r.synsets.forEach(r=>{if(!r.terms.length)return;let a="",i="";r.terms[0].term.match(this.IS_ONLY_HINT_REGEXP)?(a=`${t} ${r.terms[0].term}`,i=r.terms[0].term.replace(/[\(\)]/g,""),r.terms.shift()):a=r.terms[0].term;const o=[];if(r.terms.forEach(t=>{let r=Array.from(t.term.match(this.HINT_REGEXP)||[]);if(r=r.map(e=>e.replace(this.TERM_REGEXP,"").trim()),r=r.filter(e=>!e.match(/similar/)),r.indexOf("(antonym)")>-1)return;let n=t.term.replace(this.HINT_REGEXP,"").trim();n.match(/[\!\?\,\:\;]/)||n.toLowerCase()!==e.toLowerCase()&&(s&&(n=n.toUpperCase()),n.trim()&&o.push({word:n,hints:r}))}),!o.length)return;const c=n.find(e=>e.type===i&&e.title===a&&e.synonyms.find(e=>this._containsSynonymObj(o,e)));if(c)o.forEach(e=>{this._containsSynonymObj(c.synonyms,e)||c.synonyms.push(e)});else{if(i){if(n.filter(e=>e.type===i).length>=3)return}n.push({title:a,type:i,synonyms:o})}}),n}static _abortCurrentRequest(){this._abortController&&(this._abortController.abort(),this._abortController=null)}static _getFromCache(e,t,r,n,s){const a=this._cache.find(a=>a.word===e&&a.beforeText===t&&a.afterText===r&&a.language===n&&a.motherTongue===s);if(a)return a.result}static _setInCache(e,t,r,n,s,a){this._cache.unshift({word:e,beforeText:t,afterText:r,language:n,motherTongue:s,result:a}),this._cache.length=Math.min(this._cache.length,100)}}_s.HTTP_TIMEOUT=5e3,_s._abortController=null,_s._cache=[],_s.IS_ONLY_HINT_REGEXP=/^\s*\([^\)]+\)\s*$/,_s.TERM_REGEXP=/\sterm/,_s.HINT_REGEXP=/(\s|^)\((.+?)\)/g,_s.emptySynonymResult={synonymSets:[],dataSource:{licenseUrl:"",sourceName:"",sourceUrl:""},genders:null};let ps=(()=>{const e={};return{set:(t,r)=>(e[t]=r,Promise.resolve()),get:t=>Promise.resolve(e[t]),getAll:()=>Promise.resolve(e),delete:t=>(delete e[t],Promise.resolve())}})();async function Es(e){if(!await ps.get(e))throw console.error("Failed to destroy activity; no User Activity found for UUID:",e),new Error("Failed to destroy activity; no User Activity found for UUID");const t=await fs(e);return await ps.delete(e),t}async function fs(e){const t=await ps.get(e);if(!t)return"unknown_uuid";try{const r={source:t.source,data:{rewritings:t.rewritings,...t.statistics,...t.suggestions,...t.meta}};if(!function({data:e}){const t=["checkLevel","writingGoalId","language"];return Object.entries(e).filter(([e])=>!1===t.includes(e)).some(([,e])=>Boolean(e))&&Gt(e.language)}(r))return"no_update";await async function(e){let t=await ps.get(e);t&&(t={...t,suggestions:{spelling:0,grammar:0,style:0,punctuation:0,typography:0},statistics:{words:0,sentences:0,texts:0,hiddenMatches:0,premiumMatches:0,pickyErrors:0},rewritings:0},await ps.set(e,t))}(e);const n={method:"POST",referrerPolicy:"no-referrer",credentials:"omit",mode:"cors",headers:{Authorization:`Basic ${btoa([t.email,t.token].join(":"))}`,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(r)};return"standalone"===t.source&&(n.keepalive=!0),await _r(ne,n,3e4),"success"}catch{return"error"}}
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
class Ss{constructor(){this.TRACKING_BASE_URL="https://analytics.languagetoolplus.com/matomo/piwik.php",this.TRACKING_BASE_PAGE_URL="https://fake/",this.ACTIVITY_TRACK_INTERVAL=864e5,this.PING_TRACK_INTERVAL=6048e5,this.MAX_TIME=6e4,this.THROTTLE_REQUESTS=10,this._isInitialized=!1,this._loggedErrors=null,this._errorCount=0}initialize(){if(this._isInitialized)return;this.TRACKING_SITE_ID=Cr.getTrackingId(),this.VERSION=Cr.getVersion(),this._storageController=ns.create();const e=Cr.getURL("/");self.addEventListener("error",t=>{const r=t.message,n=t.filename,s=t.lineno,a=t.error;if(!n||!n.startsWith(e))return;if("string"!=typeof r)return;if(r.includes("ResizeObserver"))return;const i=a&&function(e){if(!e.stack)return;const t=[];if(e.stack.split(/\n/).forEach(e=>{const r=e.match(/([\w_<>]+)\s+\(.+?([\w_\-]+\.(js|html))/);r&&t.push(`${r[2]}:${r[1]}`)}),!t.length){const r=e.stack.match(/([\w_\-]+\.(js|html))/);r&&t.push(r[1])}return t.join(",").substr(0,140)}(a);i?this.trackError("js",r,i):this.trackError("js",r,`${n}:${s}`)}),this._isInitialized=!0}getCustomDimensions(e){const t=this._storageController.getSettings(),r=this._storageController.getUIState(),n=this._storageController.getTestFlags(),s=this._storageController.getPrivacySettings(),a={dimension2:this.VERSION,dimension3:String(r.hasPaidSubscription),dimension4:String(Boolean(t.username&&(t.password||t.token))),dimension5:t.preferredLanguages.join(","),dimension6:String(t.hasPickyModeEnabledGlobally),dimension13:r.showRuleId?"{}":JSON.stringify(n.testGroups),dimension15:String(s.acceptedTermsOfServiceVersion||"none"),dimension16:String(t.hasLollipopEnabled),dimension17:String(es.getStatus())};return e?.writingGoal&&(a.dimension8=e.writingGoal),e?.errorType&&(a.dimension9=e.errorType),a}_getTrackingUrlForPageView(e,t){return e=(e=e.replace(/^(chrome|moz|safari|edge)-extension:\/\/.+?\//i,"")).replace(/^[a-z0-9]{8}\//i,"/"),e=`${this.TRACKING_BASE_PAGE_URL}${e}`,new Promise((r,n)=>{this._storageController.onReady(()=>{const{firstVisit:n,sessionCount:s}=this._storageController.getStatistics(),a=this._storageController.getUniqueId(),i=new URL(this.TRACKING_BASE_URL),o=[self.screen?.width??0,self.screen?.height??0],c={idsite:this.TRACKING_SITE_ID,rec:"1",url:e,rand:String(Date.now()),apiv:"1",res:o.join("x"),_id:String(a),_idts:String(n),_idvc:String(s),...this.getCustomDimensions(t)};for(const[e,t]of Object.entries(c))i.searchParams.append(e,t);r(i.toString())})})}_getTrackingUrlForEvent(e,t,r="",n,s){return n=n||this.TRACKING_BASE_PAGE_URL,new Promise((a,i)=>{this._storageController.onReady(()=>{const{firstVisit:i,sessionCount:o}=this._storageController.getStatistics(),c=this._storageController.getUniqueId(),l=new URL(this.TRACKING_BASE_URL),u=[self.screen?.width??0,self.screen?.height??0],g={idsite:this.TRACKING_SITE_ID,rec:"1",url:n||"",action_name:t,rand:String(Date.now()),apiv:"1",res:u.join("x"),_id:c,_idts:String(i),_idvc:String(o),e_c:e,e_a:t,e_n:r??"",...this.getCustomDimensions(s)};for(const[e,t]of Object.entries(g))l.searchParams.append(e,t);a(l.toString())})})}_sendRequest(e){!Cr.shouldTrack()||this._storageController.hasCustomServer()||this._storageController.hasCustomLogin()||navigator.webdriver||_r(e,{mode:"no-cors",referrerPolicy:"no-referrer",keepalive:"standalone"===Cr.getType()},1e4).catch(()=>null)}trackPageView(e,t){e=e||or(),this._getTrackingUrlForPageView(e,t).then(t=>{Cr.isProductionEnvironment()?this._sendRequest(t):console.log("LT_Tracking Page view tracking disabled in dev mode",{pageUrl:e,trackingUrl:t})}).catch(e=>{console.log("LT could not track because:",e&&e.message)})}trackDisabledRule(e,t,r,n){if(!e.match(/^de|en|nl|es|fr|ca|pt/i))return;const s=n?Ye.PREMIUM:Ye.BASIC,a=e+":"+t,i=r,o=new URL(this.TRACKING_BASE_URL);o.searchParams.append("idsite","18"),o.searchParams.append("rec","1"),o.searchParams.append("url",this.TRACKING_BASE_PAGE_URL),o.searchParams.append("action_name",s),o.searchParams.append("rand",String(Date.now())),o.searchParams.append("apiv","1"),o.searchParams.append("_id",this._storageController.getUniqueId()),o.searchParams.append("e_c",s),o.searchParams.append("e_a",a),o.searchParams.append("e_n",r),Cr.isProductionEnvironment()?this._sendRequest(o.toString()):console.log("LT_Tracking Event tracking disabled in dev mode",{actionCategory:s,action:a,actionName:i,trackingUrl:o})}trackDictionaryEvent(e,t,r){if(!e.match(/^de|en|nl|es|fr|it|pt|ru|ca|pl/i))return;const n=r?"TemporaryIgnored":"PersistentlyIgnored",s=`${e}:add_word`,a=t,i=new URL(this.TRACKING_BASE_URL);i.searchParams.append("idsite","19"),i.searchParams.append("rec","1"),i.searchParams.append("url",this.TRACKING_BASE_PAGE_URL),i.searchParams.append("action_name",n),i.searchParams.append("rand",String(Date.now())),i.searchParams.append("apiv","1"),i.searchParams.append("_id",this._storageController.getUniqueId()),i.searchParams.append("e_c",n),i.searchParams.append("e_a",s),i.searchParams.append("e_n",t),Cr.isProductionEnvironment()?this._sendRequest(i.toString()):console.log("LT_Tracking Event tracking disabled in dev mode",{actionCategory:n,action:s,actionName:a,trackingUrl:i})}trackEvent(e,t,r,n,s){this._getTrackingUrlForEvent(e,t,r,n,s).then(n=>{Cr.isProductionEnvironment()?this._sendRequest(n):console.log("LT_Tracking Event tracking disabled in dev mode",{actionCategory:e,action:t,actionName:r,trackingUrl:n})}).catch(e=>{console.log("LT could not track because:",e&&e.message)})}trackInstall(){this.trackEvent("Action","install",$n.getPrimaryLanguageCode(navigator.language))}trackActivity(){this._storageController.onReady(()=>{const e=Date.now(),{sessionCount:t,lastActivity:r,lastPing:n}=this._storageController.getStatistics();(!r||e-r>this.ACTIVITY_TRACK_INTERVAL)&&this._storageController.updateStatistics({sessionCount:t+1,lastActivity:e}).then(()=>{this.trackUserActivity()}),(!n||e-n>this.PING_TRACK_INTERVAL)&&this._storageController.updateStatistics({lastPing:e}).then(()=>{this.trackEvent("Stat","ping")})})}trackUserActivity(){this._storageController.onReady(()=>{const{username:e}=this._storageController.getSettings();if(!e||this._storageController.hasCustomServer())return;const t=new FormData;t.append("email",e),t.append("useragent",E.getUserAgentIdentifier()),_r(te,{method:"POST",mode:"cors",credentials:"omit",body:t},1e4).catch(()=>null)})}trackError(e,t,r=""){try{if(E.isUnsupportedBrowser())return;if(this._errorCount++,this._errorCount>Me)return;if("string"!=typeof t)return;if(this._loggedErrors)if(this._loggedErrors.length<this.THROTTLE_REQUESTS)this._loggedErrors.push(Date.now());else{const e=Date.now();if(!(e-this._loggedErrors[0]>=this.MAX_TIME))return;this._loggedErrors.push(e),this._loggedErrors.splice(0,1)}else this._loggedErrors=[Date.now()];let n="JS-Error";"message"===e?n="Message-Error":"http"===e?n="HTTP-Error":"other"===e&&(n="Other-Error");let s=or();s=s.replace(/^moz-extension:\/\/[a-z0-9\-]+\//,"moz-extension://xxxx-xxxx-xxxx-xxxx/"),s.match(/(chrome|moz|safari)\-extension:/)||(s=void 0),this.trackEvent(n,t,r||s,s)}catch(e){console.error("Error while logging error from language tool",e)}}trackStat(e,t){0===Math.floor(10*Math.random())&&this.trackEvent("Stat",e,t)}trackPerformanceMetrics(){}trackHealthMetrics(){}trackUserTextChangeMetrics(){}trackFixAllMetrics(){}trackUnderlineMismatchMetrics(){}trackEmptyTextDiffMetrics(){}}var Ts;class As{static init(){this._storageController=ns.create()}static async run(){if(this._isRunning)return;this._isRunning=!0,await this._waitForStorageController();const e=this._getPendingMigrations();let t;console.log(`Running ${e.length} migrations …`),e.length&&is.trackEvent("Action","migrate",String(e.length));for(const r of e)try{console.log(`Migrating ${r.version} …`),await r.exec(),t=r.version}catch(e){console.error(e),is.trackError("js",`Migration failed: ${r.version}`,e.message);break}t&&await this._storageController.updateSettings({lastMigration:t}),this._isRunning=!1}static getLastMigrationVersion(){const e=[...this.migrations].sort((e,t)=>e.version>t.version?-1:1);return e.length?e[0].version:null}static skipAll(){const e=this.getLastMigrationVersion();return this._storageController.updateSettings({lastMigration:e})}static _waitForStorageController(){return new Promise(e=>{this._storageController.onReady(()=>e())})}static _getPendingMigrations(){const e=this._storageController.getSettings().lastMigration||0;return this.migrations.filter(t=>t.version>e)}}Ts=As,As._isRunning=!1,As._enableLollipopForInternalTesters=()=>E.isFirefox()||E.isSafari()?Promise.resolve():Ts._storageController.isInternalTester()?Ts._storageController.updateSettings({hasLollipopEnabled:!0}):Promise.resolve(),As._removeLollipopTestFlag=()=>{const{testGroups:{lollipop:e,...t}}=Ts._storageController.getTestFlags();return void 0!==e?Ts._storageController.updateTestFlags({testGroups:t}):Promise.resolve()},As._addLanguageDetectionTestFlag=()=>Is.setupLanguageDetectionTest(),As._setPreliminary3rdPartyAiOption=()=>null===Ts._storageController.getSettings().userId?Ts._storageController.updatePrivacySettings({hasOptedIntoThirdPartyAiParaphrasing:!0}):Promise.resolve(),As._removeUkrainianUsersFromLanguageDetectionTest=()=>{const{preferredLanguages:e}=Ts._storageController.getSettings(),{testGroups:t}=Ts._storageController.getTestFlags();return e.includes("uk")&&t.languageDetection?Ts._storageController.updateTestFlags({testGroups:{}}):Promise.resolve()},As._removeGalicianFromPreferredLanguages=()=>{const{preferredLanguages:e,geoIpCountry:t,username:r,motherTongue:n}=Ts._storageController.getSettings();return"ca,en,es,gl"!==[...e].sort().join(",")||!t||"es"!==t.toLowerCase()||(navigator.languages||[]).some(e=>e.toLowerCase().startsWith("gl"))||(navigator.language||"").toLowerCase().startsWith("gl")||"gl"===n||(r||"").endsWith(".gal")?Promise.resolve():Ts._storageController.updateSettings({preferredLanguages:e.filter(e=>"gl"!==e)})},As.migrations=[{version:17040672e5,exec:Ts._enableLollipopForInternalTesters},{version:1753431056298,exec:Ts._removeLollipopTestFlag},{version:1758218993529,exec:Ts._addLanguageDetectionTestFlag},{version:1759321037247,exec:Ts._setPreliminary3rdPartyAiOption},{version:1759419219111,exec:Ts._removeUkrainianUsersFromLanguageDetectionTest},{version:1760002321031,exec:Ts._removeGalicianFromPreferredLanguages}];class Cs{constructor(){this.abortControllers={}}static getInstance(){return Cs.instance||(Cs.instance=new Cs),Cs.instance}async fetchSupportedLanguages(){const e=await fetch(`${$}/supported-languages`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to fetch supported languages: ${e.status}`);const t=await e.json();return Object.entries(t?.available_languages||{}).map(([e,t])=>({englishName:e,code:t}))}translate(e){const{sourceLang:t,targetLang:r,sentences:n,leftContext:s,rightContext:a}=e.payload,{abortId:i}=e.meta;if(!n.length)return{response:Promise.resolve({data:[]}),abortId:i};const o=new AbortController;this.abortControllers[i]=o;const c={leftContext:s,rightContext:a,sourceLang:t,targetLang:r,sentences:n};return{response:fr().then(e=>fetch(`${$}/subscribe`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-LT-checksum":e},body:JSON.stringify(c),signal:o.signal})).then(async e=>{if(!e.ok)throw new Error(`Translation request failed: ${e.status}`);const t=await e.json();return{data:(t.translations??[t.translation]).map((e,t)=>({sourceText:n[t],translation:e}))}}).finally(()=>{this.cleanupAbortController(i)}),abortId:i}}abortRequest(e){const t=this.abortControllers[e];t?t.abort():console.warn(`No active translate request found with ID: ${e}`)}cleanupAbortController(e){delete this.abortControllers[e]}}Cs.getInstance();
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
var Rs;class Is{static _initThunderbird(){E.isThunderbird()&&as.registerComposeScripts()}static _installUpdate(){yr().tabs.query({}).then(e=>{e.forEach(e=>{if(!e.id)return;yr().tabs.sendMessage(e.id,{command:"DESTROY"}).catch(console.error.bind(console))})}),is.trackEvent("Action","pre_update"),self.setTimeout(()=>{yr().runtime.reload()},2e3)}static async _queryForDarkMode(){if(await this._hasDarkTheme())return!0;const e=await this._getActiveTabs(),[{id:t}={}]=e;if("number"!=typeof t)return null;const r=await yr().tabs.sendMessage(t,{command:"CHECK_IS_DARK_MODE"}).catch(()=>null);if(!r||!r.isSuccessful)return null;const{isDarkMode:n=null}=function(e){return"CHECK_IS_DARK_MODE"===e.initialCommand}(r)?r:{};return n}static async _hasDarkTheme(){if(E.isFirefox()||E.isThunderbird()&&yr().theme){const e=await yr().theme.getCurrent();if(e?.colors?.toolbar){const t=Jr(e.colors.toolbar);return t&&t.lightness<=35}}return null}static _updateIcon(e=!1){E.isSafari()||this._storageController.onReady(async()=>{const t=await this._queryForDarkMode();null!==t?this.setIcon(t,e):this._storageController.updateUIState({isDarkModeEnabled:void 0})})}static async setIcon(e,t=!1){if(E.isSafari())return;const{isDarkModeEnabled:r}=this._storageController.getUIState();(r!==e||t)&&(e?this._browserAction.setIcon({path:{16:"/assets/images/icons/icon16_white.png",32:"/assets/images/icons/icon32_white.png",48:"/assets/images/icons/icon48_white.png",64:"/assets/images/icons/icon64_white.png",128:"/assets/images/icons/icon128_white.png"}}).catch(()=>null):this._browserAction.setIcon({path:{16:"/assets/images/icons/icon16.png",32:"/assets/images/icons/icon32.png",48:"/assets/images/icons/icon48.png",64:"/assets/images/icons/icon64.png",128:"/assets/images/icons/icon128.png"}}).catch(()=>null),await this._storageController.updateUIState({isDarkModeEnabled:e}))}static _setContextMenu(){this._contextMenu&&!E.isSafari()&&(this._contextMenu.onClicked.removeListener(this._onContextMenuItemClicked),this._contextMenu.onClicked.addListener(this._onContextMenuItemClicked),this._storageController.onReady(()=>{const{hasContextMenuOptionEnabled:e}=this._storageController.getSettings(),{disableOpenInEditor:t}=this._storageController.getManagedSettings();this._contextMenu.removeAll().then(()=>{if(!e||t)return;let r=vr.getMessage("contextMenuValidate");this._storageController.hasLanguageToolAccount()&&(r=vr.getMessage("contextMenuValidateInEditor")),this._contextMenu.create({title:r,id:this.CONTEXT_MENU_ID,contexts:["selection"]})})}))}static _updateBadge(e,t){if(this._browserAction.setBadgeTextColor){const t=this._browserAction.setBadgeTextColor({tabId:e,color:"#FFFFFF"});t&&t.catch(console.error.bind(console))}t.enabled&&t.supported?this._browserAction.setBadgeText({tabId:e,text:""}).catch(console.error.bind(console)):(this._browserAction.setBadgeBackgroundColor&&this._browserAction.setBadgeBackgroundColor({tabId:e,color:"#F53987"}).catch(console.error.bind(console)),this._browserAction.setBadgeText({tabId:e,text:E.isOpera()?"":"OFF"}).catch(console.error.bind(console)))}static _updateUninstallURL(e="unknown"){const t=this._storageController.getPrivacySettings(),r=this._storageController.getTestFlags(),n=yr().runtime.getManifest(),s=n&&n.version||"unknown",a=new URL(H);a.searchParams.set("host",e),a.searchParams.set("v",s),a.searchParams.set("privacyConfirmed",String(t.allowRemoteCheck));const i=this._storageController.getUniqueId();i&&a.searchParams.set("matomo",i);for(const e in r.testGroups)r.testGroups.hasOwnProperty(e)&&a.searchParams.set(e,String(r.testGroups[e]));Cr.isProductionEnvironment()||a.searchParams.set("dev",""),yr().runtime.setUninstallURL(a.toString().slice(0,255))}static _setMotherTongue(){const{motherTongue:e,geoIpLanguages:t}=this._storageController.getSettings();if(e)return;const r=t.some(e=>!!e.match(/^de/i))&&navigator.languages[0]&&navigator.languages[0].match(/^de/i),n=Array.from(navigator.languages).some(e=>!e.match(/^(de|en)/i));r&&!n&&(is.trackEvent("Action","set_mother_tongue","de"),this._storageController.updateSettings({motherTongue:"de"}));const s=t.some(e=>!!e.match(/^fr/i))&&navigator.languages[0]&&navigator.languages[0].match(/^fr/i),a=Array.from(navigator.languages).some(e=>!e.match(/^(fr|en)/i));s&&!a&&(is.trackEvent("Action","set_mother_tongue","fr"),this._storageController.updateSettings({motherTongue:"fr"}))}static _launchEditor(e,t){let r;e&&(r=Math.round(99999*Math.random())+":"+Date.now(),this._validatorsData.set(r,{id:r,text:e,html:t,timestamp:Date.now()}));let n=Cr.getURL(`/validator/validator.html?id=${r}`);const{username:s,token:a}=this._storageController.getSettings();if(E.isSafari()){const r=this._storageController.getSettings().userId||void 0;return void yr().runtime.sendMessage({userId:r,message:{username:s,token:a,text:e,html:t},command:"LAUNCH_DESKTOP_EDITOR"})}s&&a&&navigator.onLine&&(n=function(e,t,r){const n=new URL(W);return n.searchParams.set("email",e),n.searchParams.set("addon_token",t),r&&n.searchParams.set("temp_text_id",r),n.toString()}(s,a,r)),yr().tabs.create({url:n}).then(e=>{e&&e.windowId&&yr().windows.update(e.windowId,{focused:!0})})}static _applyManagedSettings(){const{disablePrivacyConfirmation:e}=this._storageController.getManagedSettings();!0===e&&this._storageController.updatePrivacySettings({allowRemoteCheck:!0,acceptedTermsOfServiceVersion:dt})}static _loadConfiguration(){this._storageController.onReady(()=>{if(this._storageController.hasCustomServer())return;const e=yr().runtime.getManifest(),t=e&&e.version||"unknown",r=new URL(J);r.searchParams.set("v",t),r.searchParams.set("ua",E.getUserAgentIdentifier()),_r(r.toString(),{credentials:"omit"},1e4).then(e=>e.json()).then(e=>{if(e.disabledSites&&Array.isArray(e.disabledSites)){const t={unsupportedDomains:e.disabledSites};this._storageController.updateRemoteConfiguration(t)}if("isTrialSupported"in e){!this._storageController.getTrialSettings().isTrialSupportedInCountry&&e.isTrialSupported&&(is.trackEvent("Action","trial:supported",this._storageController.getSettings().geoIpCountry),this._storageController.updateTrialSettings({isTrialSupportedInCountry:e.isTrialSupported}))}}).catch(()=>null)})}static _isEligibleForTrialPage(){if(!es.canStart())return{status:!1,reason:1};if(es.isRunning())return{status:!1,reason:2};if(es.isFunctionalityLocked())return{status:!1,reason:3};if(this._storageController.getStatistics().appliedSuggestions<5)return{status:!1,reason:4};const e=Math.round(Date.now()/1e3),{firstVisit:t}=this._storageController.getStatistics();return!t||e-t<172800?{status:!1,reason:5}:{status:!0}}static _isTrialPageOpen(){return yr().tabs.query({}).then(e=>Promise.all(e.map(e=>new Promise((t,r)=>{if(!e.id)return void t(!1);const n=self.setTimeout(r,1e3);yr().tabs.sendMessage(e.id,{command:"TRIAL_PAGE_PING"}).then(e=>{self.clearTimeout(n),t("success"===e)},()=>{t(!1),self.clearTimeout(n)})})))).then(e=>e.includes(!0)).catch(()=>!1)}static _openTrialPage(){const e="https://languagetool.org/webextension/premium-announcement?type=background_tab&utm_campaign=addon2-trial-page";yr().windows.getAll({windowTypes:["normal"]}).then(t=>{const r=(t||[]).find(e=>e.focused&&"normal"===e.type);is.trackEvent("Action","trial_page_open_type",r?"existing-window":"empty-window"),r?yr().tabs.create({windowId:r.id,active:!1,url:e}).catch(e=>{is.trackError("other","trial_page:open_tab_error",String(e))}):yr().tabs.create({active:!1,url:e}).catch(e=>{is.trackError("other","trial_page:open_tab_error",String(e))})},()=>{is.trackError("other","trial_page:get_window_error")})}static _checkForTrialPage(){const e=this._isEligibleForTrialPage();e.status?this._isTrialPageOpen().then(e=>{e||(E.isSafari()?setTimeout(()=>this._openTrialPage(),3e4):this._openTrialPage())}):is.trackSampledEvent("Stat","ineligible_for_trial_page",String(e.reason))}static async _fetchTranslateSupportedLanguages(){try{const e=await Cs.getInstance().fetchSupportedLanguages();await this._storageController.updateSettings({translateLanguages:e})}catch(e){console.warn("Failed to fetch translate supported languages:",e),is.trackError("http","translate_supported_languages_fetch_failed")}}static _onGetTermsOfServiceInfoMessage(e){return this.getTermsOfServiceInfo(e.version)}static getTermsOfServiceInfo(e){const{username:t,token:r}=this._storageController.getSettings();if(!t||!r)return Promise.resolve({initialCommand:"GET_TERMS_OF_SERVICE_INFO",isSuccessful:!0,isAcceptanceRequired:!1,hasAccepted:!1});const n=new URLSearchParams({email:t,addon_token:r});return _r(`${ae}${e}?${n.toString()}`,{mode:"cors",credentials:"omit"},1e4).then(e=>e.json()).then(e=>({initialCommand:"GET_TERMS_OF_SERVICE_INFO",isSuccessful:!0,isAcceptanceRequired:e.data.acceptance_required,hasAccepted:e.data.accepted}))}static _onAcceptTermsOfServiceMessage(e){const{username:t,token:r}=this._storageController.getSettings();if(!t||!r)return Promise.resolve();const n=new URLSearchParams({email:t,addon_token:r});return _r(`${ae}${e.version}?${n.toString()}`,{method:"POST"},3e4).then(()=>{})}static _checkForPaidSubscription(){this._storageController.checkForPaidSubscription().catch(console.error)}static _onSyncUserData(e=!1){const t=Date.now();return this._lastUserDataSync&&this._lastUserDataSync+w>t&&!e?Promise.resolve():(this._userSyncAbortController?.abort(),this._userSyncAbortController=void 0,this._lastUserDataSync=t,new Promise(e=>this._storageController.onReady(async t=>{if(!t.hasLanguageToolAccount())return void e();const{username:r,token:n}=t.getSettings();try{this._userSyncAbortController=new AbortController;const s=new URLSearchParams({email:r,addon_token:n}),a=await _r(`${j}?${s.toString()}`,{mode:"cors",credentials:"omit"},1e4,this._userSyncAbortController);this._userSyncAbortController=void 0;const{data:i={},error:o}=await a.json().catch(()=>({error:"Request failed"}));if("string"==typeof o&&o.length>0)return is.trackError("http","user_data_sync_error",o),void e();const c={..."number"==typeof i.id?{userId:i.id}:void 0},l={..."boolean"==typeof i.statistics_collection?{hasStatisticsCollectionEnabled:i.statistics_collection}:void 0,hasOptedIntoThirdPartyAiGrammarChecking:"boolean"==typeof i.opt_in_3rd_party_ai_grammar_checker&&i.opt_in_3rd_party_ai_grammar_checker,hasOptedIntoThirdPartyAiParaphrasing:"boolean"==typeof i.opt_in_3rd_party_ai_paraphraser&&i.opt_in_3rd_party_ai_paraphraser};if(t.updateSettings(c),t.updatePrivacySettings(l),!0===i.prefer_oxford_spelling)t.removeIgnoredRule("OXFORD_SPELLING_Z_NOT_S");else{const e={id:"OXFORD_SPELLING_Z_NOT_S",language:"en",turnOffDate:new Date};t.addIgnoredRule(e)}e()}catch(t){"AbortError"!==Object(t).name&&is.trackError("other","user_data_sync_failed"),e()}})))}static _openPrivacyConfirmationDialog(){this._storageController.updateUIState({hasSeenPrivacyConfirmationDialog:!0});let e=`${B}?new&v=${Cr.getVersion()}`;Cr.isProductionEnvironment()||(e+="&dev"),yr().tabs.create({url:e}).then(e=>{e&&e.windowId&&yr().windows.update(e.windowId,{focused:!0})})}static _setLanguagePreferences(){return $n.getLanguagesForGeoIPCountry().then(e=>{const t={geoIpLanguages:e.geoIpLanguages,geoIpCountry:e.geoIpCountry||""};"GB"===e.geoIpCountry||"IE"===e.geoIpCountry?t.enVariant="en-GB":"US"===e.geoIpCountry?t.enVariant="en-US":"CA"===e.geoIpCountry?t.enVariant="en-CA":"NZ"===e.geoIpCountry?t.enVariant="en-NZ":"AU"===e.geoIpCountry?t.enVariant="en-AU":"ZA"===e.geoIpCountry?t.enVariant="en-ZA":"DE"===e.geoIpCountry?t.deVariant="de-DE":"AT"===e.geoIpCountry?t.deVariant="de-AT":"CH"===e.geoIpCountry?t.deVariant="de-CH":"BR"===e.geoIpCountry?t.ptVariant="pt-BR":["PT","IT","DE","ES","NL","BE","CH","AT","FR","LU","GB","IE","PL","CZ"].includes(e.geoIpCountry)&&(t.ptVariant="pt-PT");const r="CA"===e.geoIpCountry,n=navigator.languages.some(e=>"en-ca"===e.toLowerCase()),s=navigator.languages.some(e=>"fr-ca"===e.toLowerCase());if(r||n||s){const e={id:"FRENCH_WHITESPACE",language:"fr",description:"Insertion des espaces fines insécables",turnOffDate:new Date},r=this._storageController.getSettings().ignoredRules;r.push(e),t.ignoredRules=r}if("ZA"===e.geoIpCountry){const e={id:"COMMA_PERIOD_CONFUSION",language:"en",description:"Decimal separator in numbers",turnOffDate:new Date},r=this._storageController.getSettings().ignoredRules;r.push(e),t.ignoredRules=r}{const e={id:"OXFORD_SPELLING_Z_NOT_S",language:"en",turnOffDate:new Date},{ignoredRules:r}=this._storageController.getSettings();r.push(e),t.ignoredRules=r}return this._storageController.updateSettings(t)}).finally(()=>{this._setMotherTongue(),this._setPreferredLanguages()})}static _registerAlarms(){yr().alarms.create("UPDATE_ICON",{periodInMinutes:y/1e3/60}),this._checkForPaidSubscription(),yr().alarms.create("CHECK_FOR_PAID_SUBSCRIPTION",{periodInMinutes:b/1e3/60}),this._loadConfiguration(),yr().alarms.create("LOAD_CONFIGURATION",{periodInMinutes:O/1e3/60}),this._onSyncUserData(),yr().alarms.create("SYNC_USER_DATA",{periodInMinutes:w/1e3/60}),yr().alarms.create("SYNC_DICTIONARY",{periodInMinutes:D/1e3/60}),yr().alarms.create("SEND_AND_DESTROY_COMPLETED_USER_ACTIVITIES",{periodInMinutes:we/1e3/60}),this._fetchTranslateSupportedLanguages(),yr().alarms.create("FETCH_TRANSLATE_SUPPORTED_LANGUAGES",{periodInMinutes:ve/1e3/60}),E.isSafari()||E.isThunderbird()||yr().alarms.create("CHECK_FOR_TRIAL_PAGE",{periodInMinutes:x/1e3/60})}static _setPreferredLanguages(){this._storageController.updateSettings({preferredLanguages:this._getInitialPreferredLanguages()})}static _onUserCredentialsChanged(e){(Boolean(e.username?.newValue)||Boolean(e.token?.newValue))&&os.checkForInitialSync()}static _onPageLoadedMessage(e,t){if(0!==e.frameId||!e.tab)return;const r=e.tab.id,n={enabled:t.enabled,supported:t.supported,unsupportedMessage:t.unsupportedMessage,language:null,beta:t.beta};this._extensionStates.set(r,n),yr().tabs.detectLanguage&&!E.isOpera()&&yr().tabs.detectLanguage(r).then(e=>{e&&"und"!==e&&(n.language=$n.getPrimaryLanguageCode(e))}).catch(e=>{console.error("Error detecting language",e)});const s=e.tab.url||"about:blank";this._updateUninstallURL(cr(s)),this._updateBadge(r,n),this._hasDarkTheme().then(e=>{null===e?this.setIcon(t.isDarkMode):this.setIcon(e)}).catch(()=>null)}static async _onCheckForPaidSubscriptionMessage(){try{return{initialCommand:"CHECK_FOR_PAID_SUBSCRIPTION",isSuccessful:!0,hasPaidSubscription:await this._storageController.checkForPaidSubscription()}}catch(e){return{initialCommand:"CHECK_FOR_PAID_SUBSCRIPTION",isSuccessful:!1,error:{reason:e.reason,status:e.status,response:e.response,url:e.url,stack:e.stack}}}}static _onLTAssistantStatusChangedMessage(e,t){const r=t.tabId||e.tab.id;if(!this._extensionStates.has(r))return;const n=this._extensionStates.get(r);"boolean"==typeof t.enabled&&(n.enabled=t.enabled),this._updateBadge(r,n)}static _onTrackEventMessage(e,t){is.trackEvent("Action",t.action,t.label)}static _onOpenFeedbackFormMessage(e,t){this._lastScreenshot=null;("function"!=typeof yr().tabs.captureVisibleTab?Promise.reject():"number"==typeof e.tab?.windowId?yr().tabs.captureVisibleTab(e.tab.windowId):yr().tabs.captureVisibleTab()).then(e=>{this._lastScreenshot=function(e){const t=atob(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),s=new Uint8Array(n);for(let e=0;e<t.length;e++)s[e]=t.charCodeAt(e);return new Blob([n],{type:r})}(e)}).catch(()=>null).then(()=>{const e=new URL("/feedbackForm/feedbackForm.html","http://example.com");return e.searchParams.append("url",t.url.substr(0,200)),t.html&&e.searchParams.append("html",t.html.substr(0,600)),t.title&&e.searchParams.append("title",t.title),this._lastScreenshot&&e.searchParams.append("screenshot",String(this._lastScreenshot?1:0)),yr().windows.create({url:Cr.getURL(e.pathname+e.search),type:"popup",width:380,height:520})}).then(e=>{e&&e.id&&yr().windows.update(e.id,{left:Math.round((E.isChromium()&&e.left||0)+((self.screen?.availWidth||760)-380)/2),top:Math.round((E.isChromium()&&e.top||0)+((self.screen?.availHeight||1040)-520)/2)})})}static _onSendFeedbackMessage(e,t){const r=new FormData;r.append("sender",t.sender),r.append("text",t.text),this._lastScreenshot&&t.includeScreenshot&&(r.append("screenshot",this._lastScreenshot,`screenshot_${Date.now()}.jpg`),this._lastScreenshot=null),fetch(Q,{method:"POST",mode:"cors",credentials:"omit",body:r}).catch(()=>{is.trackError("http","error_send_feedback")})}static _onOpenOptionsMessage(e,t){let r="/options/options.html";t.ref&&(r+=`?ref=${encodeURIComponent(t.ref)}`),t.target&&(r+=`#${t.target}`),yr().tabs.create({url:Cr.getURL(r)}).then(e=>{e&&e.windowId&&yr().windows.update(e.windowId,{focused:!0}).catch(console.error)})}static _onOpenPrivacyConfirmationMessage(e,t){yr().tabs.create({url:B}).then(e=>{e&&e.windowId&&yr().windows.update(e.windowId,{focused:!0}).catch(console.error)})}static _onCloseCurrentTabMessage(e,t){yr().tabs.query({currentWindow:!0,active:!0}).then(e=>{e.length&&yr().tabs.remove(e[0].id).catch(()=>null)})}static _getInitialPreferredLanguages(){const{geoIpLanguages:e,motherTongue:t,preferredLanguages:r}=this._storageController.getSettings();if(Array.isArray(r)&&r.length)return r;const n=$n.getPrimaryLanguageCode($n.getUserLanguageCode()),s=navigator.languages.map(e=>$n.getPrimaryLanguageCode(e));return rr([t,n].concat(e,s,["en"]).filter(Boolean)).map(e=>"nb"===e?"no":"fil"===e?"tl":e)}static _getPreferredLanguages(e){const{preferredLanguages:t,forcePreferredLanguages:r,motherTongue:n}=this._storageController.getSettings();if(n&&t.push(n),r)return rr(t);if(e.tab){const r=this._extensionStates.get(e.tab.id);r&&r.language&&t.push(r.language)}return t.push("en"),rr(t)}static async _onCheckTextMessage(e,t){if(is.trackActivity(),0===this._checkThrottlingCount&&setTimeout(()=>{this._checkThrottlingCount=0},5e3),this._checkThrottlingCount++,this._checkThrottlingCount>t.options.throttlingLimit){return{initialCommand:"CHECK_TEXT",isSuccessful:!1,instanceId:t.metaData.instanceId,error:{status:0,reason:"TooManyRequests"}}}const{username:r,password:n,token:s,forcePreferredLanguages:a,motherTongue:i,enVariant:o,deVariant:c,ptVariant:l,caVariant:u,dictionary:g}=this._storageController.getSettings();let d=this._getPreferredLanguages(e);if(t.metaData.elementLanguage&&!a){const e=$n.getPrimaryLanguageCode(t.metaData.elementLanguage.toLowerCase());$n.SUPPORTED_LANGUAGES.some(t=>$n.getPrimaryLanguageCode(t.code)===e)?d=[e]:d.push(e)}const{hasPaidSubscription:h,showRuleId:m}=this._storageController.getUIState();let _=null;r&&s?_={email:r,token:s}:r&&n&&(_={email:r,password:n});const p=this._storageController.getCustomServerUrl();"extension"!==Cr.getType()||p||h||(_=null);let f,S=!0;es.isRunning()&&(f=await this._incrementTrialTokenUsage(2),S=!1);const T={instanceId:t.metaData.instanceId,user:_,accessToken:f,isPremium:h,enableHiddenMatches:S,apiServerUrl:p,languageVariants:{en:o,de:c,pt:l,ca:u},dictionary:g,disabledRules:this._storageController.getIgnoredRuleIds(),preferredLanguages:d,forcePreferredLanguages:a,motherTongue:i,checkLevel:t.metaData.checkLevel,recipientInfo:t.metaData.recipientInfo,writingGoalId:null,ignoreCapitalizationErrorsAtLineStart:t.options.ignoreCapitalizationErrorsAtLineStart,allowIncompleteResults:!t.forceLanguage,skipTextLevelCheck:!t.options.checkTextLevel,debug:m,userAgent:E.getUserAgentIdentifier(),version:Cr.getVersion(),testGroups:t.options.testGroups},A="test"===t.options.testGroups?.languageDetection?"client":"server";try{const{textLevelResult:e,paragraphLevelResult:r}=await Vn.check(t.text,t.forceLanguage?t.language:null,T,t.changedParagraphs,t.metaData.changedParagraphsSentencesLength,t.metaData.appliedFix,void 0,A,e=>{1e3*Math.random()<1&&is.trackError("other","lang_detect_error",e)});let n=e.language||t.language;const s=!(!n||n.name!==this.UNSUPPORTED_LANGUAGE_NAME);s&&(n=null);return{initialCommand:"CHECK_TEXT",isSuccessful:!0,instanceId:t.metaData.instanceId,text:t.text,changedParagraphs:t.changedParagraphs,language:n,isUnsupportedLanguage:s,isIncompleteResult:r.isIncompleteResult,textLevelErrors:e.errors,textLevelPremiumErrors:e.premiumErrors,textLevelPremiumPickyErrors:e.premiumPickyErrors,textLevelPickyErrors:e.pickyErrors,paragraphLevelErrors:r.errors,paragraphLevelPremiumErrors:r.premiumErrors,paragraphLevelPremiumPickyErrors:r.premiumPickyErrors,paragraphLevelPickyErrors:r.pickyErrors,paragraphLevelSentenceRanges:r.sentenceRanges,areErrorsSuppressed:r.areErrorsSuppressed}}catch(e){if(e&&"AbortError"===e.reason)return;t.options.textTooLongMessage&&"TextTooLong"===e.reason&&(e.message=t.options.textTooLongMessage);return{initialCommand:"CHECK_TEXT",isSuccessful:!1,instanceId:t.metaData.instanceId,error:{reason:e.reason,status:e.status,response:e.response,url:e.url,stack:e.stack}}}}static _onLaunchEditorMessage(e,t){this._launchEditor(t.text)}static _onGetValidatorDataMessage(e,t){const r=this._validatorsData.get(t.id);this._validatorsData.delete(t.id);const n={initialCommand:"GET_VALIDATOR_DATA",isSuccessful:!0,text:r?r.text:"",html:r?r.html:void 0};return Promise.resolve(n)}static _onStartDictionarySyncMessage(e,t){os.checkForInitialSync()}static _onAddWordToDictionaryMessage(e,t){os.addWord(t.word).catch(()=>null)}static _onBatchAddWordToDictionaryMessage(e,t){os.addBatch(t.words).catch(()=>null)}static _onRemoveWordFromDictionaryMessage(e,t){os.removeWord(t.word).catch(()=>null)}static _onClearDictionaryMessage(e,t){os.removeBatch(this._storageController.getSettings().dictionary).catch(()=>null)}static _onUpdateDictionaryMessage(e,t){os.downloadAll()}static _onOpenURLMessage(e,t){const{tabs:r}=yr();is.trackEvent("Action","open_tab",t.url),"self"===t.target?r.update({url:t.url}):r.create({url:t.url}).then(e=>{e&&e.windowId&&yr().windows.update(e.windowId,{focused:!0})})}static _onGetPreferredLanguagesMessage(e,t){const r=this._getPreferredLanguages(e),n=this._storageController.getSettings(),s=r.map(e=>n[`${e}Variant`]||e);return Promise.resolve(s)}static _onLoadSynonymsMessage(e,t){return _s.load(t.wordContext,t.language,t.motherTongue)}static _onAbortSynonymsRequestMessage(){return _s.abort()}static _onLoadPhrasesMessage(e,{uuid:t,phrase:r,language:n,inhouseOnly:s,user:a,mode:i}){return gs.load(t,r,n,s,a,i).then(e=>e,e=>{switch(!0){case"AbortError"===e.name:throw new Error(ot);case"ServerTimeout"===e.message:throw new Error(lt);default:throw new Error(ut)}})}static _onAbortPhraseRequestsMessage(e,{type:t}){return gs.abort(t)}static _onLoadSplitSentenceMessage(e,{uuid:t,phrase:r,language:n,inhouseOnly:s,user:a}){return gs.requestSplitSentence(t,r,n,s,a).then(e=>e,e=>{switch(!0){case"AbortError"===e.name:throw new Error(ot);case"PayloadTooLarge"===e.message:throw new Error(ct);case"ServerTimeout"===e.message:throw new Error(lt);default:throw new Error(ut)}})}static _abortTranslateTextRequest(e){Cs.getInstance().abortRequest(e)}static async _translateText(e,t){return await Vn.translateText({sourceLang:t.sourceLang,targetLang:t.targetLang,sentences:t.sentences,leftContext:t.leftContext||"",rightContext:t.rightContext||""},{metaData:{hostUrl:e?.url||"",instanceId:t.metaData?.instanceId},adapter:{translate:async e=>{const{response:r}=Cs.getInstance().translate({payload:e,meta:{abortId:t.metaData.abortId}});try{const{data:e}=await r;return{isSuccessful:!0,translatedSentences:e.map(e=>e.translation)}}catch(e){return console.warn("Failed to translate:",e),is.trackError("http","translate_failed"),{isSuccessful:!1}}}}})}static _openPremiumPage(e,t){if(E.isSafari()&&!t.campaign.startsWith("addon2-changelog")){const e=this._storageController.getSettings().userId||void 0,r="safari";return is.trackEvent("Action","go_to_apple_upgrade",t.campaign),void yr().runtime.sendMessage({message:{...t,userId:e,target:r},command:"LAUNCH_APPLE_UPGRADE"})}const r=function(e,t=0,r=0,n=0,s="",a){const i=new URL("https://languagetool.org/premium");return i.searchParams.set("utm_campaign",e),a&&i.searchParams.set("textLang",a),s&&i.searchParams.set("historicMatches",s),t&&i.searchParams.set("grammarMatches",String(t)),n&&i.searchParams.set("punctuationMatches",String(n)),r&&i.searchParams.set("styleMatches",String(r)),i.toString()}(t.campaign,t.hiddenGrammarMatches,t.hiddenStyleMatches,t.hiddenPunctuationMatches,t.historicMatches,t.textLanguage),{windows:n}=yr();E.isThunderbird()&&"openDefaultBrowser"in n&&Ft(n.openDefaultBrowser)?n.openDefaultBrowser(r):yr().tabs.create({url:r}).then(e=>{e&&e.windowId&&yr().windows.update(e.windowId,{focused:!0})})}static _onUpdateSurroundingTextContextMessage(e,t){}static _loginUserMessage(e,t){E.isSafari()&&yr().runtime.sendMessage({command:"LOGIN"})}static _logoutUserMessage(e,t){E.isSafari()&&yr().runtime.sendMessage({command:"LOGOUT"})}static _onLoginUserMessage(e,t){this._storageController.updateSettings({username:t.username,password:"",userId:t.userId,token:t.token,knownEmail:t.username,apiServerUrl:q}).then(()=>{this._storageController.checkForPaidSubscription()})}static _onLogoutUserMessage(e,t){this._storageController.updateSettings({username:"",password:"",userId:null,token:"",isDictionarySynced:!1}).then(()=>{this._storageController.checkForPaidSubscription()})}static _onManifestV3Ping(e,t){return Promise.resolve("success")}static _onInitializeUserActivity(e,t){return async function(e){return ps.set(e.uuid,{email:e.email,token:e.token,source:e.source,suggestions:{spelling:0,grammar:0,style:0,punctuation:0,typography:0},statistics:{words:0,sentences:0,texts:0,hiddenMatches:0,premiumMatches:0,pickyErrors:0},meta:{language:e.language,writingGoalId:e.writingGoalId,checkLevel:e.checkLevel},rewritings:0,lastPing:Date.now()})}(t.data)}static _onHandleUserActivityPings(e,t){return async function(e){e.forEach(async e=>{const t=await ps.get(e);t&&(t.lastPing=Date.now(),await ps.set(e,t))})}(t.uuids)}static _onUpdateUserActivityTextStatistics(e,t){return async function(e,t){const r=await ps.get(e);if(!r)return;const n=Object.entries(t).reduce((e,[t,r])=>(e[t]+=r,e),r.statistics);await ps.set(e,{...r,statistics:n,lastPing:Date.now()})}(t.uuid,t.stats)}static _onUpdateUserActivityAppliedSuggestions(e,t){return async function(e,t,r){if(function(e){return"custom"===e}(t))return;const n=await ps.get(e);if(!n)return;const s=n.statistics.premiumMatches+Number(r);await ps.set(e,{...n,suggestions:{...n.suggestions,[t]:n.suggestions[t]+1},statistics:{...n.statistics,premiumMatches:s},lastPing:Date.now()})}(t.uuid,t.type,t.isPremium)}static _onUpdateUserActivityAppliedRewritings(e,t){return async function(e){const t=await ps.get(e);t&&await ps.set(e,{...t,rewritings:t.rewritings+1,lastPing:Date.now()})}(t.uuid)}static _onUpdateUserActivityMeta(e,t){return async function(e,t){const r=await ps.get(e);r&&await ps.set(e,{...r,meta:t,lastPing:Date.now()})}(t.uuid,t.meta)}static _onSendUserActivity(e,t){return fs(t.uuid)}static _onDestroyUserActivity(e,t){return Es(t.uuid)}static async _getActiveTabs(){try{return await yr().tabs.query({status:"complete",windowType:"normal"})}catch(e){return[]}}static _getCustomUserActivityStorage(){const e=yr().storage.local,t=async()=>(await e.get("userActivityStates")).userActivityStates||{};return{getAll:t,get:async e=>(await t())[e],set:async(r,n)=>{const s=await t();s[r]=n,await e.set({userActivityStates:s})},delete:async r=>{const n=await t();delete n[r],await e.set({userActivityStates:n})}}}static async _incrementTrialTokenUsage(e){const t=Date.now();let{trialToken:r}=this._storageController.getTrialSettings();if(!(r&&r.usageCount+e<Ot&&t-r.createdAt<Nt))try{this._trialTokenPromise=this._trialTokenPromise||this._generateTrialToken();r={jwt:(await this._trialTokenPromise).getJWT(),usageCount:0,createdAt:Date.now()},is.trackSampledEvent("Action","trial_token_update","succeeded")}catch(e){is.trackSampledEvent("Action","trial_token_update",String(e)||"failed")}finally{this._trialTokenPromise=null}if(r)return await this._storageController.updateTrialSettings({trialToken:{...r,usageCount:r.usageCount+e}}),r.jwt}static async _generateTrialToken(){if(!navigator.onLine)return Promise.reject("offline");const{lastTrialTokenAttempt:e}=this._storageController.getTrialSettings(),r=Date.now();if(e&&r-e<18e5)return Promise.reject("rate_limited");await this._storageController.updateTrialSettings({lastTrialTokenAttempt:r});const n=async(e=!1)=>{let r=null;delete self.__cerberusToken;const n=function(e){return t||(t=new p(e,()=>{t=void 0})),t}({onToken:e=>{r=e,self.__cerberusToken=e},onError:e=>{console.log("cerberus error:",e)},onTimeout:()=>{console.log("cerberus timeout")},disableBrowserCheck:!0,service:"lt_premium_only",timeout:e?1e4:3e4,tokenMetaData:{type:"trial",email:this._storageController.getSettings().username,bucket:"",uuid:this._storageController.getUniqueId()}});return await n.requestVerification(),r||self.__cerberusToken?r||self.__cerberusToken:Promise.reject()};try{return await n()}catch(e){return await Dr(5e3),n(!0)}}static setupLanguageDetectionTest(){const{preferredLanguages:e}=this._storageController.getSettings(),{testGroups:t}=this._storageController.getTestFlags();if(jn.supported(e)&&!t.languageDetection){const e={...t};return e.languageDetection=Math.random()<.1?"test":"control",this._storageController.updateTestFlags({testGroups:e})}return Promise.resolve()}}Rs=Is,Is.UNSUPPORTED_LANGUAGE_NAME="NoopLanguage",Is.CONTEXT_MENU_ID="languagetool-menu",Is._lastUserDataSync=null,Is._extensionStates=new Map,Is._validatorsData=new Map,Is._checkThrottlingCount=0,Is._currentAction=null,Is._lastScreenshot=null,Is._trialTokenPromise=null,Is._onDataLoaded=()=>{is.trackActivity(),Rs._updateUninstallURL(),Rs._applyManagedSettings()},Is._onInstalled=e=>{const{reason:t,previousVersion:r}=e;Rs._currentAction=t,Rs._updateIcon(),Rs._registerAlarms(),Rs._storageController.onReady(()=>{if(Rs._applyManagedSettings(),"install"===t){As.skipAll(),Rs.setupLanguageDetectionTest();!Rs._storageController.getPrivacySettings().allowRemoteCheck&&!Rs._storageController.getUIState().hasSeenPrivacyConfirmationDialog&&(Rs._openPrivacyConfirmationDialog(),Rs._updateUninstallURL(),Rs._setLanguagePreferences().catch(e=>{console.error(e),is.trackError("js",e&&e.message)}),is.trackInstall(),as.setNativeSpellCheck(!1))}else if("update"===t){As.run(),Rs._updateUninstallURL();const e=yr().runtime.getManifest(),t=e&&e.version||"unknown";r!==t&&is.trackEvent("Action","update",String(t))}})},Is._onMessage=(e,t)=>{return Mt(r=e)&&"command"in r&&Gt(r.command)?(Rs._currentAction=e.command||null,new Promise((e,t)=>{const r=self.setTimeout(()=>t(),3e4);Rs._storageController.onReady(()=>{self.clearTimeout(r),e()})}).then(()=>{let r;return!function(e){return"PAGE_LOADED"===e.command}(e)?!function(e){return"LTASSISTANT_STATUS_CHANGED"===e.command}(e)?!function(e){return"CHECK_FOR_PAID_SUBSCRIPTION"===e.command}(e)?!function(e){return"TRACK_EVENT"===e.command}(e)?!function(e){return"OPEN_FEEDBACK_FORM"===e.command}(e)?!function(e){return"SEND_FEEDBACK"===e.command}(e)?!function(e){return"OPEN_OPTIONS"===e.command}(e)?!function(e){return"OPEN_PRIVACY_CONFIRMATION"===e.command}(e)?!function(e){return"CLOSE_CURRENT_TAB"===e.command}(e)?!function(e){return"CHECK_TEXT"===e.command}(e)?!function(e){return"LAUNCH_EDITOR"===e.command}(e)?!function(e){return"GET_VALIDATOR_DATA"===e.command}(e)?!function(e){return"START_DICTIONARY_SYNC"===e.command}(e)?!function(e){return"ADD_WORD_TO_DICTIONARY"===e.command}(e)?!function(e){return"BATCH_ADD_WORDS_TO_DICTIONARY"===e.command}(e)?!function(e){return"REMOVE_WORD_FROM_DICTIONARY"===e.command}(e)?!function(e){return"CLEAR_DICTIONARY"===e.command}(e)?!function(e){return"GET_PREFERRED_LANGUAGES"===e.command}(e)?!function(e){return"LOAD_SYNONYMS"===e.command}(e)?!function(e){return"ABORT_SYNONYMS_REQUEST"===e.command}(e)?!function(e){return"LOAD_PHRASES"===e.command}(e)?!function(e){return"ABORT_PHRASE_REQUESTS"===e.command}(e)?!function(e){return"TRANSLATE_TEXT"===e.command}(e)?!function(e){return"ABORT_TRANSLATE_REQUESTS"===e.command}(e)?!function(e){return"LOAD_SPLIT_SENTENCE"===e.command}(e)?!function(e){return"UPDATE_DICTIONARY"===e.command}(e)?!function(e){return"OPEN_URL"===e.command}(e)?!function(e){return"OPEN_PREMIUM_PAGE"===e.command}(e)?!function(e){return"UPDATE_SURROUNDING_TEXT_CONTEXT"===e.command}(e)?!function(e){return"LOGIN"===e.command}(e)?!function(e){return"LOGOUT"===e.command}(e)?!function(e){return"ON_LOGIN"===e.command}(e)?!function(e){return"ON_LOGOUT"===e.command}(e)?!function(e){return"BACKGROUND_PING"===e.command}(e)?!function(e){return"INITIALIZE_USER_ACTIVITY"===e.command}(e)?!function(e){return"SEND_USER_ACTIVITY_PINGS"===e.command}(e)?!function(e){return"UPDATE_USER_ACTIVITY_TEXT_STATISTICS"===e.command}(e)?!function(e){return"UPDATE_USER_ACTIVITY_APPLIED_SUGGESTIONS"===e.command}(e)?!function(e){return"UPDATE_USER_ACTIVITY_APPLIED_REWRITINGS"===e.command}(e)?!function(e){return"UPDATE_USER_ACTIVITY_META"===e.command}(e)?!function(e){return"DESTROY_USER_ACTIVITY"===e.command}(e)?!function(e){return"SEND_USER_ACTIVITY"===e.command}(e)?!function(e){return"UPDATE_CONTEXT_MENU"===e.command}(e)?!function(e){return"GET_TERMS_OF_SERVICE_INFO"===e.command}(e)?!function(e){return"ACCEPT_TERMS_OF_SERVICE"===e.command}(e)?function(e){return"SYNC_USER_DATA"===e.command}(e)&&(r=Rs._onSyncUserData(!0)):r=Rs._onAcceptTermsOfServiceMessage(e):r=Rs._onGetTermsOfServiceInfoMessage(e):r=Rs._setContextMenu():r=Rs._onSendUserActivity(t,e):r=Rs._onDestroyUserActivity(t,e):r=Rs._onUpdateUserActivityMeta(t,e):r=Rs._onUpdateUserActivityAppliedRewritings(t,e):r=Rs._onUpdateUserActivityAppliedSuggestions(t,e):r=Rs._onUpdateUserActivityTextStatistics(t,e):r=Rs._onHandleUserActivityPings(t,e):r=Rs._onInitializeUserActivity(t,e):r=Rs._onManifestV3Ping(t,e):r=Rs._onLogoutUserMessage(t,e):r=Rs._onLoginUserMessage(t,e):r=Rs._logoutUserMessage(t,e):r=Rs._loginUserMessage(t,e):r=Rs._onUpdateSurroundingTextContextMessage(t,e):r=Rs._openPremiumPage(t,e):r=Rs._onOpenURLMessage(t,e):r=Rs._onUpdateDictionaryMessage(t,e):r=Rs._onLoadSplitSentenceMessage(t,e):r=Rs._abortTranslateTextRequest(e.abortId):r=Rs._translateText(t,e):r=Rs._onAbortPhraseRequestsMessage(t,e):r=Rs._onLoadPhrasesMessage(t,e):r=Rs._onAbortSynonymsRequestMessage():r=Rs._onLoadSynonymsMessage(t,e):r=Rs._onGetPreferredLanguagesMessage(t,e):r=Rs._onClearDictionaryMessage(t,e):r=Rs._onRemoveWordFromDictionaryMessage(t,e):r=Rs._onBatchAddWordToDictionaryMessage(t,e):r=Rs._onAddWordToDictionaryMessage(t,e):r=Rs._onStartDictionarySyncMessage(t,e):r=Rs._onGetValidatorDataMessage(t,e):r=Rs._onLaunchEditorMessage(t,e):r=Rs._onCheckTextMessage(t,e):r=Rs._onCloseCurrentTabMessage(t,e):r=Rs._onOpenPrivacyConfirmationMessage(t,e):r=Rs._onOpenOptionsMessage(t,e):r=Rs._onSendFeedbackMessage(t,e):r=Rs._onOpenFeedbackFormMessage(t,e):r=Rs._onTrackEventMessage(t,e):r=Rs._onCheckForPaidSubscriptionMessage():r=Rs._onLTAssistantStatusChangedMessage(t,e):r=Rs._onPageLoadedMessage(t,e),r||Promise.resolve(null)})):Promise.reject(new Error("Received an invalid message."));
/*! (C) Copyright 2020 LanguageTooler GmbH. All rights reserved. */
var r},Is._onAlarm=e=>{switch(Rs._currentAction=e.name,e.name){case"UPDATE_ICON":Rs._updateIcon();break;case"CHECK_FOR_PAID_SUBSCRIPTION":Rs._checkForPaidSubscription();break;case"LOAD_CONFIGURATION":Rs._loadConfiguration();break;case"SYNC_USER_DATA":Rs._onSyncUserData();break;case"SYNC_DICTIONARY":os.checkForInitialSync();break;case"SEND_AND_DESTROY_COMPLETED_USER_ACTIVITIES":!async function(){const e=Date.now();let t=3;const r=await ps.getAll();for(const n in r)if(e-r[n].lastPing>Ne&&(await Es(n),! --t))break}();break;case"FETCH_TRANSLATE_SUPPORTED_LANGUAGES":Rs._fetchTranslateSupportedLanguages();break;case"CHECK_FOR_TRIAL_PAGE":Rs._checkForTrialPage();break;default:console.warn("Unknown alarm '%s'",e.name)}},Is._onContextMenuItemClicked=(e,t)=>{if(e.menuItemId===Rs.CONTEXT_MENU_ID){if(Rs._currentAction="contextMenuClicked",t&&t.id&&!E.isThunderbird()){const r={command:"GET_SELECTED_TEXT"};yr().tabs.sendMessage(t.id,r).then(e=>{Rs._launchEditor(e.selectedText,e.selectedHTML)}).catch(t=>{console.warn("Could not get selected text",t),Rs._launchEditor(e.selectionText)})}else Rs._launchEditor(e.selectionText);Rs._storageController.updateUIState({hasUsedValidator:!0})}},Is._handleUnhandledRejection=e=>{const t=String(e.reason).replace(/No (tab|window) with id: \d+/i,"No $1 with that id").replace(/Invalid (tab|window) ID: \d+/i,"Invalid $1 ID");t.includes("AbortError")||t.includes("browser is shutting down")||t.includes("FILE_ERROR_NO_SPACE")||is.trackError("js","unhandled_promise_rejection",(Rs._currentAction||"unknown")+":"+t)},(()=>{const{manifest_version:e}=yr().runtime.getManifest();var t;if(vr.init(new cn),ns.init(()=>new ss),Cr.init(new on),os.init(),As.init(),jn.init(),es.init(),is.init(new Ss),(t=Rs._getCustomUserActivityStorage())&&(ps=t),self.addEventListener("unhandledrejection",Rs._handleUnhandledRejection),Rs._storageController=ns.create(),Rs._storageController.onReady(Rs._onDataLoaded),Rs._storageController.addEventListener(rs.eventNames.userCredentialsChanged,Rs._onUserCredentialsChanged),Rs._updateIcon(!0),yr().runtime.onInstalled.addListener(Rs._onInstalled),yr().runtime.onMessage.addListener(Rs._onMessage),yr().alarms.onAlarm.addListener(Rs._onAlarm),Rs._browserAction=(3===e?yr().action:yr().browserAction)||yr().composeAction,Rs._contextMenu=yr().contextMenus||yr().menus,Rs._setContextMenu(),E.isFirefox()||E.isThunderbird()){const e=()=>{yr().runtime.onUpdateAvailable.removeListener(e),Rs._installUpdate()};yr().runtime.onUpdateAvailable.addListener(e)}Rs._initThunderbird()})()})()})();