(()=>{"use strict";var t;!function(t){t.CHROME_EXTENSION_ID="CHROME_EXTENSION_ID",t.SHOW_PARTIAL_RECO_UNDERLINE="SHOW_PARTIAL_RECO_UNDERLINE",t.EXTN_PREFIX="EVENT_PREFIX",t.COLORS_GRAMMAR="COLORS_GRAMMAR",t.CARD_LAYOUT="CARD_LAYOUT",t.COLORS_SPELLING="COLORS_SPELLING",t.COLORS_STYLE="COLORS_LONG_SENTENCE",t.SUPPORTED_LANGUAGES="SUPPORTED_LANGUAGES",t.INSTALLED_ATTRIBUTE="INSTALLED_ATTRIBUTE",t.SITE_INIT_ATTRIBUTE="SITE_INIT_ATTRIBUTE",t.INPUT_AREA_INIT_ATTRIBUTE="INPUT_AREA_INIT_ATTRIBUTE",t.TMP_ID_ATTRIBUTE="TMP_ID_ATTRIBUTE",t.AI_RULE_ID_REGEX="AI_RULE_ID_REGEX",t.COLORS_PARAPHRASE="COLORS_PARAPHRASE",t.COLORS_RECOMMENDATION="COLORS_RECOMMENDATION",t.COLORS_RECOMMENDATION_TEASE="COLORS_RECOMMENDATION_TEASE",t.VALID_START_SENTENCE_REGEX="VALID_START_SENTENCE_REGEX",t.VALID_END_SENTENCE_REGEX="VALID_END_SENTENCE_REGEX",t.MULTI_SENTENCE_SELECTION_FOR_PARAPHRASE_ALLOWED="MULTI_SENTENCE_SELECTION_FOR_PARAPHRASE_ALLOWED",t.MAX_TEXT_LENGTH_ALLOWED_FOR_PAGELESS="MAX_TEXT_LENGTH_ALLOWED_FOR_PAGELESS",t.MAX_TEXT_LENGTH_ALLOWED="MAX_TEXT_LENGTH_ALLOWED",t.SELECTED_UNDERLINE_THICKNESS="SELECTED_UNDERLINE_THICKNESS",t.BULLET_POINT_PARSING_PREFIX="BULLET_POINT_PARSING_PREFIX",t.TOOLBAR_SIZE="TOOLBAR_SIZE",t.FIX_ALL_CONFIG="FIX_ALL_CONFIG",t.IGNORE_EDITOR_WITH_ATTRIBUTES="IGNORE_EDITOR_WITH_ATTRIBUTES",t.SHOW_TOOLBAR_ON_EMPTY_INPUT_AREA="SHOW_TOOLBAR_ON_EMPTY_INPUT_AREA",t.MAIN_CONTENT_SCRIPT_FILENAME="MAIN_CONTENT_SCRIPT_FILENAME",t.SPECIAL_INTRODUCTORY_TEASER_ENABLED="SPECIAL_INTRODUCTORY_TEASER_ENABLED",t.TERMS_OF_SERVICE_MODAL_ENABLED="TERMS_OF_SERVICE_MODAL_ENABLED",t.LOLLIPOP_CONFIG="LOLLIPOP_CONFIG",t.NORMALIZE_SPACE="NORMALIZE_SPACE",t.USE_CSS_CUSTOM_HIGHLIGHTS="USE_CSS_CUSTOM_HIGHLIGHTS",t.STRIP_WRAPPING_QUOTES_FROM_SENTENCE="STRIP_WRAPPING_QUOTES_FROM_SENTENCE",t.GDOCS_MENU_BUTTONS="GDOCS_MENU_BUTTONS",t.SUPPORTS_TRIAL="SUPPORTS_TRIAL",t.DISABLE_WHEN_QB_EXTENSION_IS_PRESENT="DISABLE_WHEN_QB_EXTENSION_IS_PRESENT"}(t||(t={}));const e={[t.CHROME_EXTENSION_ID]:"oldceeleldhonbafppcapldpdifcinji",[t.NORMALIZE_SPACE]:!1,[t.SHOW_PARTIAL_RECO_UNDERLINE]:!1,[t.EXTN_PREFIX]:"lt",[t.COLORS_GRAMMAR]:{UNDERLINE:"#f2b24c",SELECTED_UNDERLINE:"#f2b24c",BACKGROUND:"rgba(242,179,77,0.3)",EMPHASIZE:"rgba(241,179,76,0.1)"},[t.COLORS_SPELLING]:{UNDERLINE:"#EB5757",SELECTED_UNDERLINE:"#EB5757",BACKGROUND:"rgba(235,88,88,0.2)",EMPHASIZE:"rgba(239,88,88,0.1)"},[t.COLORS_STYLE]:{UNDERLINE:"#8F7FFF",SELECTED_UNDERLINE:"#8F7FFF",BACKGROUND:"rgba(142,128,255,0.2)",EMPHASIZE:"rgba(138,128,255,0.2)",TITLE:"#5C4CFF"},[t.COLORS_PARAPHRASE]:{UNDERLINE:"#8F7FFF",BACKGROUND:"rgba(142,128,255,0.2)",EMPHASIZE:"rgba(138,128,255,0.2)",TITLE:"#5C4CFF"},[t.COLORS_RECOMMENDATION]:{UNDERLINE:"#80B3E2",SELECTED_UNDERLINE:"#0067C5",BACKGROUND:"rgba(0, 103, 199, 0.16)",EMPHASIZE:"rgba(0, 103, 199, 0.16)"},[t.COLORS_RECOMMENDATION_TEASE]:{UNDERLINE:"#CF9F0280",SELECTED_UNDERLINE:"#CF9F02",BACKGROUND:"rgba(242,181,24,0.16)",EMPHASIZE:"rgba(242,181,24,0.16)"},[t.SUPPORTED_LANGUAGES]:["ar","ast-es","be-by","br-fr","ca-es","ca-es-valencia","crh-ua","da-dk","de-at","de-ch","de-de","el-gr","en-au","en-ca","en-gb","en-nz","en-us","en-za","eo","es","fa","ga-ie","fr","gl-es","it","ja-jp","km-kh","nl","no","pl-pl","pt-ao","pt-br","pt-mz","pt-pt","ro-ro","ru-ru","sk-sk","sl-si","sv","ta-in","tl-ph","uk-ua","zh-cn"],[t.CARD_LAYOUT]:{TARGET_BOX_HORIZONTAL_MARGIN:0,TARGET_BOX_VERTICAL_MARGIN:5,HEADER_HEIGHT:36,FOOTER_HEIGHT:36,KEYBOARD_HINT_HEIGHT:60,MIN_HEIGHT_PARAPHRASE:200,MIN_HEIGHT_TOOLBOX:230,MAX_HEIGHT_TOOLBOX:368},[t.INSTALLED_ATTRIBUTE]:"data-lt-installed",[t.SITE_INIT_ATTRIBUTE]:"data-lt-site",[t.INPUT_AREA_INIT_ATTRIBUTE]:"data-lt-tweaks",[t.TMP_ID_ATTRIBUTE]:"data-lt-tmp-id",[t.AI_RULE_ID_REGEX]:/^(QB|AI)_/,[t.VALID_START_SENTENCE_REGEX]:"[^•]",[t.VALID_END_SENTENCE_REGEX]:".",[t.MULTI_SENTENCE_SELECTION_FOR_PARAPHRASE_ALLOWED]:!1,[t.MAX_TEXT_LENGTH_ALLOWED_FOR_PAGELESS]:15e3,[t.MAX_TEXT_LENGTH_ALLOWED]:1e4,[t.SELECTED_UNDERLINE_THICKNESS]:2,[t.BULLET_POINT_PARSING_PREFIX]:"• ",[t.TOOLBAR_SIZE]:{width:20,height:20},[t.FIX_ALL_CONFIG]:{FIX_GC_ERRORS:!0,FIX_RECOMMENDATIONS:!1,FIX_STYLE_ERRORS:!1},[t.IGNORE_EDITOR_WITH_ATTRIBUTES]:["spellcheck"],[t.SHOW_TOOLBAR_ON_EMPTY_INPUT_AREA]:!1,[t.MAIN_CONTENT_SCRIPT_FILENAME]:"/content.js",[t.SPECIAL_INTRODUCTORY_TEASER_ENABLED]:!0,[t.TERMS_OF_SERVICE_MODAL_ENABLED]:!1,[t.LOLLIPOP_CONFIG]:{LOLLIPOP_THEME:"purple",LOLLIPOP_CSS_PATH:"/content/styles/lollipop.css",ONBOARDING_IMAGE_PATH:"/assets/images/toolbox/lollipop-onboarding-lt.webp",ONBOARDING_BORDER_RADIUS:"8px",LOLLIPOP_CIRCLE_IMAGE_PATH:"/assets/images/toolbox/lollipop-icon.svg",LOLLIPOP_CIRCLE_GDOCS_IMAGE_PATH:"/assets/images/toolbox/lollipop-icon-gdocs.svg",SUPPORTS_DARK_MODE:!0,ONBOARDING_LANDING_PAGE_URL:"https://languagetool.org/text-cursor",TOOLBOX_IFRAME_PATH:"/toolbox/toolbox.html",TOOLBOX_AVAILABLE_UI_LANGUAGES:["de","en","es","fr","nl","pt-br"],PPHR_SUPPORTS_MULTISENTENCE:!0,TOOLBOX_HOTKEY:void 0,TRACKING_SAMPLING_RATE:100,DEEP_LINK_INTO_TOOLBOX:!1},[t.STRIP_WRAPPING_QUOTES_FROM_SENTENCE]:!0,[t.USE_CSS_CUSTOM_HIGHLIGHTS]:!1,[t.GDOCS_MENU_BUTTONS]:!0,[t.SUPPORTS_TRIAL]:!0,[t.DISABLE_WHEN_QB_EXTENSION_IS_PRESENT]:!0};class E{constructor(){this.extnConfig=e}static getInstance(){return this.instance||self._qb_lt_config||(this.instance=new E,self._qb_lt_config=this.instance),this.instance||self._qb_lt_config}get(t){return this.extnConfig[t]}set(t,e){this.extnConfig[t]=e}setAll(t){this.extnConfig=t}getAll(){return this.extnConfig}}const _=E.getInstance(),n=(t,e)=>{console?.error&&console.error(`[GDocs Text Utils - ${t}]:`,e)},T=(t,e)=>{console?.warn&&console.warn(`[GDocs Text Utils - ${t}]: ${e}`)};function o(t,e,E){try{return t()}catch(t){return n(e,t),E}}let s=null;async function I(t){try{if("function"!=typeof self._docs_annotate_getAnnotatedText)return void T("initializeAnnotateAPIGetter","_docs_annotate_getAnnotatedText not available");const e=await async function(t,e=3,E=400){for(let _=0;_<e;_++)try{const e=new Promise((t,e)=>setTimeout(()=>e(new Error("Timeout")),E));return await Promise.race([t(),e])}catch(t){if(_===e-1)return n("retryWithTimeout",t),null;await new Promise(t=>setTimeout(t,100))}return null}(async()=>{if(!self._docs_annotate_getAnnotatedText)throw new Error("_docs_annotate_getAnnotatedText not available");const e=await Promise.resolve(self._docs_annotate_getAnnotatedText(t));if(!e)throw new Error("No annotated text data returned");return e},3,400);if(!e||"object"!=typeof e)return void T("initializeAnnotateAPIGetter","Failed to get valid annotated text data");"function"==typeof e.getText?s=e.getText.bind(e):T("initializeAnnotateAPIGetter","No getText method found on annotated data")}catch(t){n("initializeAnnotateAPIGetter",t)}}function R(t,e=null){const E=o(()=>{let E=e;if(null===E&&(E=function(t,e={}){const{maxDepth:E=20,textMarker:_=""}=e;return o(()=>{if(!t)return null;const e=[[t,["KX_kixApp"]]],n=new Set([t]);for(const[t,T]of e){const o=Object.getOwnPropertyNames(t);for(const s of o)try{const o=t[s];if("string"==typeof o&&o.startsWith(_))return T.concat(s);if(!(!(T.length<E&&o instanceof Object)||o instanceof Node||o instanceof Window||o instanceof RegExp||o instanceof Date||o instanceof Map||Array.isArray(o)||n.has(o))){const t=o;n.add(t),e.push([t,T.concat(s)])}}catch(t){}}return null},"getFullTextPath",null)??null}(t)),null!==E){const t=function(t){return o(()=>{let e=window;for(const E of t)e=e[E];return"string"==typeof e&&e?e:""},"getTextFromPath","")||""}(E);if(t)return{text:t,fullTextPath:E}}return{text:"",fullTextPath:E}},"getFullText",{text:"",fullTextPath:e});return E||{text:"",fullTextPath:e}}let a=null;document.documentElement.setAttribute("data-"+_.get(t.EXTN_PREFIX)+"-ready","true");const r=_.get(t.CHROME_EXTENSION_ID);try{self._docs_annotate_canvas_by_ext=r;const t=self.chrome;self.chrome=self.chrome||{},self.chrome.runtime=self.chrome.runtime||{};const e=self.chrome.runtime.sendMessage;self.chrome.runtime.sendMessage=function(...E){const[_]=E;if(_!==r)return e.apply(this,E);t||delete self.chrome}}catch(t){}const A="#dd0000",O="#4285f4",N="#fce8e6",i="#e8f0fe",L=/rgba\(31,\s*161,\s*93,\s*0\.|rgba\(255,\s*0,\s*122,\s*0\.|rgba\(0,\s*163,\s*187,\s*0\.|rgba\(119,\s*119,\s*119,\s*0\.|rgba\(19,\s*115,\s*51,\s*0\.|rgba\(184,\s*6,\s*114,\s*0\.|rgba\(147,\s*52,\s*230,\s*0\.|rgba\(163,\s*90,\s*0,\s*0\./i,S=document.getElementsByTagName(_.get(t.EXTN_PREFIX)+"-gdocs-disabled");function l(){return!!S.length}let c=!1;const C=[];function P(t){c?t():C.push(t)}function D(t,e,E){P(()=>{const _=new CustomEvent(e,{detail:E,bubbles:!0});t.dispatchEvent(_)})}document.addEventListener(_.get(t.EXTN_PREFIX)+"-gdocs-init",()=>{C.forEach(t=>t()),C.length=0,c=!0}),P(()=>{I(r).catch(t=>{console.error("[gdocs-content] Failed to initialize annotate API:",t)})});const u=new Map,g=new Map,f=CanvasRenderingContext2D.prototype.moveTo;CanvasRenderingContext2D.prototype.moveTo=function(...t){const[e,E]=t;return u.set(this,{x:e,y:E}),f.apply(this,t)};const h=CanvasRenderingContext2D.prototype.lineTo;CanvasRenderingContext2D.prototype.lineTo=function(...e){const[E,n]=e,T=this.strokeStyle.toString(),o=u.get(this);u.set(this,{x:E,y:n});if([A,O].includes(T.toLowerCase())&&!l())return;if(o?.y===n&&L.test(T)&&!l()){let e=g.get(this);e||(e=[],g.set(this,e));const{a:T,d:s,e:I,f:R}=this.getTransform(),a=Math.min(o.x,E)*T+I,r=Math.max(o.x,E)*T+I,A=n*s+R-this.lineWidth/2,O=n*s+R+this.lineWidth/2;e.push({left:a,right:r,top:A,bottom:O}),this.canvas&&D(this.canvas,_.get(t.EXTN_PREFIX)+"-strikethroughchange",{strikethroughLines:e})}return h.apply(this,e)};const d=CanvasRenderingContext2D.prototype.fillRect;CanvasRenderingContext2D.prototype.fillRect=function(...t){const e=this.fillStyle.toString();if(!([N,i].includes(e.toLowerCase())&&!l()))return d.apply(this,t)};const U=CanvasRenderingContext2D.prototype.clearRect;CanvasRenderingContext2D.prototype.clearRect=function(...e){const[E,n,T,o]=e;let s=g.get(this);if(s&&!l()){const{a:e,d:I,e:R,f:a}=this.getTransform(),r=E*e+R,A=n*I+a,O={top:A,left:r,bottom:A+o*I,right:r+T*e},N=s.length;s=s.filter(t=>{return E=O,!!((e=t).left>E.right||e.right<E.left||e.top>E.bottom||e.bottom<E.top);var e,E}),N!==s.length&&(g.set(this,s),D(this.canvas,_.get(t.EXTN_PREFIX)+"-strikethroughchange",{strikethroughLines:s}))}return U.apply(this,e)};const G=CanvasRenderingContext2D.prototype.stroke;CanvasRenderingContext2D.prototype.stroke=function(...t){const[e]=t;if(e){const t=this.strokeStyle.toString();if([A,O].includes(t.toLowerCase())&&!l())return}return G.apply(this,t)},document.addEventListener("LanguageTool-getFullText",t=>{try{const e=t.detail?.datasetPropName;e&&(document.body.dataset[e]=function(){if(s)return s();{const t=o(()=>self.KX_kixApp,"getKixApp");if(t){const e=R(t,a);return a=e.fullTextPath,e.text}}return""}())}catch(t){}})})();